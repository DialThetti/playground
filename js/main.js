!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=39)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.name=t,this.enabled=!0}update(t,e){}obstruct(t,e,i){}collides(t,e){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}set(t,e){this.x=t,this.y=e}getScaledBy(t){return new s(this.x*t,this.y*t)}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Names={spawn:"spawn",playSFX:"playSFX"};e.SpawnEvent=class{constructor(t){this.payload=t,this.name=e.Names.spawn}};e.SfxEvent=class{constructor(t){this.payload=t,this.name=e.Names.playSFX}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(e.Side||(e.Side={}))},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5),a=s(i(0));class o extends a.default{constructor(t="dead",e=2){super("killable"),this.deathAnim=t,this.fadeoutTime=e,this.dead=!1,this.deadTime=0}kill(){this.dead||(this.finalize=()=>{this.dead=!0})}revive(t){this.dead=!1,this.deadTime=0,t.state=n.EntityState.ACTIVE}update(t,e){this.dead&&(this.deadTime+=e.deltaTime,-1!=this.fadeoutTime&&this.deadTime>this.fadeoutTime&&(t.state=n.EntityState.READY_TO_REMOVE))}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.READY_TO_REMOVE=0]="READY_TO_REMOVE",t[t.ACTIVE=1]="ACTIVE",t[t.UNTRIGGERED=2]="UNTRIGGERED"}(e.EntityState||(e.EntityState={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.debug=!1;let s=!1;e.setupMouseControl=function(t,i,n){let a;e.debug=!0,s||(["mousedown","mousemove"].forEach(s=>{t.addEventListener(s,t=>{e.debug&&(1===t.buttons?(i.vel.set(0,0),i.pos.set(t.offsetX+n.pos.x,t.offsetY+n.pos.y)):2===t.buttons&&a&&2==a.buttons&&"mousemove"===a.type&&(n.pos.x-=t.clientX-a.clientX,n.pos.y-=t.clientY-a.clientY,n.pos.x<0&&(n.pos.x=0),n.pos.y<0&&(n.pos.y=0)),a=t)})}),t.addEventListener("contextmenu",t=>t.preventDefault()),s=!0)},e.removeMouseControl=function(){e.debug=!1}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};function n(t){return s(this,void 0,void 0,(function*(){return(yield fetch(t)).json()}))}function a(t){return new Promise(e=>{const i=new Image;i.addEventListener("load",()=>{e(i)}),i.src=t})}Object.defineProperty(e,"__esModule",{value:!0}),e.loadJson=n,e.loadXML=function(t){return s(this,void 0,void 0,(function*(){const e=new DOMParser,i=yield fetch(t),s=yield i.text();return e.parseFromString(s,"application/xml")}))},e.loadImage=a,e.loadParallax=function(t){return s(this,void 0,void 0,(function*(){const e=yield n(`./sprites/${t}.json`);return{img:yield a(e.imageURL),y:e.y}}))}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.drawRect=function(t,e,i,s,n,a,o={filled:!1}){if(o.filled)return t.fillStyle=a,void t.fillRect(Math.floor(e),Math.floor(i),Math.floor(s),Math.floor(n));t.strokeStyle=a,t.beginPath(),t.rect(Math.floor(e),Math.floor(i),Math.floor(s),Math.floor(n)),t.stroke()}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(24)),a=s(i(1)),o=i(5),r=i(3),l=s(i(47));e.default=class{constructor(){this.pos=new a.default(0,0),this.vel=new a.default(0,0),this.size=new a.default(16,16),this.offset=new a.default(0,0),this.lifeTime=0,this.state=o.EntityState.ACTIVE,this.spriteChanged=!1,this.bypassPlatform=!1,this.bounds=new n.default(this.pos,this.size,this.offset),this.traits={},this.standingOn=new Set,this.events=new l.default}collide(t){this.getTraits().forEach(e=>e.collides(this,t))}update(t){this.getTraits().forEach(e=>e.update(this,t)),this.lifeTime+=t.deltaTime,this.getTraits().filter(t=>t.finalize).forEach(t=>{t.finalize(),t.finalize=void 0}),this.standingOn.clear()}obstruct(t,e){t===r.Side.BOTTOM&&e.tile.types.forEach(t=>this.standingOn.add(t)),this.getTraits().forEach(i=>i.obstruct(this,t,e))}addTrait(t){this.traits[t.name]=t}addTraits(t){t.forEach(t=>this.addTrait(t))}getTrait(t){return this.traits[(new t).name]}hasTrait(t){return null!=this.traits[(new t).name]}draw(t){}getTraits(){return Object.keys(this.traits).map(t=>this.traits[t])}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=n(i(64));e.default=class{constructor(t,e){this.name=t,this.spriteName=e}flipped(t){return t.vel.x<0}create(){return s(this,void 0,void 0,(function*(){const t=this.spriteName?yield new a.default(`entities/${this.spriteName}`).load():void 0;return()=>{const e=this.entityFac();return e.size.set(this.size.x,this.size.y),e.offset.set(this.offset.x,this.offset.y),e.addTraits(this.traits()),e.draw=i=>{if(t){const s=this.routeFrame(e,t);s&&t.draw(s,i,0,0,this.flipped(e))}},e}}))}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=s(i(1));class o extends n.default{constructor(t=new a.default(0,1500)){super("gravity"),this.gravity=t}update(t,e){if(!this.enabled)return;const i=this.gravity.getScaledBy(e.deltaTime);t.vel.add(i)}}e.default=o},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0));class a extends n.default{constructor(){super("physics")}update(t,e){e.collidable&&this.enabled&&(t.pos.x+=t.vel.x*e.deltaTime,e.collidable.checkX(t),t.pos.y+=t.vel.y*e.deltaTime,e.collidable.checkY(t))}}e.default=a},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=i(3),o=i(2);class r extends n.default{constructor(){super("jump"),this.jumpHeight=1,this.duration=this.jumpHeight/12,this.velocity=200,this.engageTime=0,this.onGround=0,this.requestTime=0,this.gracePeriod=.1,this.down=!1}start(){this.requestTime=this.gracePeriod}cancel(){this.engageTime=0,this.requestTime=0}update(t,e){if(this.requestTime>0){if(this.down&&t.standingOn.has("platform"))return t.bypassPlatform=!0,void this.cancel();this.falling||(t.bypassPlatform=!0,this.engageTime=this.duration,this.requestTime=0,t.events.emit(new o.SfxEvent({name:"jump"}))),this.requestTime-=e.deltaTime}this.engageTime>0&&(t.bypassPlatform=!1,t.vel.y=-this.velocity,this.engageTime-=e.deltaTime),this.onGround--}obstruct(t,e){e===a.Side.BOTTOM?this.onGround=1:e===a.Side.TOP&&this.cancel()}get falling(){return this.onGround<0}}e.default=r},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=s(i(1));class o extends n.default{constructor(){super("crouch"),this.d=!1,this.lockDown=!1,this.requestEnd=!1}obstruct(t,e,i){}update(t,e){this.d&&this.s(t),this.requestEnd&&(this.lockDown||this.end(t)),this.lockDown=!1}end(t){this.memoSize&&(t.pos.y-=8,t.size.set(this.memoSize.x,this.memoSize.y),this.memoSize=void 0,this.d=!1,this.requestEnd=!1)}start(){this.d=!0}cancel(){this.requestEnd=!0}get down(){return this.d}s(t){this.memoSize||(this.memoSize=new a.default(t.size.x,t.size.y),t.pos.y+=8,t.size.set(16,16))}}e.default=o},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5),a=s(i(0));class o extends a.default{constructor(){super("activateOnSight")}update(t,e){e.camera.box.right>t.bounds.left&&e.camera.box.left<t.bounds.right?t.state=n.EntityState.ACTIVE:t.state=n.EntityState.UNTRIGGERED}}e.default=o},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=i(3);class o extends n.default{constructor(){super("solid")}obstruct(t,e,i){if(this.enabled)switch(e){case a.Side.BOTTOM:t.bounds.top=i.y.from-t.size.y,t.vel.y=0;break;case a.Side.RIGHT:t.bounds.left=i.x.from-t.size.x,t.vel.x=0;break;case a.Side.LEFT:t.bounds.left=i.x.to,t.vel.x=0;break;case a.Side.TOP:t.bounds.top=i.y.to,t.vel.y=0}}}e.default=o},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0));class a extends n.default{constructor(){super("player"),this.lives=3,this.c=0,this.score=0}update(t){t.events.process("stomp",()=>this.score+=100)}get coins(){return this.c}set coins(t){t>=100&&(this.lives++,t-=100,console.log("1-up")),this.c=t}}e.default=a},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=s(i(13)),o=s(i(4)),r=i(6),l=i(3),u=i(2);class d extends n.default{constructor(){super("go"),this.dir=0,this.acceleration=400,this.deceleration=300,this.distance=0,this.lastDir=0,this.running=!1}get dragFactor(){return this.running?2e-4:5e-4}obstruct(t,e){e!==l.Side.LEFT&&e!==l.Side.RIGHT||(0!=this.distance&&t.events.emit(new u.SfxEvent({name:"bump"})),this.distance=0)}update(t,e){const i=t.getTrait(a.default),s=t.getTrait(o.default);if(s&&s.dead)return void t.vel.set(0,0);const n=Math.abs(t.vel.x);if(0!==this.dir)i&&!i.falling&&(this.lastDir=this.dir),t.vel.x+=this.acceleration*this.dir*e.deltaTime;else if(0!==t.vel.x){const i=Math.min(n,this.deceleration*e.deltaTime);t.vel.x+=t.vel.x>0?-i:i}else r.debug&&0!==this.distance&&console.log("Standing at",Math.round(t.pos.x/16),Math.round(t.pos.y/16)),this.distance=0;const l=this.dragFactor*t.vel.x*n;t.vel.x-=l,this.distance+=n*e.deltaTime}}e.default=d},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(25)),a=s(i(4)),o=s(i(0));class r extends o.default{constructor(t){super("playerController"),this.level=t,this.coins=0,this.points=0}setCheckpoint(t){this.checkPoint=t}setPlayer(t){this.player=t}update(){if(!this.level.entities.has(this.player)){const t=this.player.getTrait(a.default),e=this.player.getTrait(n.default);t.revive(this.player),e&&(e.disabledForReset=!0),this.player.pos.set(this.checkPoint.x*this.level.tilesize,this.checkPoint.y*this.level.tilesize),this.level.entities.add(this.player)}}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cross=function(t,e){return t.reduce((t,i)=>t.concat(e.map(t=>[i,t])),[])},e.intRange=function(t,e){return t>=e?[]:Array.from(Array(e-t).keys()).map(e=>e+t)},e.random=function(t){return Math.floor(t*Math.random())}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setEntityRepo=function(t){e.entityRepo=t}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=s(i(4)),o=i(2),r=i(65);class l extends n.default{constructor(){super("stomper"),this.bounceSpeed=400,this.quereBounce=!1,this.stomped=!1}fromAbove(t,e){return t.vel.y>e.vel.y}collides(t,e){const i=e.getTrait(a.default);t.getTrait(a.default).finalize||t.getTrait(a.default).dead||i&&!i.dead&&this.fromAbove(t,e)&&(this.bounce(t,e),t.events.emit(new o.SfxEvent({name:"stomp"})),t.events.emit(new r.StompEvent({us:t,them:e})))}bounce(t,e){this.finalize=()=>{t.bounds.bottom=e.bounds.top,t.vel.y=-this.bounceSpeed}}}e.default=l},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=i(3);class o extends n.default{constructor(t=-30){super("walk"),this.speed=t,this.enabled=!0}update(t){this.enabled&&(t.vel.x=this.speed)}obstruct(t,e){e!==a.Side.LEFT&&e!==a.Side.RIGHT||(this.speed*=-1)}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,i){this.pos=t,this.size=e,this.offset=i}overlaps(t){return this.bottom>t.top&&this.top<t.bottom&&this.left<t.right&&this.right>t.left}get bottom(){return this.pos.y+this.size.y+this.offset.y}set bottom(t){this.pos.y=t-(this.size.y+this.offset.y)}get top(){return this.pos.y+this.offset.y}set top(t){this.pos.y=t-this.offset.y}get left(){return this.pos.x+this.offset.x}set left(t){this.pos.x=t-this.offset.x}get right(){return this.pos.x+this.size.x+this.offset.x}set right(t){this.pos.x=t-(this.size.x+this.offset.x)}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=s(i(0));class o extends a.default{constructor(){super("cantGoLeft"),this.disabledForReset=!1,this.posOnScreen=new n.default(0,0)}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.tilesize=t}toIndex(t){return Math.floor(t/this.tilesize)}toIndexRange(t){const e=Math.ceil(t.to/this.tilesize)*this.tilesize,i=[];let s=t.from;do{i.push(this.toIndex(s)),s+=this.tilesize}while(s<e);return i}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(56),a=i(57),o=s(i(28)),r={solid:a.createSolidTileHandler(),platform:n.createPlatformTileHandler()};e.addHandler=function(t,e){r[t]=e};e.default=class{constructor(t){this.tileSize=t,this.layers=[]}addGrid(t){this.layers.push(new o.default(t,this.tileSize))}checkX(t){const e=t.bounds;if(0===t.vel.x)return;const i=t.vel.x>0?e.right:e.left;for(const s of this.layers){const n=s.getByRange({from:i,to:i},{from:e.top,to:e.bottom});n&&n.forEach(e=>this.handle("x",t,e,s))}}checkY(t){const e=t.bounds;if(0===t.vel.y)return;const i=t.vel.y>0?e.bottom:e.top;for(const s of this.layers){const n=s.getByRange({from:e.left,to:e.right},{from:i,to:i});n&&n.forEach(e=>this.handle("y",t,e,s))}}handle(t,e,i,s){i.tile.types.forEach(n=>{const a=r[n];a&&a[t](e,i,s)})}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),a=i(58),o=s(i(26));e.default=class{constructor(t,e){this.tiles=t,this.tilesize=e,this.math=new o.default(e)}getByRange(t,e){return n.cross(this.math.toIndexRange(t),this.math.toIndexRange(e)).map(([t,e])=>this.getByIndex(t,e)).filter(a.notNull)}setByRange(t,e,i){n.cross(this.math.toIndexRange(t),this.math.toIndexRange(e)).map(([t,e])=>this.tiles.set(t,e,i))}getByIndex(t,e){const i=this.tiles.get(t,e);if(i)return{tile:i,y:{from:e*this.tilesize,to:(e+1)*this.tilesize},x:{from:t*this.tilesize,to:(t+1)*this.tilesize}}}getByPosition(t,e){return this.getByIndex(this.math.toIndex(t),this.math.toIndex(e))}delete(t,e){"number"==typeof t&&(t={from:t,to:t}),"number"==typeof e&&(e={from:e,to:e}),this.setByRange(t,e,void 0)}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=s(i(9)),o=s(i(4)),r=s(i(0)),l=s(i(10)),u=s(i(11)),d=s(i(12)),c=s(i(22));class h extends r.default{constructor(){super("bulletBillAI")}collides(t,e){const i=t.getTrait(o.default);i.dead||e.getTrait(o.default)&&e.getTrait(o.default).dead||t.hasTrait(o.default)&&e.hasTrait(c.default)&&(e.getTrait(c.default).fromAbove(e,t)?(i&&i.kill(),t.vel.set(0,-100),t.addTrait(new u.default),this.enabled=!1):e.hasTrait(o.default)&&e.getTrait(o.default).kill())}}e.BulletBehavior=h;class f extends l.default{constructor(){super("bullet-bill","bullet-bill"),this.entityFac=()=>{const t=new a.default;return t.vel.x=30,t},this.size=new n.default(16,14),this.offset=new n.default(0,0),this.traits=()=>[new o.default,new h,new d.default]}routeFrame(){return"bullet"}}e.default=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createAnim=function(t,e){return i=>{const s=Math.floor(Math.abs(i)/e%t.length);return t[s]}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),a=i(6),o=s(i(32));class r extends o.default{constructor(t,e,i){super(t),this.w=e,this.h=i}define(t,e,i,s,n){super.define(t,e,i,s,n,!1),super.define(t+"_switched",e,i,s,n,!0)}draw(t,e,i,s,o=!1){const r=this.getImage(t+(o?"_switched":""));r?e.drawImage(r,i,s):a.debug?n.drawRect(e,i,s,16,16,"magenta",{filled:!0}):e.clearRect(i,s,16,16)}getAnimation(t){const e=this.animations[t];return e||(()=>"")}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.img=t,this.images={},this.images={},this.animations={}}define(t,e,i,s,n,a=!1){const o=document.createElement("canvas");o.width=s,o.height=n;const r=o.getContext("2d");a&&(r.scale(-1,1),r.translate(-s,0)),r.drawImage(this.img,Math.floor(e),Math.floor(i),s,n,0,0,s,n),this.images[t]=o}defineAnim(t,e){this.animations[t]=e}getImage(t){return this.images[t]}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(21),a=i(5),o=s(i(0)),r=i(2);class l extends o.default{constructor(t,e=!0,i=2,s){super("emitter"),this.entityName=t,this.repeating=e,this.interval=i,this.onEmit=s,this.cooldown=0,this.direction=1,this.cooldown=this.interval}update(t,e){this.cooldown-=e.deltaTime,this.cooldown<=0&&(this.repeating&&(this.cooldown=this.interval),this.emit(t))}emit(t){if(this.entityName){const e=n.entityRepo[this.entityName]();e.vel.x=100*this.direction,e.state=a.EntityState.ACTIVE,e.pos.set(t.pos.x,t.pos.y),t.events.emit(new r.SpawnEvent({entity:e})),this.onEmit&&this.onEmit(t)}}}e.default=l},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=s(i(9)),o=s(i(23)),r=s(i(4)),l=s(i(0)),u=s(i(10)),d=s(i(16)),c=s(i(11)),h=i(35),f=s(i(12)),p=s(i(15));class m extends l.default{constructor(){super("goombaAI")}collides(t,e){const i=h.getTraits(e),s=h.getTraits(t);s.killable.dead||i&&s&&i.stomper&&(i.stomper.fromAbove(e,t)?(s.killable&&s.killable.kill(),s.walk.speed=0):i.killable.kill())}}e.GoombaBehavior=m;class y extends u.default{constructor(){super("goomba","goomba"),this.entityFac=()=>new a.default,this.size=new n.default(16,16),this.offset=new n.default(0,0),this.traits=()=>[new o.default(-30),new r.default("flat"),new m,new d.default,new c.default,new f.default,new p.default]}routeFrame(t,e){const i=t.getTrait(r.default);return i&&i.dead?i.deathAnim:e.getAnimation("walk")(60*t.lifeTime)}}e.default=y},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(15)),o=i(29),r=i(34),l=i(36),u=s(i(25)),d=s(i(18)),c=s(i(13)),h=s(i(4)),f=s(i(19)),p=s(i(22)),m=s(i(23)),y=n(i(67)),v=s(i(33)),_=s(i(17)),g=s(i(37)),w=s(i(14));e.getTraits=function(t){return Object.assign({go:t.getTrait(d.default),killable:t.getTrait(h.default),jump:t.getTrait(c.default),stomper:t.getTrait(p.default),walk:t.getTrait(m.default),cantGoLeft:t.getTrait(u.default),goombaAI:t.getTrait(r.GoombaBehavior),koopaAI:t.getTrait(l.KoopaBehavior),playerController:t.getTrait(f.default),player:t.getTrait(_.default),activateOnSight:t.getTrait(a.default),bulletAI:t.getTrait(o.BulletBehavior),emitter:t.getTrait(v.default),levelTimer:t.getTrait(g.default),crouch:t.getTrait(w.default)},y.getTraits(t))}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=s(i(9)),o=s(i(23)),r=s(i(4)),l=s(i(0)),u=s(i(10)),d=s(i(16)),c=s(i(11)),h=i(35),f=s(i(12)),p=s(i(15)),m=i(5),y=i(2);var v;!function(t){t[t.WALKING=0]="WALKING",t[t.HIDING=1]="HIDING",t[t.BOWL=2]="BOWL"}(v||(v={}));class _ extends l.default{constructor(){super("koopaAI"),this.state=v.WALKING,this.hideTime=0,this.hideDuration=5,this.bowlSpeed=240}collides(t,e){const i=h.getTraits(e);this.state==v.BOWL&&i.killable&&(i.killable.kill(),e.hasTrait(o.default)&&(i.walk.enabled=!1),e.vel.x=0);const s=h.getTraits(t);s.killable.dead||i&&s&&i.stomper&&(i.stomper.fromAbove(e,t)?s.killable&&this.handleStomp(t,e):this.handleNudge(t,e))}handleNudge(t,e){if(e.state!==m.EntityState.ACTIVE)return;const i=h.getTraits(e),s=h.getTraits(t);switch(this.state){case v.WALKING:i.killable.kill();break;case v.HIDING:s.walk.enabled=!0,s.walk.speed=this.bowlSpeed*Math.sign(e.pos.x),t.events.emit(new y.SfxEvent({name:"kick"})),this.state=v.BOWL;break;case v.BOWL:e.vel.x=0,i.killable.kill()}}handleStomp(t,e){switch(this.state){case v.WALKING:case v.BOWL:this.hide(t);break;case v.HIDING:t.getTrait(o.default).enabled=!0,t.getTrait(o.default).speed=this.bowlSpeed*(t.pos.x>e.pos.x?1:-1),this.state=v.BOWL}}unhide(t){const e=t.getTrait(o.default);e.enabled=!0,e.speed=30,this.state=v.WALKING}hide(t){t.vel.x=0,t.getTrait(o.default).enabled=!1,this.state=v.HIDING,this.hideTime=0}update(t,e){this.state==v.HIDING&&(this.hideTime+=e.deltaTime,this.hideTime>this.hideDuration&&this.unhide(t))}}e.KoopaBehavior=_;class g extends u.default{constructor(){super("koopa","koopa"),this.entityFac=()=>new a.default,this.size=new n.default(16,16),this.offset=new n.default(0,8),this.traits=()=>[new o.default(-30),new r.default("hiding"),new _,new d.default,new c.default,new f.default,new p.default]}routeFrame(t,e){const{killable:i,koopaAI:s}=h.getTraits(t);return i&&i.dead?i.deathAnim:s.state===v.HIDING||s.state==v.BOWL?s.hideDuration-s.hideTime<2?e.getAnimation("wake")(60*t.lifeTime):"hiding":e.getAnimation("walk")(60*t.lifeTime)}}e.default=g},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(0)),a=i(2);class o extends n.default{constructor(t){super("leveltimer"),this.totalTime=300,this.currentTime=0,this.hurried=!1,t&&(this.totalTime=t.estimateTime)}update(t,e){this.currentTime+=e.deltaTime,this.restTime<=100&&!this.hurried&&(this.hurried=!0,t.events.emit(new a.SfxEvent({name:"hurry",blocking:!0})))}get restTime(){return this.totalTime-this.currentTime}}e.default=o},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),a=i(8),o=s(i(32));class r extends o.default{constructor(t,e,i){super(t),this.width=e,this.height=i,this.tilesize=i}defineTile(t,e,i){this.define(t,e*this.width,i*this.height,this.width,this.height)}isAnimatedTile(t){return!!this.animations[t]}drawAnim(t,e,i,s,n){const a=this.animations[t];a&&this.drawTile(a(n),e,Math.floor(i),Math.floor(s))}drawTile(t,e,i,s){this.draw(t,e,Math.floor(this.width*i),Math.floor(this.height*s))}draw(t,e,i,s){const o=this.getImage(t);o?e.drawImage(o,i,s):n.debug?a.drawRect(e,i,s,this.width,this.height,"magenta",{filled:!0}):e.clearRect(i,s,this.width,this.height)}}e.default=r},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=n(i(40));!function(){s(this,void 0,void 0,(function*(){const t=new a.default("screen","1-?");yield t.start(),window.testingCheatsEnabled(!1),window.setAudio(!0)}))}()},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=n(i(41)),o=i(6),r=n(i(42)),l=n(i(44)),u=n(i(45)),d=n(i(46)),c=n(i(9)),h=n(i(19)),f=n(i(48)),p=n(i(76)),m=n(i(78)),y=n(i(79)),v=i(5),_=n(i(17)),g=n(i(37));e.default=class{constructor(t,e){this.canvasId=t,this.level=e,this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d")}createPlayerEnv(t,e){const i=new c.default,s=new h.default(e),n=new g.default(e);return i.state=v.EntityState.ACTIVE,s.setPlayer(t),s.setCheckpoint(e.startPosition),i.addTraits([s,n]),i}start(){return s(this,void 0,void 0,(function*(){const{level:t,player:e,renderer:i}=yield new f.default(this.level).load(),s=new AudioContext,n=yield new y.default(s,"./sfx/audio.json").load(),c=yield new p.default("./img/font.png").load();r.default(e).listenTo(window);const h=new d.default;h.yAllowed=!0;const w=this.createPlayerEnv(e,t);e.state=v.EntityState.ACTIVE,t.entities.add(w),t.audioBoard=n,i.layers.push(new l.default(h),new u.default(h),new m.default(c,()=>Object.assign(Object.assign({},e.getTrait(_.default)),{time:w.getTrait(g.default).restTime,level:t.name,coins:e.getTrait(_.default).coins}))),new a.default(s=>{t.update(s,h),i.draw(this.context,h,e)}).start(),window.testingCheatsEnabled=t=>{t?(window.camera=h,o.setupMouseControl(this.canvas,e,h)):(window.camera=null,o.removeMouseControl())}}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e=1/60){this.updateFunc=t,this.deltaTime=e,this.lastTime=0,this.accumulatedTime=0,this.fps=0,this.lastTimeFps=0}enqueue(){requestAnimationFrame(t=>this.update(t))}update(t){for(this.accumulatedTime+=(t-this.lastTime)/1e3,this.accumulatedTime>1&&(this.accumulatedTime=1,console.warn("resolve sleeping"));this.accumulatedTime>this.deltaTime;)this.fps++,this.updateFunc(this.deltaTime),this.accumulatedTime-=this.deltaTime;t-this.lastTimeFps>1e3&&(console.log("FPS",this.fps),this.fps=0,this.lastTimeFps=t),this.lastTime=t,this.enqueue()}start(){this.enqueue()}}},function(t,e,i){"use strict";var s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(43)),o=n(i(13)),r=n(i(18)),l=n(i(14));e.default=function(t){const e=t.getTrait(r.default),i=t.getTrait(o.default),s=t.getTrait(l.default),n=t=>t===a.KeyState.PRESSED;return(new a.default).addMapping("Space",t=>n(t)?i.start():i.cancel()).addMapping("ShiftLeft",t=>e.running=n(t)).addMapping("KeyS",e=>{i.down=n(e),n(e)?s.start():s.cancel(),n(e)||(t.bypassPlatform=!1)}).addMapping("KeyD",t=>e.dir+=n(t)?1:-1).addMapping("KeyA",t=>e.dir-=n(t)?1:-1)}},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.PRESSED=0]="PRESSED",t[t.RELEASED=1]="RELEASED"}(s=e.KeyState||(e.KeyState={}));e.default=class{constructor(){this.keyStates={},this.keyMap={}}addMapping(t,e){return this.keyMap[t]=e,this}handleEvent(t){const{code:e}=t;if(!this.keyMap[e])return;t.preventDefault();const i="keydown"===t.type?s.PRESSED:s.RELEASED;this.keyStates[e]!==i&&(this.keyStates[e]=i,this.keyMap[e](i))}listenTo(t){["keydown","keyup"].forEach(e=>t.addEventListener(e,t=>this.handleEvent(t)))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(8);e.default=class{constructor(t){this.cameraToDraw=t}draw(t,e){s.debug&&n.drawRect(t,this.cameraToDraw.pos.x-e.pos.x,this.cameraToDraw.pos.y-e.pos.y,this.cameraToDraw.size.x,this.cameraToDraw.size.y,"purple")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(8);e.default=class{constructor(t){this.cameraToDraw=t}draw(t,e){s.debug&&n.drawRect(t,this.cameraToDraw.pos.x-e.pos.x+e.edge.x,this.cameraToDraw.pos.y-e.pos.y+e.edge.y,this.cameraToDraw.size.x-2*e.edge.x,this.cameraToDraw.size.y-2*e.edge.y,"green")}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(24)),a=s(i(1));e.default=class{constructor(){this.yAllowed=!1,this.pos=new a.default(0,0),this.size=new a.default(512,448),this.edge=new a.default(240,208)}get box(){return new n.default(this.pos,this.size,new a.default(0,0))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.events=[]}emit(t){this.events.push(t)}process(t,e){this.events.filter(e=>e.name===t).forEach(t=>e(t.payload)),this.events=this.events.filter(e=>e.name!==t)}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=n(i(49)),o=n(i(50)),r=n(i(51)),l=n(i(52)),u=n(i(53)),d=n(i(59)),c=i(5),h=i(21),f=n(i(60)),p=i(61),m=i(62),y=i(27),v=n(i(63)),_=i(69),g=n(i(70)),w=i(71),b=n(i(1)),T=n(i(28));e.default=class{constructor(t){this.levelName=t}load(){return s(this,void 0,void 0,(function*(){let t=yield new d.default(this.levelName).load(),[e]=yield Promise.all([new g.default(t.tileSet).load(),(new v.default).prepare()]);const i=yield new w.TiledMapLoader("./tiled/dev.tmx").load();e=i.spriteSheet;const s=new u.default(i.tileSize);s.name=this.levelName;const n=new f.default;n.layers.push(new a.default("#6B88FE")),t.entities&&t.entities.forEach(({name:t,pos:[i,s]})=>{h.entityRepo[t]().pos.set(i*e.tilesize,s*e.tilesize)});const x=h.entityRepo.mario();x.state=c.EntityState.ACTIVE,s.tiles=i.matixes[2],s.startPosition=t.startPosition,s.startPosition=new b.default(18,28),s.estimateTime=t.estimateTime,s.bgm=t.bgm,s.collider.tileCollider.layers=i.matixes.map(t=>new T.default(t,s.tilesize));const M=new r.default(s,e);return n.layers.push(M,new o.default(s.entities),new l.default(s)),y.addHandler("brick",p.createBrickTileHandler()),y.addHandler("coin",_.createCoinTileHandler()),y.addHandler("onlyCrouch",m.createOnlyCrouchTileHandler()),{level:s,player:x,renderer:n}}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8);e.default=class{constructor(t){this.color=t,this.screenWidth=512,this.screenHeight=488}draw(t){s.drawRect(t,0,0,this.screenWidth,this.screenHeight,this.color,{filled:!0})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e=64,i=64){this.entities=t,this.width=e,this.height=i,this.buffer=document.createElement("canvas"),this.buffer.width=e,this.buffer.height=i,this.bufferContext=this.buffer.getContext("2d")}draw(t,e){[...this.entities].filter(t=>t.bounds.overlaps(e.box)).forEach(i=>{this.bufferContext.clearRect(0,0,this.width,this.height),i.draw(this.bufferContext),t.drawImage(this.buffer,Math.floor(i.pos.x-e.pos.x),Math.floor(i.pos.y-e.pos.y))})}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),a=s(i(26));e.default=class{constructor(t,e){this.level=t,this.tileSet=e,this.layers=t.collider.tileCollider.layers,this.buffer=this.createBackgroundLayer(t.tilesize),this.bufferContext=this.buffer.getContext("2d"),this.math=new a.default(t.tilesize)}toRange(t,e){const i=this.math.toIndex(e),s=this.math.toIndex(t);return{from:s,to:i+s}}draw(t,e,i){this.updateCameraPosition(e,i),this.redraw(this.toRange(e.pos.x,e.size.x),this.toRange(e.pos.y,e.size.y)),t.drawImage(this.buffer,-e.pos.x%this.level.tilesize,-e.pos.y%this.level.tilesize)}updateCameraPosition(t,e){const i=e.pos.x-(t.pos.x+t.size.x-t.edge.x-e.size.x),s=e.pos.y-(t.pos.y+t.size.y-t.edge.y-e.size.y),n=e.pos.x-(t.pos.x+t.edge.x),a=e.pos.y-(t.pos.y+t.edge.y);t.pos.x+=Math.max(i,0),t.yAllowed&&(t.pos.y+=Math.max(s,0)),t.pos.x+=Math.min(n,0),t.yAllowed&&(t.pos.y+=Math.min(a,0)),t.pos.set(Math.floor(Math.max(t.pos.x,0)),Math.floor(Math.max(t.pos.y,0)))}redraw(t,e){const i={xStart:t.from,xEnd:t.to+1,yStart:e.from,yEnd:e.to+1},s=JSON.stringify(i);if(this.screenFrameTileRangeHash!==s){this.screenFrameTileRangeHash=s,this.bufferContext.clearRect(0,0,this.buffer.width,this.buffer.height);for(const t of this.layers)n.cross(n.intRange(i.xStart,i.xEnd+1),n.intRange(i.yStart,i.yEnd+1)).map(([e,i])=>({x:e,y:i,tile:t.getByIndex(e,i)})).filter(({tile:t})=>!!t).forEach(({x:t,y:e,tile:{tile:s}})=>{this.tileSet.isAnimatedTile(s.name)?this.tileSet.drawAnim(s.name,this.bufferContext,t-i.xStart,e-i.yStart,60*this.level.time):this.tileSet.drawTile(s.name,this.bufferContext,t-i.xStart,e-i.yStart)})}}createBackgroundLayer(t){const e=document.createElement("canvas");return e.width=512+t,e.height=448+t,this.screenFrameTileRangeHash="",e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8),n=i(6);e.default=class{constructor(t){this.level=t,this.resolvedTiles=[],this.resolvedTiles=[],this.tileCollider=t.collider.tileCollider,this.tileSize=t.tilesize;const e=this.tileCollider.layers[0].getByIndex;this.tileCollider.layers[0].getByIndex=(t,i)=>(this.resolvedTiles.push({x:t,y:i}),e.call(this.tileCollider.layers[0],t,i))}drawEntityFrames(t,e){this.level.entities.forEach(i=>s.drawRect(t,i.bounds.left-e.pos.x,i.bounds.top-e.pos.y,i.size.x,i.size.y,"red"))}drawTileFrames(t,e){this.resolvedTiles.forEach(({x:i,y:n})=>s.drawRect(t,i*this.tileSize-e.pos.x,n*this.tileSize-e.pos.y,this.tileSize,this.tileSize,"blue"))}draw(t,e){n.debug&&(this.drawTileFrames(t,e),this.drawEntityFrames(t,e),this.resolvedTiles.length=0)}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=i(5),o=s(i(15)),r=s(i(19)),l=s(i(54)),u=i(2);e.default=class{constructor(t){this.tilesize=t,this.entities=new Set,this.gravity=new n.default(0,1500),this.time=0,this.collider=new l.default(this)}update(t,e){const i={deltaTime:t,level:this,collidable:this,camera:e};this.activateEntititesOnSight(i),this.getEntities(a.EntityState.ACTIVE).forEach(t=>t.update(i)),this.entities.forEach(t=>this.collider.entityCollider.check(t)),this.getEntities(a.EntityState.READY_TO_REMOVE).forEach(t=>this.entities.delete(t));const s=this.getEntities(a.EntityState.ACTIVE),n=Math.max(0,s.length-150);n>0&&(s.filter(t=>t.hasTrait(o.default)).slice(0,n).forEach(t=>t.state=a.EntityState.UNTRIGGERED),console.warn("removing "+n+" active Entities")),0===this.time&&this.init(),this.time+=t,this.getEntities(a.EntityState.ACTIVE).forEach(t=>{t.events.process(u.Names.playSFX,({name:t,blocking:e})=>this.audioBoard.playAudio(t,e)),t.events.process(u.Names.spawn,t=>{this.entities.add(t.entity)})})}getEntities(t){return[...this.entities].filter(e=>e.state===t)}activateEntititesOnSight(t){[...this.entities].filter(t=>t.hasTrait(o.default)).forEach(e=>e.getTrait(o.default).update(e,t))}findPlayer(){return[...this.entities].filter(t=>t.hasTrait(r.default)).map(t=>t.getTrait(r.default).player)[0]}init(){}checkX(t){this.collider.checkX(t)}checkY(t){this.collider.checkY(t)}set tiles(t){this.collider.tiles=t}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(55)),a=s(i(27));e.default=class{constructor(t){this.entityCollider=new n.default(t.entities),this.tileCollider=new a.default(t.tilesize)}checkX(t){this.tileCollider.checkX(t)}checkY(t){this.tileCollider.checkY(t)}set tiles(t){this.tileCollider.addGrid(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.entities=t}check(t){[...this.entities].filter(e=>t!==e).filter(e=>t.bounds.overlaps(e.bounds)).forEach(e=>t.collide(e))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);e.createPlatformTileHandler=function(){return{x:()=>{},y:(t,e)=>{t.bypassPlatform||t.vel.y>0&&t.bounds.bottom>e.y.from&&t.obstruct(s.Side.BOTTOM,e)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);e.createSolidTileHandler=function(){return{x:(t,e)=>{t.vel.x>0?t.bounds.right>e.x.from&&t.obstruct(s.Side.RIGHT,e):t.vel.x<0&&t.bounds.left<e.x.to&&t.obstruct(s.Side.LEFT,e)},y:(t,e)=>{t.vel.y>0?t.bounds.bottom>e.y.from&&t.obstruct(s.Side.BOTTOM,e):t.vel.y<0&&t.bounds.top<e.y.to&&t.obstruct(s.Side.TOP,e)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.notNull=function(t){return!!t},e.flatMap=function(t){return t.reduce((t,e)=>t.concat(e),[])}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(7);e.default=class{constructor(t){this.levelName=t}load(){return s(this,void 0,void 0,(function*(){const[t,e]=yield Promise.all([n.loadJson(`./levels/${this.levelName}.json`),n.loadJson("./levels/1-1.patterns.json")]);return t.patterns=e,t}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.layers=[]}draw(t,e,i){this.layers.forEach(s=>s.draw(t,e,i))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);e.createBrickTileHandler=function(){return{x:(t,e)=>{t.vel.x>0?t.bounds.right>e.x.from&&t.obstruct(s.Side.RIGHT,e):t.vel.x<0&&t.bounds.left<e.x.to&&t.obstruct(s.Side.LEFT,e)},y:(t,e,i)=>{t.vel.y>0?t.bounds.bottom>e.y.from&&t.obstruct(s.Side.BOTTOM,e):t.vel.y<0&&t.bounds.top<e.y.to&&(t.obstruct(s.Side.TOP,e),i.setByRange(e.x,e.y,void 0))}}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(14));e.createOnlyCrouchTileHandler=function(){return{x:(t,e)=>{},y:(t,e,i)=>{const s=t.getTrait(n.default);s&&(s.lockDown=!0)}}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(21),o=n(i(29)),r=n(i(66)),l=n(i(34)),u=n(i(36)),d=n(i(68));e.default=class{prepare(){return s(this,void 0,void 0,(function*(){const t=[d.default,l.default,u.default,o.default,r.default],e=yield Promise.all(t.map(t=>new t).map(t=>s(this,void 0,void 0,(function*(){return{name:t.name,factory:yield t.create()}}))));a.setEntityRepo(e.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:e.factory}),{}))}))}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(30),o=n(i(31)),r=i(7);e.default=class{constructor(t){this.name=t}load(){return s(this,void 0,void 0,(function*(){const t=yield r.loadJson(`./sprites/${this.name}.json`),e=yield r.loadImage(t.imageURL),i=new o.default(e,t.tileW,t.tileH);return t.frames&&t.frames.forEach(({name:t,rect:[e,s,n,a]})=>{i.define(t,e,s,n,a)}),t.animations&&t.animations.forEach(t=>{const e=a.createAnim(t.frames,t.frameLen);i.defineAnim(t.name,e)}),i}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.StompEvent=class{constructor(t){this.payload=t,this.name="stomp"}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=s(i(9)),o=s(i(0)),r=s(i(10)),l=s(i(33)),u=i(2);class d extends o.default{constructor(){super("cannonAI")}update(t,e){t.getTrait(l.default).direction=Math.sign(e.level.findPlayer().pos.x-t.pos.x)}}e.CannonBehavior=d;class c extends r.default{constructor(){super("cannon"),this.entityFac=()=>new a.default,this.size=new n.default(16,16),this.offset=new n.default(0,0),this.traits=()=>[new d,new l.default("bullet-bill",!0,2,t=>t.events.emit(new u.SfxEvent({name:"thwomp"})))]}routeFrame(){return null}}e.default=c},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(11)),a=s(i(12)),o=s(i(16));e.getTraits=function(t){return{physics:t.getTrait(a.default),gravity:t.getTrait(n.default),solid:t.getTrait(o.default)}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1)),a=s(i(9)),o=s(i(18)),r=s(i(17)),l=s(i(13)),u=s(i(4)),d=s(i(22)),c=s(i(10)),h=s(i(16)),f=s(i(11)),p=s(i(12)),m=s(i(14));class y extends c.default{constructor(){super("mario","mario"),this.entityFac=()=>new a.default,this.size=new n.default(16,24),this.offset=new n.default(0,0),this.traits=()=>[new h.default,new f.default(new n.default(0,750)),new p.default,new l.default,new o.default,new d.default,new u.default("dead",0),new m.default,new r.default]}routeFrame(t,e){const i=t.getTrait(o.default),s=t.getTrait(l.default);return t.getTrait(m.default).down?"crouch":s.falling?"jump":0!==i.distance&&0!==t.vel.x?Math.sign(t.vel.x)!==Math.sign(i.lastDir)?"break":e.getAnimation("run")(i.distance):"idle"}flipped(t){return-1==t.getTrait(o.default).lastDir}}e.default=y},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=s(i(17));function o(t,e,i){t.hasTrait(a.default)&&(t.getTrait(a.default).coins++,i.delete(e.x,e.y.from),t.events.emit(new n.SfxEvent({name:"coin",blocking:!1})))}e.createCoinTileHandler=function(){return{x:(t,e,i)=>{t.vel.x>0&&t.bounds.right>e.x.from&&o(t,e,i),t.vel.x<0&&t.bounds.left<e.x.to&&o(t,e,i)},y:(t,e,i)=>{t.vel.y>0&&t.bounds.bottom>e.y.from&&o(t,e,i),t.vel.y<0&&t.bounds.top<e.y.to&&o(t,e,i)}}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(30),o=n(i(38)),r=i(7);e.default=class{constructor(t){this.name=t}load(){return s(this,void 0,void 0,(function*(){const t=yield r.loadJson(`./sprites/${this.name}.json`),e=yield r.loadImage(t.imageURL),i=new o.default(e,t.tileW,t.tileH);return t.tiles&&t.tiles.forEach(({name:t,index:[e,s]})=>{i.defineTile(t,e,s)}),t.animations&&t.animations.forEach(t=>{const e=a.createAnim(t.frames,t.frameLen);i.defineAnim(t.name,e)}),i}))}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(7),o=n(i(72)),r=n(i(75));e.TiledMapLoader=class{constructor(t){this.path=t,this.directory=t.substr(0,this.path.lastIndexOf("/")+1)}load(){return s(this,void 0,void 0,(function*(){const t=yield a.loadXML(this.path);return this.map(t)}))}map(t){return s(this,void 0,void 0,(function*(){const e=t.getElementsByTagName("map")[0],i=e.getAttribute("tilewidth"),n=(e.getAttribute("tileheight"),e.getAttribute("renderorder"),yield Promise.all([...e.getElementsByTagName("tileset")].map(t=>({startId:parseInt(t.getAttribute("firstgid")),source:t.getAttribute("source")})).map(t=>s(this,void 0,void 0,(function*(){return Object.assign(Object.assign({},t),{tileset:yield new r.default(this.directory+t.source,t.startId).load()})}))))),a=[...e.getElementsByTagName("layer")].map(t=>({chunks:[...t.getElementsByTagName("data")[0].getElementsByTagName("chunk")].map(t=>({x:parseInt(t.getAttribute("x")),y:parseInt(t.getAttribute("y")),width:parseInt(t.getAttribute("width")),height:parseInt(t.getAttribute("height")),elements:t.textContent.split(",\n").map(t=>t.split(",").map(t=>parseInt(t)))})),id:parseInt(t.getAttribute("id")),name:t.getAttribute("name")})),o={};return o.spriteSheet=n[0].tileset.spriteSheet,o.layers=a,o.tileSize=parseInt(i),o.layers=a,o.matixes=this.createLevelSpec(o,n[0].tileset.tileMatrix),o}))}createLevelSpec(t,e){return(new o.default).createTiles(t,e)}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),a=s(i(73)),o=s(i(74));e.default=class{createTiles(t,e){const{layers:i}=t;return i.map(t=>{const i=new a.default;return t.chunks.forEach(t=>{n.cross(n.intRange(0,t.width),n.intRange(0,t.height)).forEach(([s,n])=>{const a=t.elements[s][n];0!==a&&this.setTile(i,a,e[a],n+t.x,s+t.y)})}),i})}setTile(t,e,i,s,n){const a=[];i&&i.properties.some(t=>"solid"===t.name&&!0===t.value)&&a.push("solid"),i&&i.properties.some(t=>"platform"===t.name&&!0===t.value)&&a.push("platform"),i&&i.properties.some(t=>"onlyCrouch"===t.name&&!0===t.value)&&a.push("onlyCrouch"),i&&i.properties.some(t=>"other"===t.name&&t.value.includes("respawn"))&&a.push("respawn"),t.set(s,n,new o.default(e+"",a))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.grid=[]}set(t,e,i){this.grid[t]||(this.grid[t]=[]),this.grid[t][e]=i}get(t,e){return this.grid[t]?this.grid[t][e]:void 0}stream(){const t=[];return this.forEach((e,i,s)=>t.push({x:e,y:i,value:s})),t}forEach(t){this.grid.forEach((e,i)=>{e.forEach((e,s)=>{t(i,s,e)})})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.name=t,this.types=e}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(7),o=n(i(38));e.default=class{constructor(t,e){this.path=t,this.idOffset=e,this.directory=t.substr(0,this.path.lastIndexOf("/")+1)}load(){return s(this,void 0,void 0,(function*(){const t=yield a.loadJson(this.path),e=yield a.loadImage(this.directory+t.image),i=new o.default(e,t.tilewidth,t.tileheight),s={};for(let e=0;e<t.tilecount;e++){const n=e%t.columns,a=Math.floor(e/t.columns);i.defineTile(`${e+this.idOffset}`,n,a),t.tiles&&(s[e+this.idOffset]=t.tiles[e])}return{spriteSheet:i,tileMatrix:s}}))}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(7),o=n(i(77));e.default=class{constructor(t){this.fontPath=t,this.CHARS=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"}load(){return s(this,void 0,void 0,(function*(){const t=yield a.loadImage(this.fontPath),e=t.width,i=new o.default(t,8,8);for(const[t,s]of[...this.CHARS].entries()){const n=8*t%e,a=8*Math.floor(8*t/e);i.define(s,n,a,8,8)}return i}))}}},function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(31));class a extends n.default{print(t,e,i,s){for(let n=0;n<t.length;n++){const a=t.charAt(n);this.draw(a,e,i+8*n,s)}}}e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.font=t,this.stats=e}draw(t){const e=this.stats();this.font.print("SANCHEZ",t,8,4),this.font.print(this.withZero(e.score,6),t,8,12),this.font.print(`@x${this.withZero(e.coins,2)}`,t,75,12),this.font.print("WORLD",t,150,4),this.font.print(e.level,t,158,12),this.font.print("TIME",t,208,4),this.font.print(this.withZero(e.time,3),t,216,12)}withZero(t,e){return t.toFixed().toString().padStart(e,"0")}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(7),o=n(i(80)),r=n(i(81));e.default=class{constructor(t,e){this.context=t,this.audioURL=e}load(){return s(this,void 0,void 0,(function*(){const t=yield a.loadJson(this.audioURL),e=new r.default(this.context),i=[...Object.keys(t.fx)];for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s)){const n=i[s],a=t.fx[n].url,r=yield new o.default(this.context,a).load();e.addAudio(n,r)}return e}))}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{l(s.next(t))}catch(t){a(t)}}function r(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.context=t,this.audioURL=e}load(){return s(this,void 0,void 0,(function*(){const t=yield fetch(this.audioURL),e=yield t.arrayBuffer();return this.context.decodeAudioData(e)}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.audioContext=t,this.buffers={},this.enabled=!0,this.isBlocked=!1,window.setAudio=t=>{this.enabled=t,t||(this.lastSource&&this.lastSource.stop(),this.bgmChannel&&this.bgmChannel.stop())}}addAudio(t,e){this.buffers[t]=e}playAudio(t,e){if(!this.enabled)return;if(this.isBlocked)return;this.lastSource&&this.lastSource.stop();const i=this.audioContext.createBufferSource();i.connect(this.audioContext.destination),i.buffer=this.buffers[t],i.start(0),e&&(this.isBlocked=!0,i.onended=()=>this.isBlocked=!1),this.lastSource=i}playBGM(t){if(!this.enabled)return;console.info(`Starting ${t} as BGM`),this.bgmChannel&&this.bgmChannel.stop();const e=this.audioContext.createBufferSource();e.connect(this.audioContext.destination),e.buffer=this.buffers[t],e.loop=!0,e.start(0),this.bgmChannel=e}}}]);