(()=>{"use strict";var t={3742:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.removeMouseControl=e.setupMouseControl=e.debugSettings=void 0,e.debugSettings={enabled:!1,hitboxesOnly:!1,showFPS:!1};let i=!1;e.setupMouseControl=function(t,s,n){e.debugSettings.enabled=!0,i||(t.addEventListener("contextmenu",(t=>t.preventDefault())),i=!0)},e.removeMouseControl=function(){e.debugSettings.enabled=!1}},2919:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5500),o=s(i(3797));class a extends o.default{constructor(){super("activateOnSight")}update(t,e){const i=e.camera.box,s=t.bounds;i.right>s.left&&i.left<s.right?t.state=n.EntityState.ACTIVE:t.state=n.EntityState.UNTRIGGERED}}e.default=a},1369:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(3426));e.default=class{constructor(t,e){this.name=t,this.spriteName=e}flipped(t){return t.vel.x<0}create(){return s(this,void 0,void 0,(function*(){const t=this.spriteName?yield new o.default(`entities/${this.spriteName}`).load():void 0;return()=>{const e=this.entityFac();return e.size.set(this.size.x,this.size.y),e.offset.set(this.offset.x,this.offset.y),e.addTraits(this.traits()),e.draw=i=>{if(!t)return;const s=this.routeFrame(e,t);s&&t.draw(s,i,0,0,this.flipped(e))},e}}))}}},9736:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.setEntityRepo=e.entityRepo=void 0,e.setEntityRepo=function(t){e.entityRepo=t}},5500:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.EntityState=void 0,(i=e.EntityState||(e.EntityState={}))[i.READY_TO_REMOVE=0]="READY_TO_REMOVE",i[i.ACTIVE=1]="ACTIVE",i[i.UNTRIGGERED=2]="UNTRIGGERED"},1921:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.traitRegistry=void 0;class i{constructor(){this.registry={}}addTrait(t){this.registry[t.name]=Object.getPrototypeOf(t).constructor}byName(t){return new this.registry[t]}}e.default=i,e.traitRegistry=new i},3797:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(1921);e.default=class{constructor(t){this.name=t,this.enabled=!0,s.traitRegistry.addTrait(this)}update(t,e){}obstruct(t,e,i){}collides(t,e){}}},3876:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.events=[]}emit(t){this.events.push(t)}process(t,e){this.events.filter((e=>e.name===t)).forEach((t=>e(t.payload))),this.events=this.events.filter((e=>e.name!==t))}}},4868:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SfxEvent=e.SpawnEvent=e.Names=void 0,e.Names={spawn:"spawn",playSFX:"playSFX"},e.SpawnEvent=class{constructor(t){this.payload=t,this.name=e.Names.spawn}},e.SfxEvent=class{constructor(t){this.payload=t,this.name=e.Names.playSFX}}},2200:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(6310),a=n(i(7693));e.default=class{constructor(t){this.fontPath=t,this.CHARS=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"}load(){return s(this,void 0,void 0,(function*(){const t=yield o.loadImage(this.fontPath),e=t.width,i=new a.default(t,8,8);for(const[t,s]of[...this.CHARS].entries()){const n=8*t%e,o=8*Math.floor(8*t/e);i.define(s,n,o,8,8)}return i}))}}},9387:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.KeyState=void 0,function(t){t[t.PRESSED=0]="PRESSED",t[t.RELEASED=1]="RELEASED"}(i=e.KeyState||(e.KeyState={})),e.default=class{constructor(){this.keyStates={},this.keyMap={}}addMapping(t,e){return this.keyMap[t]=e,this}handleEvent(t){const{code:e}=t;if(!this.keyMap[e])return;t.preventDefault();const s="keydown"===t.type?i.PRESSED:i.RELEASED;this.keyStates[e]!==s&&(this.keyStates[e]=s,this.keyMap[e](s))}listenTo(t){["keydown","keyup"].forEach((e=>t.addEventListener(e,(t=>this.handleEvent(t)))))}}},6310:function(t,e){var i=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.loadImage=e.loadJson=void 0,e.loadJson=function(t){return i(this,void 0,void 0,(function*(){return(yield fetch(t)).json()}))},e.loadImage=function(t){return new Promise((e=>{const i=new Image;i.addEventListener("load",(()=>{e(i)})),i.src=t}))}},8928:function(t,e){var i=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.context=t,this.audioURL=e}load(){return i(this,void 0,void 0,(function*(){const t=yield fetch(this.audioURL),e=yield t.arrayBuffer();return this.context.decodeAudioData(e)}))}}},4649:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(6310),a=n(i(8928)),r=n(i(8095));e.default=class{constructor(t,e){this.context=t,this.audioURL=e}load(){return s(this,void 0,void 0,(function*(){const t=yield o.loadJson(this.audioURL),e=new r.default(this.context),i=[...Object.keys(t.fx)];for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s)){const n=i[s],o=t.fx[n].url,r=yield new a.default(this.context,o).load();e.addAudio(n,r)}return e}))}}},8095:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.audioContext=t,this.buffers={},this.enabled=!0,this.isBlocked=!1,window.setAudio=t=>{this.enabled=t,t||(this.lastSource&&this.lastSource.stop(),this.bgmChannel&&this.bgmChannel.stop())}}addAudio(t,e){this.buffers[t]=e}playAudio(t,e){if(!this.enabled)return;if(this.isBlocked)return;this.lastSource&&this.lastSource.stop();const i=this.audioContext.createBufferSource();i.connect(this.audioContext.destination),i.buffer=this.buffers[t],i.start(0),e&&(this.isBlocked=!0,i.onended=()=>this.isBlocked=!1),this.lastSource=i}playBGM(t){if(!this.enabled)return;console.info(`Starting ${t} as BGM`),this.bgmChannel&&this.bgmChannel.stop();const e=this.audioContext.createBufferSource();e.connect(this.audioContext.destination),e.buffer=this.buffers[t],e.loop=!0,e.start(0),this.bgmChannel=e}}},3426:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(2014),a=n(i(9084)),r=i(6310);e.default=class{constructor(t){this.name=t}load(){return s(this,void 0,void 0,(function*(){const t=yield r.loadJson(`./sprites/${this.name}.json`),e=yield r.loadImage(t.imageURL),i=new a.default(e,t.tileW,t.tileH);return t.frames&&t.frames.forEach((({name:t,rect:[e,s,n,o]})=>{i.define(t,e,s,n,o)})),t.animations&&t.animations.forEach((t=>{const e=o.createAnim(t.frames,t.frameLen,!("loop"in t)||t.loop);i.defineAnim(t.name,e)})),i}))}}},1382:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(8140));e.default=class{constructor(t,e,i=new n.default(0,0)){this.pos=t,this.size=e,this.offset=i}overlaps(t){return this.bottom>t.top&&this.top<t.bottom&&this.left<t.right&&this.right>t.left}get bottom(){return this.pos.y+this.size.y+this.offset.y}set bottom(t){this.pos.y=t-(this.size.y+this.offset.y)}get top(){return this.pos.y+this.offset.y}set top(t){this.pos.y=t-this.offset.y}get left(){return this.pos.x+this.offset.x}set left(t){this.pos.x=t-this.offset.x}get right(){return this.pos.x+this.size.x+this.offset.x}set right(t){this.pos.x=t-(this.size.x+this.offset.x)}}},3823:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.random=e.intRange=e.cross=void 0,e.cross=function(t,e){return t.reduce(((t,i)=>t.concat(e.map((t=>[i,t])))),[])},e.intRange=function(t,e){return t>=e?[]:Array.from(Array(e-t).keys()).map((e=>e+t))},e.random=function(t){return Math.floor(t*Math.random())}},7373:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.grid=[]}set(t,e,i){this.grid[t]||(this.grid[t]=[]),this.grid[t][e]=i}get(t,e){return this.grid[t]?this.grid[t][e]:void 0}stream(){const t=[];return this.forEach(((e,i,s)=>t.push({x:e,y:i,value:s}))),t}forEach(t){this.grid.forEach(((e,i)=>{e.forEach(((e,s)=>{t(i,s,e)}))}))}}},8140:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}set(t,e){this.x=t,this.y=e}getScaledBy(t){return new i(this.x*t,this.y*t)}}e.default=i},8449:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.entities=t}check(t){[...this.entities].filter((e=>t!==e)).filter((e=>t.bounds.overlaps(e.bounds))).forEach((e=>t.collide(e)))}}},3224:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPlatformTileHandler=void 0;const s=i(8854);e.createPlatformTileHandler=function(){return{x:()=>{},y:(t,e)=>{t.bypassPlatform||t.vel.y>0&&t.bounds.bottom>e.y.from&&t.obstruct(s.Side.BOTTOM,e)}}}},366:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createSolidTileHandler=void 0;const s=i(8854);e.createSolidTileHandler=function(){return{x:(t,e)=>{0!==t.vel.x&&(t.vel.x>0?t.bounds.right>e.x.from&&t.obstruct(s.Side.RIGHT,e):t.bounds.left<e.x.to&&t.obstruct(s.Side.LEFT,e))},y:(t,e)=>{0!==t.vel.y&&(t.vel.y>0?t.bounds.bottom>e.y.from&&t.obstruct(s.Side.BOTTOM,e):t.bounds.top<e.y.to&&t.obstruct(s.Side.TOP,e))}}}},3306:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3823),o=i(1460),a=s(i(305));e.default=class{constructor(t,e){this.tiles=t,this.tilesize=e,this.math=new a.default(e)}get(t,e){return"number"==typeof t&&(t={from:t,to:t+1}),"number"==typeof e&&(e={from:e,to:e+1}),n.cross(this.math.toIndexRange(t),this.math.toIndexRange(e)).map((([t,e])=>this.getByIndex(t,e))).filter(o.notNull)}setByRange(t,e,i){n.cross(this.math.toIndexRange(t),this.math.toIndexRange(e)).forEach((([t,e])=>this.tiles.set(t,e,i)))}getByIndex(t,e){const i=this.tiles.get(t,e);return i?{tile:i,y:{from:e*this.tilesize,to:(e+1)*this.tilesize},x:{from:t*this.tilesize,to:(t+1)*this.tilesize}}:null}delete(t,e){"number"==typeof t&&(t={from:t,to:t+1}),"number"==typeof e&&(e={from:e,to:e+1}),this.setByRange(t,e,null)}}},44:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.addHandler=void 0;const n=i(3224),o=i(366),a=s(i(3306)),r={solid:o.createSolidTileHandler(),platform:n.createPlatformTileHandler()};e.addHandler=function(t,e){r[t]=e},e.default=class{constructor(t){this.tileSize=t,this.layers=[]}addGrid(t){this.layers.push(new a.default(t,this.tileSize))}checkX(t){const e=t.bounds;if(0===t.vel.x)return;const i=t.vel.x>0?e.right:e.left;for(const s of this.layers)s.get({from:i,to:i},{from:e.top,to:e.bottom}).forEach((e=>this.handle("x",t,e,s)))}checkY(t){const e=t.bounds;if(0===t.vel.y)return;const i=t.vel.y>0?e.bottom:e.top;for(const s of this.layers)s.get({from:e.left,to:e.right},{from:i,to:i}).forEach((e=>this.handle("y",t,e,s)))}handle(t,e,i,s){i.tile.types&&i.tile.types.forEach((n=>{const o=r[n];o&&o[t](e,i,s)}))}}},6282:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=s(i(8140));class a extends n.default{constructor(t=new o.default(0,1500)){super("gravity"),this.gravity=t}update(t,e){if(!this.enabled)return;const i=this.gravity.getScaledBy(e.deltaTime);t.vel.add(i)}}e.default=a},4414:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797));class o extends n.default{constructor(){super("physics")}update(t,e){e.collidable&&this.enabled&&(t.pos.x+=t.vel.x*e.deltaTime,e.collidable.checkX(t),t.pos.y+=t.vel.y*e.deltaTime,e.collidable.checkY(t))}}e.default=o},2823:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=i(8854);class a extends n.default{constructor(){super("solid")}obstruct(t,e,i){if(this.enabled)switch(e){case o.Side.BOTTOM:t.bounds.top=i.y.from-t.size.y,t.vel.y=0;break;case o.Side.RIGHT:t.bounds.left=i.x.from-t.size.x,t.vel.x=0;break;case o.Side.LEFT:t.bounds.left=i.x.to,t.vel.x=0;break;case o.Side.TOP:t.bounds.top=i.y.to,t.vel.y=0}}}e.default=a},1460:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.distinct=e.flatMap=e.notNull=void 0,e.notNull=function(t){return!!t},e.flatMap=function(t){return t.reduce(((t,e)=>t.concat(e)),[])},e.distinct=function(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}},2014:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createAnim=void 0,e.createAnim=function(t,e,i){return s=>{const n=Math.abs(s)/e;let o;return o=i?Math.floor(n%t.length):Math.floor(Math.min(n,t.length-1)),t[o]}}},4329:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.layers=[]}draw(t,e,i){this.layers.forEach((s=>s.draw(t,e,i)))}}},7693:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(9084));class o extends n.default{print(t,e,i,s){for(let n=0;n<t.length;n++){const o=t.charAt(n);this.draw(o,e,i+8*n,s)}}}e.default=o},7333:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.drawRect=void 0,e.drawRect=function(t,e,i,s,n,o,a={filled:!1}){if(a.filled)return t.fillStyle=o,void t.fillRect(Math.floor(e),Math.floor(i),Math.floor(s),Math.floor(n));t.strokeStyle=o,t.beginPath(),t.rect(Math.floor(e),Math.floor(i),Math.floor(s),Math.floor(n)),t.stroke()}},3225:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(4205);e.default=class{constructor(t){this.img=t,this.images={},this.images={},this.animations={},this.clearImage=s.createCanvas(1,1)}define(t,e,i,n,o,a=!1){const r=s.createCanvas(n,o),l=r.getContext("2d");a&&(l.scale(-1,1),l.translate(-n,0)),l.drawImage(this.img,Math.floor(e),Math.floor(i),n,o,0,0,n,o),this.isCanvasBlank(r)?this.images[t]=this.clearImage:this.images[t]=r}isCanvasBlank(t){return!t.getContext("2d").getImageData(0,0,t.width,t.height).data.some((t=>0!==t))}defineAnim(t,e){this.animations[t]=e}getImage(t){return this.images[t]}}},8829:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3742),n=i(7333);e.default=class{constructor(t){this.cameraToDraw=t}draw(t){s.debugSettings.enabled&&n.drawRect(t,this.cameraToDraw.box.left,this.cameraToDraw.box.top,this.cameraToDraw.size.x,this.cameraToDraw.size.y,"purple")}}},7647:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(4205);e.default=class{constructor(t,e=64,i=64){this.entities=t,this.width=e,this.height=i,this.createBuffer(e,i)}draw(t,e){[...this.entities].filter((t=>t.bounds.overlaps(e.box))).forEach((i=>{this.bufferContext.clearRect(0,0,this.width,this.height),i.draw(this.bufferContext),t.drawImage(this.buffer,Math.floor(i.pos.x-e.box.left),Math.floor(i.pos.y-e.box.top))}))}createBuffer(t,e){this.buffer=s.createCanvas(t,e),this.bufferContext=this.buffer.getContext("2d")}}},7721:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,i=8){this.img=t,this.y=e,this.scrollSpeed=i}draw(t,e){const i=Math.floor(-e.box.left/this.scrollSpeed%this.img.width);i+this.img.width<512&&t.drawImage(this.img,i+this.img.width,this.y),t.drawImage(this.img,i,this.y)}}},8326:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3742),n=i(7333);e.default=class{constructor(t=16,e=32,i=28){this.tilesize=t,this.width=e,this.height=i}draw(t,e){s.debugSettings.enabled&&n.drawRect(t,e.edge.x,e.edge.y,e.size.x-2*e.edge.x,e.size.y-2*e.edge.y,"green")}}},1579:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(7333);e.default=class{constructor(t){this.color=t,this.screenWidth=512,this.screenHeight=488}draw(t){s.drawRect(t,0,0,this.screenWidth,this.screenHeight,this.color,{filled:!0})}}},4205:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createCanvas=void 0,e.createCanvas=function(t,e){if("function"==typeof OffscreenCanvas)return new OffscreenCanvas(t,e);const i=document.createElement("canvas");return i.width=t,i.height=e,i}},9084:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3742),o=i(7333),a=s(i(3225));class r extends a.default{constructor(t,e,i){super(t),this.w=e,this.h=i}define(t,e,i,s,n){super.define(t,e,i,s,n,!1),super.define(t+"_switched",e,i,s,n,!0)}draw(t,e,i,s,a=!1){const r=this.getImage(t+(a?"_switched":""));r?e.drawImage(r,i,s):n.debugSettings.enabled?o.drawRect(e,i,s,this.w,this.h,"magenta",{filled:!0}):e.clearRect(i,s,this.w,this.h)}getAnimation(t){return this.animations[t]||(()=>"")}}e.default=r},1935:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3742),o=i(7333),a=s(i(3225));class r extends a.default{constructor(t,e,i){super(t),this.width=e,this.height=i,this.tilesize=i}defineTile(t,e,i){this.define(t,e*this.width,i*this.height,this.width,this.height)}isAnimatedTile(t){return!!this.animations[t]}drawAnim(t,e,i,s,n){const o=this.animations[t];o&&this.drawTile(o(n),e,Math.floor(i),Math.floor(s))}drawTile(t,e,i,s){this.draw(t,e,Math.floor(this.width*i),Math.floor(this.height*s))}draw(t,e,i,s){const a=this.getImage(t);a?e.drawImage(a,i,s):n.debugSettings.enabled?o.drawRect(e,i,s,this.width,this.height,"magenta",{filled:!0}):e.clearRect(i,s,this.width,this.height)}}e.default=r},6679:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SCREEN_SIZE=void 0,e.SCREEN_SIZE={width:512,height:448}},6592:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3742);e.default=class{constructor(t,e=1/60){this.updateFunc=t,this.deltaTime=e,this.lastTime=0,this.accumulatedTime=0,this.fps=0}enqueue(){this.fps++,requestAnimationFrame((t=>this.update(t)))}update(t){const e=(t-this.lastTime)/1e3;for(this.accumulatedTime+=e,this.accumulatedTime>1&&(this.accumulatedTime=1,console.warn("resolve sleeping"));this.accumulatedTime>this.deltaTime;)this.updateFunc(this.deltaTime),this.accumulatedTime-=this.deltaTime;this.lastTime=t,this.enqueue()}start(){this.enqueue(),this.showFps()}showFps(){setTimeout((()=>{s.debugSettings.showFPS&&console.log("FPS",this.fps),this.fps=0,this.showFps()}),1e3)}}},856:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1382)),o=s(i(8140)),a=i(6679);e.default=class{constructor(t=new n.default(new o.default(0,0),new o.default(a.SCREEN_SIZE.width,a.SCREEN_SIZE.height)),e=new o.default(a.SCREEN_SIZE.width,368)){this.totalMovementBounds=t,this.size=e,this.pos_=new o.default(0,0),this.edge=new o.default(240,64),this.pos_.set(t.left,t.top)}get box(){return new n.default(this.pos_,this.size)}get viewPort(){return this.totalMovementBounds}update(t,e){const i=t.bounds.right-this.box.right+this.edge.x,s=t.bounds.left-this.box.left-this.edge.x;this.pos_.x+=Math.max(i,Math.min(s,0));const n=t.bounds.bottom-this.box.bottom+this.edge.y,o=t.bounds.top-this.box.top-this.edge.y;this.pos_.y+=Math.max(n,Math.min(o,0)),this.pos_.set(Math.floor(Math.max(this.totalMovementBounds.left,Math.min(this.totalMovementBounds.right-this.size.x,this.pos_.x))),Math.floor(Math.max(this.totalMovementBounds.top,Math.min(this.totalMovementBounds.bottom-this.size.y,this.pos_.y))))}}},8854:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.Side=void 0,(i=e.Side||(e.Side={}))[i.TOP=0]="TOP",i[i.BOTTOM=1]="BOTTOM",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT"},305:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.tilesize=t}toIndex(t){return Math.floor(t/this.tilesize)}toIndexRange(t){const e=Math.ceil(t.to/this.tilesize)*this.tilesize,i=[];let s=t.from;do{i.push(this.toIndex(s)),s+=this.tilesize}while(s<e);return i}}},3922:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.name=t,this.types=e}}},6338:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(6460));!function(){s(this,void 0,void 0,(function*(){const t=new o.default("screen");yield t.start()}))}()},74:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5500),o=s(i(3876)),a=s(i(1382)),r=s(i(8140)),l=i(8854);e.default=class{constructor(){this.pos=new r.default(0,0),this.vel=new r.default(0,0),this.size=new r.default(16,16),this.offset=new r.default(0,0),this.lifeTime=0,this.state=n.EntityState.ACTIVE,this.spriteChanged=!1,this.bypassPlatform=!1,this.bounds=new a.default(this.pos,this.size,this.offset),this.traits={},this.standingOn=new Set,this.events=new o.default}collide(t){this.getTraits().forEach((e=>e.collides(this,t)))}update(t){this.getTraits().forEach((e=>e.update(this,t))),this.lifeTime+=t.deltaTime,this.getTraits().filter((t=>t.finalize)).forEach((t=>{t.finalize(),t.finalize=void 0})),this.standingOn.clear()}obstruct(t,e){t===l.Side.BOTTOM&&e.tile.types.forEach((t=>this.standingOn.add(t))),this.getTraits().forEach((i=>i.obstruct(this,t,e)))}addTrait(t){this.traits[t.name]=t}addTraits(t){t.forEach((t=>this.addTrait(t)))}getTrait(t){return this.traits[(new t).name]}hasTrait(t){return null!=this.traits[(new t).name]}removeTraitByName(t){return!!this.traits[t]&&(delete this.traits[t],!0)}draw(t){}getTraits(){return Object.keys(this.traits).map((t=>this.traits[t]))}}},8480:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=s(i(8140));class a extends n.default{constructor(){super("cantGoLeft"),this.disabledForReset=!1,this.posOnScreen=new o.default(0,0)}}e.default=a},7439:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5500),o=s(i(3797));class a extends o.default{constructor(t="dead",e=2){super("killable"),this.deathAnim=t,this.fadeoutTime=e,this.dead=!1,this.deadTime=0}kill(){this.dead||(this.finalize=()=>{this.dead=!0})}revive(t){this.dead=!1,this.deadTime=0,t.state=n.EntityState.ACTIVE}update(t,e){this.dead&&(this.deadTime+=e.deltaTime,-1!=this.fadeoutTime&&this.deadTime>this.fadeoutTime&&(t.state=n.EntityState.READY_TO_REMOVE))}}e.default=a},1216:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=s(i(8480)),a=s(i(7439));class r extends n.default{constructor(t){super("playerController"),this.level=t}setCheckpoint(t){this.checkPoint=t}setPlayer(t){this.player=t}update(){if(!this.level.entities.has(this.player)){const t=this.player.getTrait(a.default),e=this.player.getTrait(o.default);t.revive(this.player),e&&(e.disabledForReset=!0),this.player.pos.set(this.checkPoint.x*this.level.tilesize,this.checkPoint.y*this.level.tilesize),this.level.entities.add(this.player)}}}e.default=r},9623:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(8449)),o=s(i(44));e.default=class{constructor(t){this.entityCollider=new n.default(t.entities),this.tileCollider=new o.default(t.tilesize)}checkX(t){this.tileCollider.checkX(t)}checkY(t){this.tileCollider.checkY(t)}set tiles(t){this.tileCollider.addGrid(t)}}},2742:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(2919)),o=i(5500),a=i(4868),r=s(i(8140)),l=s(i(1216)),d=s(i(9623));e.default=class{constructor(t){this.tilesize=t,this.entities=new Set,this.gravity=new r.default(0,1500),this.time=0,this.collider=new d.default(this)}update(t,e){const i={deltaTime:t,level:this,collidable:this,camera:e};e.update(this.findPlayer(),t),this.activateEntititesOnSight(i),this.getEntities(o.EntityState.ACTIVE).forEach((t=>t.update(i))),this.entities.forEach((t=>this.collider.entityCollider.check(t))),this.getEntities(o.EntityState.READY_TO_REMOVE).forEach((t=>this.entities.delete(t)));const s=this.getEntities(o.EntityState.ACTIVE),r=Math.max(0,s.length-150);r>0&&(s.filter((t=>t.hasTrait(n.default))).slice(0,r).forEach((t=>t.state=o.EntityState.UNTRIGGERED)),console.warn("removing "+r+" active Entities")),0===this.time&&this.init(),this.time+=t,this.getEntities(o.EntityState.ACTIVE).forEach((t=>{t.events.process(a.Names.playSFX,(({name:t,blocking:e})=>this.audioBoard.playAudio(t,e))),t.events.process(a.Names.spawn,(t=>{this.entities.add(t.entity)}))}))}getEntities(t){return[...this.entities].filter((e=>e.state===t))}activateEntititesOnSight(t){[...this.entities].filter((t=>t.hasTrait(n.default))).forEach((e=>e.getTrait(n.default).update(e,t)))}findPlayer(){return[...this.entities].filter((t=>t.hasTrait(l.default))).map((t=>t.getTrait(l.default).player))[0]}init(){}checkX(t){this.collider.checkX(t)}checkY(t){this.collider.checkY(t)}set tiles(t){this.collider.tiles=t}}},5540:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(6310),a=n(i(4999));e.default=class{constructor(t){this.levelName=t}load(){return s(this,void 0,void 0,(function*(){const t=yield o.loadJson(`./levels/${this.levelName}.json`),e=yield new a.default(t.tiledMapPath).load();return Object.assign(Object.assign({},t),{tiledMap:e})}))}}},3325:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createBrickTileHandler=void 0;const s=i(8854);e.createBrickTileHandler=function(){return{x:(t,e)=>{t.vel.x>0?t.bounds.right>e.x.from&&t.obstruct(s.Side.RIGHT,e):t.vel.x<0&&t.bounds.left<e.x.to&&t.obstruct(s.Side.LEFT,e)},y:(t,e,i)=>{t.vel.y>0?t.bounds.bottom>e.y.from&&t.obstruct(s.Side.BOTTOM,e):t.vel.y<0&&t.bounds.top<e.y.to&&(t.obstruct(s.Side.TOP,e),i.setByRange(e.x,e.y,void 0))}}}},2046:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(3742),n=i(7333);e.default=class{constructor(t){this.level=t,this.resolvedTiles=[],this.resolvedTiles=[],this.tileCollider=t.collider.tileCollider,this.tileSize=t.tilesize;const e=this.tileCollider.layers[0].getByIndex;this.tileCollider.layers[0].getByIndex=(t,i)=>(s.debugSettings.enabled&&this.resolvedTiles.push({x:t,y:i}),e.call(this.tileCollider.layers[0],t,i))}drawEntityFrames(t,e){this.level.entities.forEach((i=>n.drawRect(t,i.bounds.left-e.box.left,i.bounds.top-e.box.top,i.size.x,i.size.y,"red")))}drawTileFrames(t,e){this.resolvedTiles.forEach((({x:i,y:s})=>n.drawRect(t,i*this.tileSize-e.box.left,s*this.tileSize-e.box.top,this.tileSize,this.tileSize,"blue")))}draw(t,e){s.debugSettings.enabled&&(this.drawTileFrames(t,e),this.drawEntityFrames(t,e),this.resolvedTiles.length=0)}}},6205:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3742),o=i(7333),a=i(4205),r=s(i(305));e.default=class{constructor(t,e){this.level=t,this.tileSet=e,this.layers=t.collider.tileCollider.layers,this.buffer=this.createBackgroundLayer(t.tilesize),this.bufferContext=this.buffer.getContext("2d"),this.math=new r.default(t.tilesize)}toRange(t,e){const i=this.math.toIndex(e),s=this.math.toIndex(t);return{from:s,to:i+s}}draw(t,e,i){this.redraw(this.toRange(e.box.left,e.size.x),this.toRange(e.box.top,e.size.y)),t.drawImage(this.buffer,-e.box.left%this.level.tilesize,-e.box.top%this.level.tilesize)}redraw(t,e){this.hasChanged(t,e)&&(this.bufferContext.clearRect(0,0,this.buffer.width,this.buffer.height),this.layers.forEach((i=>this.renderLayer(i,t,e))))}hasChanged(t,e){const i=JSON.stringify({rangeX:t,rangeY:e});return this.screenFrameTileRangeHash!==i&&(this.screenFrameTileRangeHash=i,!0)}renderLayer(t,e,i){for(let s=e.from;s<=e.to;s++)for(let o=i.from;o<=i.to;o++){const a=t.getByIndex(s,o);a&&(n.debugSettings.hitboxesOnly?this.renderHitbox(a.tile,s-e.from,o-i.from):this.renderTile(a.tile,s-e.from,o-i.from))}}renderTile(t,e,i){this.tileSet.isAnimatedTile(t.name)?this.tileSet.drawAnim(t.name,this.bufferContext,e,i,60*this.level.time):this.tileSet.drawTile(t.name,this.bufferContext,e,i)}renderHitbox(t,e,i){const s=this.tileSet.tilesize;t.types.includes("solid")&&(o.drawRect(this.bufferContext,s*e,s*i,s,s,"grey",{filled:!0}),o.drawRect(this.bufferContext,s*e,s*i,s,s,"black")),t.types.includes("platform")&&(o.drawRect(this.bufferContext,s*e,s*i,s,4,"grey",{filled:!0}),o.drawRect(this.bufferContext,s*e,s*i,s,4,"black"))}createBackgroundLayer(t){const e=a.createCanvas(512+t,448+t);return this.screenFrameTileRangeHash="",e}}},5199:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3742),o=s(i(8140)),a=s(i(856));class r extends a.default{constructor(t){super(),this.currentCamIndex=-1,this.cameras=t.map((t=>new a.default(t)))}get box(){return this.currentCam.box}get currentCam(){return this.cameras[this.currentCamIndex]}update(t,e){if(this.updateCurrentCam(t),this.currentCam.update(t,e),null!=this.transition){0==this.transition.delta&&(this.transition.targetPosition=this.currentCam.box.pos);const t=this.transition.get(1.5*e);this.currentCam.box.left=t.x,this.currentCam.box.top=t.y,this.transition.delta>=1&&(this.transition=null)}}updateCurrentCam(t){const e=this.cameras.map((t=>t.viewPort)).findIndex((e=>e.overlaps(t.bounds)));-1!=e?(e!=this.currentCamIndex&&(console.debug(`[camera] Switching cameras from ${this.currentCamIndex} to ${e}`),-1!==this.currentCamIndex&&(this.transition=new l(this.currentCam.box.pos,this.cameras[e].box.pos))),this.currentCamIndex=e):n.debugSettings.enabled&&(console.debug("[camera] no new Camera found!"),console.log(t.bounds),console.log(this.cameras.map((t=>t.box))))}}e.default=r;class l{constructor(t,e){this.currentPosition=t,this.targetPosition=e,this.delta=0}get(t){return this.delta+=t,this.delta>1&&(this.delta=1),new o.default(this.currentPosition.x*(1-this.delta)+this.targetPosition.x*this.delta,this.currentPosition.y*(1-this.delta)+this.targetPosition.y*this.delta)}}},7534:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(6592));e.default=class{constructor(t){this.context=t,this.scenes={},this.currentSceneName="loadingScene"}load(){return s(this,void 0,void 0,(function*(){yield this.loadingScene.load()}))}start(){new o.default((t=>{this.currentScene.update(t),this.currentScene.draw(this.context,t)})).start()}setScene(t,e=!0){return s(this,void 0,void 0,(function*(){e&&(console.info("[Scene Machine] switch to Loadingscreen"),this.currentSceneName="loadingScene");const i=this.scenes[t];i.loaded||(console.info(`[Scene Machine] loading Scene ${t}`),yield i.scene.load(),i.loaded=!0,console.info(`[Scene Machine] Scene ${t} loaded`)),yield i.scene.start(),this.currentSceneName=t}))}get currentScene(){return"loadingScene"===this.currentSceneName?this.loadingScene:this.scenes[this.currentSceneName].scene}addScenes(t){return t.forEach((t=>this.addScene(t))),this}addScene(t){const e=t();return e.isLoadingScene?this.loadingScene=e:this.scenes[e.name]={scene:e,loaded:!1},this}get size(){return Object.keys(this.scenes).length+(this.loadingScene?1:0)}}},6398:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(7373)),o=s(i(3922)),a=i(2041);e.default=class{constructor(t){this.tileProps=t,this.booleanTags=["solid","platform","onlyCrouch"]}create(t){const e=new n.default;if(a.isInfiniteLayer(t)&&t.chunks.forEach((t=>{for(let i=0;i<t.width;i++)for(let s=0;s<t.height;s++){const n=t.data[s*t.width+i];0!==n&&this.setTile(e,n,this.tileProps[n],i+t.x,s+t.y)}})),a.isFiniteLayer(t))for(let i=0;i<t.width;i++)for(let s=0;s<t.height;s++){const n=t.data[s*t.width+i];0!==n&&this.setTile(e,n,this.tileProps[n],i+t.x,s+t.y)}return e}setTile(t,e,i,s,n){const a=this.booleanTags.filter((t=>this.hasEnabled(i,t)));i&&i.properties.some((t=>"other"===t.name&&t.value.includes("respawn")))&&a.push("respawn"),t.set(s,n,new o.default(`${e}`,a))}hasEnabled(t,e){return t&&t.properties.some((t=>t.name===e&&!0===t.value))}}},4999:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(6310),a=n(i(1382)),r=n(i(8140)),l=i(1460),d=n(i(6398)),u=n(i(7308));e.default=class{constructor(t){this.path=t,this.loader=()=>o.loadJson(this.path),this.tilesetLoader=(t,e)=>new u.default(this.directory+t.source,t.firstgid).filteredBy(e).load(),this.directory=t.substr(0,this.path.lastIndexOf("/")+1)}load(){return s(this,void 0,void 0,(function*(){const t=yield this.loader();return this.map(t)}))}map(t){return s(this,void 0,void 0,(function*(){const e=t.tilewidth;e!==t.tileheight&&console.warn("tiles are not squared. May cause issues");const i=this.getUsedTileIds(t);console.log(`${i.length} Tiles required for stage`);const n=yield Promise.all([...t.tilesets].map((t=>s(this,void 0,void 0,(function*(){return this.tilesetLoader(t,i)})))));delete this.tilesetLoader;const o=this.merge(n);let a=this.getViewPorts(t);const r={tileset:o.tileset,tileSize:e,viewPorts:a};return r.layers=this.createTileMatrixes(t,o.tileMatrix),t.infinite?(r.width=t.width*t.layers[0].width,r.height=t.width*t.layers[0].height):(r.width=t.width,r.height=t.height),r}))}getUsedTileIds(t){return l.distinct(l.flatMap(t.layers.filter((t=>t.visible)).filter((t=>"tilelayer"===t.type)).map((t=>"chunks"in t?l.distinct(l.flatMap(t.chunks.map((t=>l.distinct(t.data))))):"data"in t?l.distinct(t.data):void 0))))}getViewPorts(t){const e=l.flatMap(t.layers.filter((t=>t.visible)).filter((t=>"objectgroup"===t.type)).map((t=>t.objects.map((t=>new a.default(new r.default(t.x,t.y),new r.default(t.width,t.height)))))));return 0==e.length?[new a.default(new r.default(0,0),new r.default(t.width*t.tilewidth,t.height*t.tileheight))]:e}createTileMatrixes(t,e){const i=new d.default(e);return t.layers.filter((t=>t.visible)).filter((t=>"tilelayer"===t.type)).map((t=>i.create(t)))}merge(t){return t.reduce(((t,e)=>{const i=t.tileset;return i.images=Object.assign(Object.assign({},i.images),e.tileset.images),{tileMatrix:Object.assign(Object.assign({},t.tileMatrix),e.tileMatrix),tileset:i}}))}}},7308:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(6310),a=n(i(1935));e.default=class{constructor(t,e){this.path=t,this.idOffset=e,this.loader=()=>o.loadJson(this.path),this.imageLoader=t=>o.loadImage(t),this.createTileSet=(t,e)=>new a.default(t,e.tilewidth,e.tileheight),this.directory=t.substr(0,this.path.lastIndexOf("/")+1)}filteredBy(t){return this.onlyRequiredIds=t,this}load(){return s(this,void 0,void 0,(function*(){const t=yield this.loader(),e=yield this.imageLoader(this.directory+t.image),i=this.createTileSet(e,t),s={};for(let e=0;e<t.tilecount;e++){const n=e+this.idOffset;if(this.onlyRequiredIds&&!this.onlyRequiredIds.includes(n))continue;const o=e%t.columns,a=Math.floor(e/t.columns);i.defineTile(`${n}`,o,a),t.tiles&&(s[e+this.idOffset]=t.tiles[e])}return this.finalize(),{tileset:i,tileMatrix:s}}))}finalize(){delete this.createTileSet,delete this.loader,delete this.onlyRequiredIds,delete this.imageLoader}}},2041:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isFiniteLayer=e.isInfiniteLayer=void 0,e.isInfiniteLayer=function(t){return"chunks"in t},e.isFiniteLayer=function(t){return"data"in t}},3815:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.addDebugToLevel=void 0;const s=i(3742),n=i(1921);e.addDebugToLevel=function(t){window&&(window.addTrait=e=>{t.findPlayer().addTraits([n.traitRegistry.byName(e)])},window.removeTrait=e=>{t.findPlayer().removeTraitByName(e)},window.testingCheatsEnabled=t=>{s.debugSettings.enabled=t},window.hitboxesOnly=t=>{s.debugSettings.hitboxesOnly=t})}},3905:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(9736),a=n(i(2077));e.default=class{prepare(){return s(this,void 0,void 0,(function*(){const t=[a.default],e=yield Promise.all(t.map((t=>new t)).map((t=>s(this,void 0,void 0,(function*(){return{name:t.name,factory:yield t.create()}})))));o.setEntityRepo(e.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.name]:e.factory})),{}))}))}}},2077:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1369)),o=s(i(8140)),a=s(i(6282)),r=s(i(4414)),l=s(i(2823)),d=s(i(74)),u=s(i(7439)),c=s(i(5240)),h=s(i(6231)),f=s(i(1075)),p=s(i(6627)),m=s(i(7177)),y=s(i(3686));class v extends n.default{constructor(){super("crow","crow"),this.entityFac=()=>new d.default,this.size=new o.default(16,32),this.offset=new o.default(8,0),this.traits=()=>[new l.default,new a.default(new o.default(0,750)),new r.default,new p.default,new f.default,new y.default,new u.default("dead",0),new c.default,new m.default]}routeFrame(t,e){const i=t.getTrait(f.default),s=t.getTrait(p.default),n=t.getTrait(c.default),o=t.getTrait(h.default);if(n.down)return"crouch";if(null==o?void 0:o.gliding)return"fall-1";if(s.falling){const i=t.vel.y<0?"jump":"fall";return e.getAnimation(i)(t.vel.y)}return 0!==i.distance&&0!==t.vel.x?e.getAnimation("run")(i.distance):"idle"}flipped(t){return-1==t.getTrait(f.default).facingDirection}}e.default=v},9209:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(1369)),o=s(i(8140)),a=s(i(74));class r extends n.default{constructor(){super("loading","loading"),this.entityFac=()=>new a.default,this.size=new o.default(32,32),this.offset=new o.default(0,0),this.traits=()=>[]}routeFrame(t,e){return e.getAnimation("loading")(60*t.lifeTime)}}e.default=r},5240:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=s(i(8140));class a extends n.default{constructor(){super("crouch"),this._down=!1,this.lockDown=!1,this.requestEnd=!1}update(t){this._down&&this.resetSize(t),this.requestEnd&&(this.lockDown||this.end(t)),this.lockDown=!1}end(t){this.memoSize&&(t.pos.y-=8,t.size.set(this.memoSize.x,this.memoSize.y),t.offset.set(this.memoOffset.x,this.memoOffset.y),this.memoSize=void 0,this.memoOffset=void 0),this._down=!1,this.requestEnd=!0}start(){this._down=!0,this.requestEnd=!1}cancel(){this.requestEnd=!0}get down(){return this._down}resetSize(t){this.memoSize||(this.memoSize=new o.default(t.size.x,t.size.y),this.memoOffset=new o.default(t.offset.x,t.offset.y),t.pos.y+=8,t.size.set(24,24),t.offset.set(0,0))}}e.default=a},6231:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=s(i(6282)),a=i(8854);class r extends n.default{constructor(){super("glide"),this.gliding=!1}start(){this.gliding=!0}cancel(){this.gliding=!1}update(t,e){const i=t.getTrait(o.default);this.gliding&&i&&this.enabled&&(t.vel.y=.95*i.gravity.y*e.deltaTime)}obstruct(t,e){switch(e){case a.Side.BOTTOM:case a.Side.TOP:this.cancel()}}}e.default=r},1075:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3742),o=s(i(3797)),a=i(4868),r=i(8854),l=s(i(7439)),d=s(i(5240)),u=s(i(6627));class c extends o.default{constructor(){super("go"),this.dirOfAppliedForce=0,this.acceleration=400,this.deceleration=300,this.distance=0,this.facingDirection=0,this.running=!1}get dragFactor(){return this.running?2e-4:5e-4}obstruct(t,e){e!==r.Side.LEFT&&e!==r.Side.RIGHT||(0!=this.distance&&t.events.emit(new a.SfxEvent({name:"bump"})),this.distance=0)}update(t,e){t.bounds.left<0&&(t.bounds.left=0);const i=t.getTrait(u.default),s=t.getTrait(l.default),o=t.getTrait(d.default);if(0!==this.dirOfAppliedForce&&i&&!i.falling&&(this.facingDirection=this.dirOfAppliedForce),o.down)return void this.decelToStand(t,e.deltaTime);if(s&&s.dead)return void t.vel.set(0,0);const a=Math.abs(t.vel.x);0!==this.dirOfAppliedForce?t.vel.x+=this.acceleration*this.dirOfAppliedForce*e.deltaTime:0!==t.vel.x?this.decelToStand(t,e.deltaTime):(n.debugSettings.enabled&&0!==this.distance&&console.log("Standing at",Math.round(t.pos.x/16),Math.round(t.pos.y/16)),this.distance=0);const r=this.dragFactor*t.vel.x*a;t.vel.x-=r,this.distance+=a*e.deltaTime}decelToStand(t,e){const i=Math.abs(t.vel.x),s=Math.min(i,this.deceleration*e);t.vel.x+=t.vel.x>0?-s:s}right(t){this.dirOfAppliedForce+=t?1:-1}left(t){this.dirOfAppliedForce-=t?1:-1}}e.default=c},6627:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=i(4868),a=i(8854),r=s(i(5240));class l extends n.default{constructor(){super("jump"),this.jumpHeight=2,this.duration=this.jumpHeight/12,this.velocity=200,this.engageTime=0,this.onGround=0,this.requestTime=0,this.gracePeriod=.1,this.time=0}start(){this.requestTime=this.gracePeriod,this.time=0}cancel(){this.engageTime=0,this.requestTime=0}update(t,e){const i=t.getTrait(r.default);if(this.requestTime>0){if(null==i?void 0:i.down)return t.standingOn.has("platform")&&(t.bypassPlatform=!0),void this.cancel();this.falling||(t.bypassPlatform=!0,this.engageTime=this.duration,this.requestTime=0,t.events.emit(new o.SfxEvent({name:"jump"}))),this.requestTime-=e.deltaTime}this.engageTime>0&&(t.bypassPlatform=!1,t.vel.y=-this.velocity,this.engageTime-=e.deltaTime);const s=Math.abs(t.vel.y);this.time+=s*e.deltaTime,this.onGround--}obstruct(t,e){e===a.Side.BOTTOM?(this.onGround=1,this.time=0):e===a.Side.TOP&&this.cancel()}get falling(){return this.onGround<0}}e.default=l},2845:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=i(4868);class a extends n.default{constructor(t){super("leveltimer"),this.totalTime=300,this.currentTime=0,this.hurried=!1,t&&(this.totalTime=t.estimateTime)}update(t,e){this.currentTime+=e.deltaTime,this.restTime<=100&&!this.hurried&&(this.hurried=!0,t.events.emit(new o.SfxEvent({name:"hurry",blocking:!0})))}get restTime(){return this.totalTime-this.currentTime}}e.default=a},7177:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797));class o extends n.default{constructor(){super("player"),this.lives=3,this.c=0,this.score=0}update(t){t.events.process("stomp",(()=>this.score+=100))}get coins(){return this.c}set coins(t){t>=100&&(this.lives++,t-=100,console.log("1-up")),this.c=t}}e.default=o},3686:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(i(3797)),o=i(4868),a=s(i(7439)),r=i(279);class l extends n.default{constructor(){super("stomper"),this.bounceSpeed=400,this.quereBounce=!1,this.stomped=!1}fromAbove(t,e){return t.vel.y>e.vel.y}collides(t,e){const i=e.getTrait(a.default);t.getTrait(a.default).finalize||t.getTrait(a.default).dead||i&&!i.dead&&this.fromAbove(t,e)&&(this.bounce(t,e),t.events.emit(new o.SfxEvent({name:"stomp"})),t.events.emit(new r.StompEvent({us:t,them:e})))}bounce(t,e){this.finalize=()=>{t.bounds.bottom=e.bounds.top,t.vel.y=-this.bounceSpeed}}}e.default=l},279:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StompEvent=void 0,e.StompEvent=class{constructor(t){this.payload=t,this.name="stomp"}}},6460:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(7534)),a=n(i(6174)),r=n(i(3190));e.default=class{constructor(t){this.canvasId=t,this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d")}start(){return s(this,void 0,void 0,(function*(){const t=new o.default(this.context).addScenes([()=>new a.default,()=>new r.default("transition"),()=>new r.default("forest-1")]);yield t.load(),t.start(),t.setScene("forest-1"),console.log("scenes running")}))}}},7813:function(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&s(e,t,i);return n(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(i(9387)),l=a(i(5240)),d=a(i(6231)),u=a(i(1075)),c=a(i(6627));e.default=function(t){const e=t.getTrait(u.default),i=t.getTrait(c.default),s=t.getTrait(l.default),n=t.getTrait(d.default),o=t=>t===r.KeyState.PRESSED;return(new r.default).addMapping("Space",(t=>{o(t)?n&&i.falling?n.start():i.start():n&&n.gliding?n.cancel():i.cancel()})).addMapping("KeyS",(e=>{o(e)?i.falling||s.start():s.cancel(),o(e)||(t.bypassPlatform=!1)})).addMapping("KeyD",(t=>e.right(o(t)))).addMapping("KeyA",(t=>e.left(o(t))))}},1788:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(9736),a=i(5500),r=i(6310),l=i(44),d=n(i(3306)),u=n(i(4329)),c=n(i(7647)),h=n(i(7721)),f=n(i(1579)),p=n(i(2742)),m=n(i(5540)),y=i(3325),v=n(i(2046)),_=n(i(6205)),g=n(i(3905)),w=i(4561);e.default=class{constructor(t){this.levelName=t}load(){var t;return s(this,void 0,void 0,(function*(){const e=yield new m.default(this.levelName).load();yield(new g.default).prepare();const i=e.tiledMap.tileset,n=new p.default(e.tiledMap.tileSize);n.name=this.levelName,n.width=e.tiledMap.width,n.height=e.tiledMap.height,e.entities&&e.entities.forEach((({name:t,pos:[e,s]})=>{o.entityRepo[t]().pos.set(e*i.tilesize,s*i.tilesize)}));const b=o.entityRepo.crow();b.state=a.EntityState.ACTIVE,n.tiles=e.tiledMap.layers[2],n.startPosition=e.startPosition,n.estimateTime=e.estimateTime,n.bgm=e.bgm,n.collider.tileCollider.layers=e.tiledMap.layers.map((t=>new d.default(t,n.tilesize)));const x=new u.default;return x.layers.push(new f.default("#6B88FE")),x.layers.push(...yield Promise.all(null===(t=e.parallax)||void 0===t?void 0:t.map((t=>s(this,void 0,void 0,(function*(){return new h.default(yield r.loadImage(t.img),t.y,t.speed)})))))),x.layers.push(new _.default(n,i)),x.layers.push(new c.default(n.entities)),x.layers.push(new v.default(n)),l.addHandler("brick",y.createBrickTileHandler()),l.addHandler("onlyCrouch",w.createOnlyCrouchTileHandler()),{level:n,player:b,renderer:x,viewPorts:e.tiledMap.viewPorts}}))}}},4561:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.createOnlyCrouchTileHandler=void 0;const n=s(i(5240));e.createOnlyCrouchTileHandler=function(){return{x:()=>{},y:t=>{const e=t.getTrait(n.default);e&&(e.lockDown=!0)}}}},2002:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(7333),n=i(6679);e.default=class{constructor(t,e){this.font=t,this.level=e}draw(t){s.drawRect(t,0,23*this.level.tilesize,n.SCREEN_SIZE.width,5*this.level.tilesize,"black",{filled:!0})}withZero(t,e){return t.toFixed().toString().padStart(e,"0")}}},6174:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(1382)),a=n(i(8140)),r=n(i(4329)),l=n(i(7647)),d=n(i(1579)),u=i(6679),c=n(i(856)),h=n(i(9209));e.default=class{constructor(){this.name="loadingScene",this.isLoadingScene=!0}load(){return s(this,void 0,void 0,(function*(){this.bg=new r.default,this.bg.layers.push(new d.default("#555b6d")),this.loadingAnimation=(yield(new h.default).create())(),this.loadingAnimation.pos.set(448,392);const t=new Set;t.add(this.loadingAnimation),this.bg.layers.push(new l.default(t))}))}start(){return s(this,void 0,void 0,(function*(){}))}update(t){this.loadingAnimation.lifeTime+=t}draw(t){this.bg.draw(t,new c.default(new o.default(new a.default(0,0),new a.default(u.SCREEN_SIZE.width,u.SCREEN_SIZE.height)),new a.default(u.SCREEN_SIZE.width,u.SCREEN_SIZE.height)),null)}}},3190:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(5500),a=n(i(2200)),r=n(i(4649)),l=n(i(8829)),d=n(i(8326)),u=n(i(74)),c=n(i(1216)),h=n(i(5199)),f=i(3815),p=n(i(2845)),m=n(i(7813)),y=n(i(1788)),v=n(i(2002));e.default=class{constructor(t){this.name=t,this.isLoadingScene=!1}createPlayerEnv(t,e){const i=new u.default,s=new c.default(e),n=new p.default(e);return i.state=o.EntityState.ACTIVE,t.pos.set(e.startPosition.x*e.tilesize,e.startPosition.y*e.tilesize),s.setPlayer(t),s.setCheckpoint(e.startPosition),i.addTraits([s,n]),i}load(){return s(this,void 0,void 0,(function*(){const{level:t,player:e,renderer:i,viewPorts:s}=yield new y.default(this.name).load(),n=new AudioContext,u=yield new r.default(n,"./sfx/audio.json").load(),c=yield new a.default("./img/font.png").load();m.default(e).listenTo(window);const p=new h.default(s),_=this.createPlayerEnv(e,t);e.state=o.EntityState.ACTIVE,t.entities.add(_),t.audioBoard=u,i.layers.push(new l.default(p),new d.default,new v.default(c,t)),this.camera=p,this.level=t,this.renderer=i,this.player=e,f.addDebugToLevel(t)}))}update(t){this.level.update(t,this.camera)}draw(t){this.renderer.draw(t,this.camera,this.player)}start(){return s(this,void 0,void 0,(function*(){}))}}}},e={};!function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,i),o.exports}(6338)})();