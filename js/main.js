(()=>{"use strict";var e={4899:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.FeatherEngine=t.KeyboardInput=void 0;const a=i(6837);t.FeatherEngine=a.default,s(i(2772),t);var r=i(3920);Object.defineProperty(t,"KeyboardInput",{enumerable:!0,get:function(){return r.KeyboardInput}}),s(i(7297),t),s(i(744),t),s(i(1653),t),s(i(5427),t),s(i(3692),t),s(i(6487),t),s(i(7946),t),s(i(2887),t),s(i(8059),t)},2772:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClearControlInputEvent=t.StashControlInputEvent=t.PopControlInputEvent=t.INPUT_CONTROL_TOPIC=void 0,t.INPUT_CONTROL_TOPIC="game-control-input",t.PopControlInputEvent=class{constructor(){this.topic=t.INPUT_CONTROL_TOPIC,this.payload="pop"}},t.StashControlInputEvent=class{constructor(){this.topic=t.INPUT_CONTROL_TOPIC,this.payload="stash"}},t.ClearControlInputEvent=class{constructor(){this.topic=t.INPUT_CONTROL_TOPIC,this.payload="clear"}}},3920:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardInput=t.KeyState=void 0;const n=i(6837),s=i(744),a=i(3692),r=i(2772);var o;!function(e){e[e.PRESSED=0]="PRESSED",e[e.RELEASED=1]="RELEASED"}(o=t.KeyState||(t.KeyState={}));class l{constructor(){this.keyStates={},this.keyStatesChanges={},this.keyListeners=[],this.registered=!1,n.default.eventBus.subscribe(r.INPUT_CONTROL_TOPIC,{receive:e=>{"stash"===e.payload&&this.stashKeyListeners(),"pop"===e.payload&&this.popKeyListeners(),"clear"===e.payload&&this.clearKeyListeners()}})}static get instance(){return l._instance||(l._instance=new l,s.GameLoop.register(l._instance)),l._instance}static addKeyListener(e){l.instance.addKeyListener(e)}clearKeyListeners(){Object.keys(this.keyStates).forEach((e=>{this.keyStates[e]==o.PRESSED&&this.keyListeners.forEach((t=>t.keyUp(e)))})),this.keyStates={},this.keyListeners.length=0,this.keyStatesChanges={}}static clearKeyListeners(){l.instance.clearKeyListeners()}stashKeyListeners(){l.keyListenerStash=[...l.instance.keyListeners],this.clearKeyListeners()}popKeyListeners(){this.clearKeyListeners(),l.instance.keyListeners=l.keyListenerStash}handleInput(){this.registered||(this.listenTo(window),this.registered=!0),Object.entries(this.keyStatesChanges).forEach((([e,t])=>{t==o.PRESSED?this.keyListeners.forEach((t=>t.keyDown(e))):this.keyListeners.forEach((t=>t.keyUp(e)))})),this.keyStatesChanges={},Object.entries(this.keyStates).filter((([,e])=>e===o.PRESSED)).forEach((([e])=>{this.keyListeners.forEach((t=>t.keyPressed(e)))}))}addKeyListener(e){this.keyListeners.push(e)}handleEvent(e){const{code:t,type:i}=e,n="keydown"===i?o.PRESSED:o.RELEASED;this.keyStates[t]!==n&&(this.keyStates[t]=n,this.keyStatesChanges[t]=n)}listenTo(e){(0,a.info)(this,"Register at window"),["keydown","keyup"].forEach((t=>{e.addEventListener(t,(e=>this.handleEvent(e)))}))}}t.KeyboardInput=l,l.keyListenerStash=[]},6837:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(8343),s=i(744),a=i(3692),r=i(6487),o=i(2887),l=i(4618);class c{constructor(){this.initialized=!1,this.config=null,this.renderer=null,this.debugSettings={enabled:!1,hitboxesOnly:!1,showFPS:!1}}static init(e){c.instance.init(e)}static start(){c.instance.start()}static get Renderer(){return c.instance.renderer}static getSaveDataSystem(){return void 0===this.saveDataSystem&&(this.saveDataSystem=new o.LocalStorageSaveDataSystem(new l.JSONSaveDataMarshaller)),this.saveDataSystem}static setSaveDataSystem(e){this.saveDataSystem=e}static get screenSize(){var e,t;const i=null===(e=c.instance.config)||void 0===e?void 0:e.width,n=null===(t=c.instance.config)||void 0===t?void 0:t.height;return{width:null!=i?i:0,height:null!=n?n:0}}static get debugSettings(){return c.instance.debugSettings}init(e){this.initialized?(0,a.warn)(this,"Engine was initialized already, new config will be ignored."):e?(this.config=e,this.renderer=new r.CanvasRenderer(e),this.initialized=!0):(0,a.warn)(this,"config is empty and will be ignored.")}start(){this.initialized?s.GameLoop.start():(0,a.error)(this,"Engine was not initialized, but tried to start. call `FeatherEngine.init(<config>)` first.")}}t.default=c,c.instance=new c,c.eventBus=new n.EventBus},7297:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PauseGameEvent=t.ResumeGameEvent=t.GAME_CONTROL_TOPIC=void 0,t.GAME_CONTROL_TOPIC="game-control",t.ResumeGameEvent=class{constructor(){this.topic=t.GAME_CONTROL_TOPIC,this.payload="resume"}},t.PauseGameEvent=class{constructor(){this.topic=t.GAME_CONTROL_TOPIC,this.payload="pause"}}},1653:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},744:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameLoop=void 0;const n=i(6837),s=i(3692),a=i(1227);class r{constructor(){this.onInput=[],this.onUpdate=[],this.onDraw=[],this.timer=null}static register(...e){r.instance.register(...e)}static start(){r.instance.start()}static cancel(){r.instance.cancel()}register(...e){e.forEach((e=>{let t=!1;"function"==typeof e.handleInput&&(this.onInput.push(e),t=!0),"function"==typeof e.update&&(this.onUpdate.push(e),t=!0),"function"==typeof e.draw&&(this.onDraw.push(e),t=!0),t||(0,s.info)(this,"Registration of listener failed")}))}start(){this.timer?(0,s.warn)(this,"There is already a timer, this one needs to be canceled"):((0,s.info)(this,"Starting GameLoop"),this.timer=new a.default((e=>this.update(e,n.default.Renderer.context))),this.timer.start())}update(e,t){this.onInput.forEach((e=>e.handleInput())),this.onUpdate.forEach((t=>t.update(e))),this.onDraw.forEach((e=>e.draw(t)))}cancel(){var e;null===(e=this.timer)||void 0===e||e.cancel(),this.timer=null}}t.GameLoop=r,r.instance=new r},1227:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(3692);t.default=class{constructor(e,t=1/60){this.updateFunc=e,this.deltaTime=t,this.fps=0,this.lastTime=0,this.accumulatedTime=0,this._fps=0,this.canceled=!1}update(e){const t=(e-this.lastTime)/1e3;for(this.accumulatedTime+=t,this.accumulatedTime>1&&(this.accumulatedTime=1,(0,n.warn)(this,"resolve sleeping"));this.accumulatedTime>this.deltaTime;)this.updateFunc(this.deltaTime),this.accumulatedTime-=this.deltaTime;this.lastTime=e,this.canceled||this.enqueue()}start(){this.enqueue(),this.updateFps()}cancel(){this.canceled=!0}enqueue(){this._fps++,requestAnimationFrame((e=>this.update(e)))}updateFps(){setTimeout((()=>{this.fps=this._fps,this._fps=0,this.updateFps()}),1e3)}}},5427:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=t.loadJson=void 0,t.loadJson=function(e){return i(this,void 0,void 0,(function*(){try{const t=yield fetch(e);if(200===t.status)return t.json()}catch(e){}return{}}))},t.loadImage=function(e){return i(this,void 0,void 0,(function*(){const t=new Image;return t.src=e,yield t.decode(),t}))}},3692:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.info=t.error=t.warn=t.debug=t.log=void 0,t.log=function(e,t){console.log(`[ðŸª¶-Engine:${e.constructor.name}]: ${t}`)},t.debug=function(e,t){console.debug(`[ðŸª¶-Engine:${e.constructor.name}]: ${t}`)},t.warn=function(e,t){console.warn(`[ðŸª¶-Engine:${e.constructor.name}]: ${t}`)},t.error=function(e,t){console.error(`[ðŸª¶-Engine:${e.constructor.name}]: ${t}`)},t.info=function(e,t){console.info(`[ðŸª¶-Engine:${e.constructor.name}]: ${t}`)}},2465:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4867);t.default=class{constructor(e,t,i=new n.default(0,0)){this.pos=e,this.size=t,this.offset=i}overlaps(e){return this.bottom>e.top&&this.top<e.bottom&&this.left<e.right&&this.right>e.left}get bottom(){return this.pos.y+this.size.y+this.offset.y}set bottom(e){this.pos.y=e-(this.size.y+this.offset.y)}get top(){return this.pos.y+this.offset.y}set top(e){this.pos.y=e-this.offset.y}get left(){return this.pos.x+this.offset.x}set left(e){this.pos.x=e-this.offset.x}get right(){return this.pos.x+this.size.x+this.offset.x}set right(e){this.pos.x=e-(this.size.x+this.offset.x)}}},9191:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.random=t.intRange=t.cross=void 0,t.cross=function(e,t){return e.reduce(((e,i)=>e.concat(t.map((e=>[i,e])))),[])},t.intRange=function(e,t){return e>=t?[]:Array.from(Array(t-e).keys()).map((t=>t+e))},t.random=function(e){return Math.floor(e*Math.random())}},4864:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.grid=[]}set(e,t,i){this.grid[e]||(this.grid[e]=[]),this.grid[e][t]=i}get(e,t){return this.grid[e]?this.grid[e][t]:void 0}forEach(e){this.grid.forEach(((t,i)=>{t.forEach(((t,n)=>{e(i,n,t)}))}))}}},4867:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}set(e,t){this.x=e,this.y=t}getScaledBy(e){return new i(this.x*e,this.y*e)}}t.default=i,i.UP=new i(0,-1),i.DOWN=new i(0,1),i.LEFT=new i(-1,0),i.RIGHT=new i(1,0)},6487:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasRenderer=void 0;class i{constructor({canvasId:e}){this.canvas=document.getElementById(e);const t=this.canvas.getContext("2d");this._context=t}get context(){return this._context}static createRenderContext(e,t){return i.createCanvas(e,t).getContext("2d")}static createCanvas(e,t){const i=document.createElement("canvas");return i.width=e,i.height=t,i}}t.CanvasRenderer=i},2887:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageSaveDataSystem=t.SaveDataSystem=void 0;class i{constructor(e){this.marshaller=e,this.currentData={}}pushData(e){this.currentData=Object.assign(Object.assign({},this.currentData),e)}getData(){return this.currentData}clearData(){this.currentData={}}}t.SaveDataSystem=i,t.LocalStorageSaveDataSystem=class extends i{constructor(){super(...arguments),this.storage=localStorage}loadCurrentData(e){const t=this.storage.getItem("save_"+e);this.currentData=null!==t?this.marshaller.unmarshal(t):{}}storeCurrentData(e){const t=this.marshaller.marshal(this.currentData);this.storage.setItem("save_"+e,t)}hasData(e){return!!this.storage.getItem("save_"+e)}}},4618:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JSONSaveDataMarshaller=void 0,t.JSONSaveDataMarshaller=class{marshal(e){return JSON.stringify(e)}unmarshal(e){return JSON.parse(e)}}},7946:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8059:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.Vector=t.Matrix=t.BoundingBox=void 0;const a=i(2465);t.BoundingBox=a.default;const r=i(4864);t.Matrix=r.default;const o=i(4867);t.Vector=o.default,s(i(9191),t)},6532:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),s(i(4478),t),s(i(1686),t),s(i(7851),t),s(i(5429),t),s(i(4605),t),s(i(2727),t),s(i(6570),t)},1686:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EntityPrefab=void 0;const s=i(4899),a=i(4264);t.EntityPrefab=class{constructor(e,t){this.name=e,this.spriteName=t,this.size=new s.Vector(0,0),this.offset=new s.Vector(0,0),this.traits=()=>[]}flipped(e){return e.vel.x<0}create(){return n(this,void 0,void 0,(function*(){const e=this.spriteName?yield new a.SpriteSheetLoader(`entities/${this.spriteName}`).load():void 0;return()=>{const t=this.entityFac();return t.size.set(this.size.x,this.size.y),t.offset.set(this.offset.x,this.offset.y),t.addTraits(this.traits()),t.draw=i=>{if(!e)return;const n=this.routeFrame(t,e);n&&e.draw(n,i,0,0,this.flipped(t))},t}}))}}},7851:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setEntityRepo=t.entityRepo=void 0,t.setEntityRepo=function(e){t.entityRepo=e}},5429:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EntityState=void 0,(i=t.EntityState||(t.EntityState={}))[i.READY_TO_REMOVE=0]="READY_TO_REMOVE",i[i.ACTIVE=1]="ACTIVE",i[i.UNTRIGGERED=2]="UNTRIGGERED"},4478:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Side=void 0,(i=t.Side||(t.Side={}))[i.TOP=0]="TOP",i[i.BOTTOM=1]="BOTTOM",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT"},2727:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traitRegistry=t.TraitRegistry=void 0;class i{constructor(){this.registry={}}addTrait(e){this.registry[e.name]=Object.getPrototypeOf(e).constructor}byName(e){return new this.registry[e]}}t.TraitRegistry=i,t.traitRegistry=new i},4605:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8343:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),s(i(5972),t),s(i(5243),t),s(i(9705),t),s(i(2147),t)},5972:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EventBus=void 0,t.EventBus=class{constructor(){this.receivers={}}publish(e){return i(this,void 0,void 0,(function*(){this.getTopicReceivers(e.topic).forEach((t=>new Promise((i=>i(t.receive(e))))))}))}getTopicReceivers(e){var t;return null!==(t=this.receivers[e])&&void 0!==t?t:[]}subscribe(e,t){this.receivers[e]||(this.receivers[e]=[]),this.receivers[e].push(t)}unsubscribe(e,t){this.receivers[e]&&(this.receivers[e]=this.receivers[e].filter((e=>e!==t)))}unsubscribeAll(e){this.receivers[e]&&delete this.receivers[e]}}},5243:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EventStack=void 0,t.EventStack=class{constructor(){this.eventStack={}}publish(e){return i(this,void 0,void 0,(function*(){this.eventStack[e.topic]||(this.eventStack[e.topic]=[]),this.eventStack[e.topic].push(e)}))}process(e,t){this.eventStack[e]&&(this.eventStack[e].forEach((e=>t.receive(e))),delete this.eventStack[e])}}},9705:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4264:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.mergeImageContainer=t.NineWaySpriteSheet=t.TileSet=t.SpriteSheet=t.ImageContainer=t.Font=void 0,s(i(9849),t),s(i(8677),t),s(i(3028),t),s(i(4545),t);const a=i(2133);t.Font=a.default;const r=i(2547);t.ImageContainer=r.default,Object.defineProperty(t,"mergeImageContainer",{enumerable:!0,get:function(){return r.mergeImageContainer}});const o=i(5626);t.NineWaySpriteSheet=o.default;const l=i(6592);t.SpriteSheet=l.default;const c=i(1441);t.TileSet=c.default},9849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAnim=void 0,t.createAnim=function(e,t,i){return n=>{const s=Math.abs(n)/t;let a;return a=i?Math.floor(s%e.length):Math.floor(Math.min(s,e.length-1)),e[a]}}},2133:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(6592);class s extends n.default{constructor(e,t,i){super(e,t,i,!1)}print(e,t,i,n){for(let s=0;s<e.length;s++){const a=e.charAt(s);this.draw(a,t,i+8*s,n)}}}t.default=s},8677:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRect=void 0,t.drawRect=function(e,t,i,n,s,a,r={filled:!1}){if(r.filled)return e.fillStyle=a,void e.fillRect(Math.floor(t),Math.floor(i),Math.floor(n),Math.floor(s));e.strokeStyle=a,e.beginPath(),e.rect(Math.floor(t),Math.floor(i),Math.floor(n),Math.floor(s)),e.stroke()}},2547:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeImageContainer=void 0;const n=i(4899);t.default=class{constructor(e,t=!1){if(this.img=e,this.flippable=t,this.ref=[],this.animations={},this.ref=[{img:e,pos:{}}],t){const t=n.CanvasRenderer.createRenderContext(e.width,e.height);t.scale(-1,1),t.translate(-e.width,0),t.drawImage(this.img,0,0),this.ref.push({img:t.canvas,pos:{}})}}define(e,t,i,s,a,r=!1){r?(this.flippable||(0,n.error)(this,"This imagecontainer is not flippable, however, a flipped tile was tried to defined."),this.ref[1].pos[e]={x:this.ref[1].img.width-s-t,y:i,width:s,height:a}):this.ref[0].pos[e]={x:t,y:i,width:s,height:a}}defineAnim(e,t){this.animations[e]=t}getImage(e){const t=this.ref.filter((t=>!!t.pos[e]))[0];if(t)return Object.assign({img:t.img},t.pos[e])}},t.mergeImageContainer=function(e,t){return e.animations=Object.assign(Object.assign({},e.animations),t.animations),e.ref=[...e.ref,...t.ref],e}},9538:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(2133);t.default=class{constructor(e){this.fontPath=e,this.CHARS=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"}load(){return n(this,void 0,void 0,(function*(){const e=yield this.loadImage(),t=e.width,i=this.createNewFont(e,8,8);for(const[e,n]of[...this.CHARS].entries()){const s=8*e%t,a=8*Math.floor(8*e/t);i.define(n,s,a,8,8)}return i}))}loadImage(){return n(this,void 0,void 0,(function*(){return(0,s.loadImage)(this.fontPath)}))}createNewFont(e,t,i){return new a.default(e,t,i)}}},1185:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(5626);t.default=class{constructor(e){this.name=e}load(){return n(this,void 0,void 0,(function*(){const e=yield this.loadImage();return new a.default(e,!1)}))}loadImage(){return n(this,void 0,void 0,(function*(){return yield(0,s.loadImage)(this.name)}))}}},581:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(9849),r=i(6592);t.default=class{constructor(e){this.name=e}load(){return n(this,void 0,void 0,(function*(){const e=yield this.loadSheetSpec(),t=yield this.loadImage(e),i=this.createNewSpriteSheet(t,e.tileW,e.tileH);return e.frames&&e.frames.forEach((({name:e,rect:[t,n,s,a]})=>{i.define(e,t,n,s,a)})),e.animations&&e.animations.forEach((e=>{var t;const n=(0,a.createAnim)(e.frames,e.frameLen,null===(t=null==e?void 0:e.loop)||void 0===t||t);i.defineAnim(e.name,n)})),i}))}loadImage(e){return n(this,void 0,void 0,(function*(){return yield(0,s.loadImage)(e.imageURL)}))}loadSheetSpec(){return n(this,void 0,void 0,(function*(){return(0,s.loadJson)(`./sprites/${this.name}.json`)}))}createNewSpriteSheet(e,t,i){return new r.default(e,t,i)}}},5626:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(8677),a=i(2547);class r extends a.default{constructor(e,t=!1){super(e,t),this.img=e,this.flippable=t;const i=e.width/3,n=e.height/3;this.define("nw",0,0,i,n),this.define("n",i,0,i,n),this.define("ne",2*i,0,i,n),this.define("w",0,n,i,n),this.define("c",i,n,i,n),this.define("e",2*i,n,i,n),this.define("sw",0,2*n,i,n),this.define("s",i,2*n,i,n),this.define("se",2*i,2*n,i,n),this.tileWidth=i,this.tileHeight=n}draw(e,t,i,a,r){for(let o=0;o<a;o+=this.tileWidth)for(let l=0;l<r;l+=this.tileHeight){const c=this.getDir(o,l,a-this.tileWidth,r-this.tileHeight),u=this.getImage(c);u?e.drawImage(u.img,u.x,u.y,u.width,u.height,o+t,l+i,u.width,u.height):n.FeatherEngine.debugSettings.enabled?(0,s.drawRect)(e,t,i,a,r,"magenta",{filled:!0}):e.clearRect(t,i,a,r)}}getDir(e,t,i,n){return[["nw","n","ne"],["w","c","e"],["sw","s","se"]][0==t?0:t==n?2:1][0==e?0:e==i?2:1]}}t.default=r},6592:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(8677),a=i(2547);class r extends a.default{constructor(e,t,i,n=!0){super(e,n),this.w=t,this.h=i}define(e,t,i,n,s){super.define(e,t,i,n,s,!1),this.flippable&&super.define(e+"_switched",t,i,n,s,!0)}draw(e,t,i,a,r=!1){const o=this.getImage(e+(r?"_switched":""));o?t.drawImage(o.img,o.x,o.y,o.width,o.height,i,a,o.width,o.height):n.FeatherEngine.debugSettings.enabled?(0,s.drawRect)(t,i,a,this.w,this.h,"magenta",{filled:!0}):t.clearRect(i,a,this.w,this.h)}getAnimation(e){return this.animations[e]||(()=>"")}}t.default=r},1441:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(8677),a=i(2547);class r extends a.default{constructor(e,t,i){super(e),this.width=t,this.height=i,this.tilesize=i}defineTile(e,t,i){this.define(e,t*this.width,i*this.height,this.width,this.height)}isAnimatedTile(e){return!!this.animations[e]}drawAnim(e,t,i,n,s){const a=this.animations[e];a&&this.drawTile(a(s),t,Math.floor(i),Math.floor(n))}drawTile(e,t,i,n){this.draw(e,t,Math.floor(this.width*i),Math.floor(this.height*n))}draw(e,t,i,a){const r=this.getImage(e);r?t.drawImage(r.img,r.x,r.y,r.width,r.height,i,a,r.width,r.height):n.FeatherEngine.debugSettings.enabled?(0,s.drawRect)(t,i,a,this.width,this.height,"magenta",{filled:!0}):t.clearRect(i,a,this.width,this.height)}}t.default=r},3028:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NineWaySpriteSheetLoader=t.SpriteSheetLoader=t.FontLoader=void 0;const n=i(9538);t.FontLoader=n.default;const s=i(1185);t.NineWaySpriteSheetLoader=s.default;const a=i(581);t.SpriteSheetLoader=a.default},4545:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},103:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.TiledMapLoader=t.TileMath=t.Tile=void 0;const a=i(7481);t.TiledMapLoader=a.default;const r=i(5141);t.Tile=r.default;const o=i(9005);t.TileMath=o.default,s(i(406),t)},50:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(182),a=i(5141);t.default=class{constructor(e){this.tileProps=e,this.booleanTags=["solid","platform","onlyCrouch","deadly"]}create(e){const t=new n.Matrix;return(0,s.isInfiniteLayer)(e)&&this.handleInfiniteLayer(e,t),(0,s.isFiniteLayer)(e)&&this.handleFiniteLayer(e,t),t}handleFiniteLayer(e,t){for(let i=0;i<e.width;i++)for(let n=0;n<e.height;n++){const s=e.data[n*e.width+i];0!==s&&this.setTile(t,s,this.tileProps[s],i+e.x,n+e.y)}}handleInfiniteLayer(e,t){e.chunks.forEach((e=>{for(let i=0;i<e.width;i++)for(let n=0;n<e.height;n++){const s=e.data[n*e.width+i];0!==s&&this.setTile(t,s,this.tileProps[s],i+e.x,n+e.y)}}))}setTile(e,t,i,n,s){const r=this.booleanTags.filter((e=>this.hasEnabled(i,e)));i&&i.properties.some((e=>"other"===e.name&&e.value.includes("respawn")))&&r.push("respawn"),e.set(n,s,new a.default(`${t}`,r))}hasEnabled(e,t){return e&&e.properties.some((e=>e.name===t&&!0===e.value))}}},7481:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(4264),r=i(6554),o=i(50),l=i(9684);t.default=class{constructor(e){this.path=e,this.loader=()=>(0,s.loadJson)(this.path),this.tilesetLoader=(e,t)=>new l.default(this.directory+e.source,e.firstgid).load(),this.directory=e.substr(0,this.path.lastIndexOf("/")+1)}load(){return n(this,void 0,void 0,(function*(){const e=yield this.loader();return this.map(e)}))}map(e){return n(this,void 0,void 0,(function*(){const t=e.tilewidth;t!==e.tileheight&&console.warn("tiles are not squared. May cause issues");const i=this.getUsedTileIds(e);console.log(`${i.length} Tiles required for stage`);const s=yield Promise.all([...e.tilesets].map((e=>n(this,void 0,void 0,(function*(){return this.tilesetLoader(e,i)}))))),a=this.merge(s),r=this.getViewPorts(e),o=this.getEntities(e),l={tileset:a.tileset,tileSize:t,viewPorts:r,entities:o};return l.layers=this.createTileMatrixes(e,a.tileMatrix),e.infinite?(l.width=e.width*e.layers[0].width,l.height=e.width*e.layers[0].height):(l.width=e.width,l.height=e.height),l}))}getUsedTileIds(e){const t=e.layers.filter((e=>e.visible)).filter((e=>"tilelayer"===e.type)).map((e=>"chunks"in e?(0,r.distinct)((0,r.flatMap)(e.chunks.map((e=>(0,r.distinct)(e.data))))):"data"in e?(0,r.distinct)(e.data):[]));return(0,r.distinct)((0,r.flatMap)(t))}getViewPorts(e){const t=(0,r.flatMap)(e.layers.filter((e=>e.visible)).filter((e=>"objectgroup"===e.type&&"ViewPorts"==e.name)).map((e=>e.objects.map((e=>new s.BoundingBox(new s.Vector(e.x,e.y),new s.Vector(e.width,e.height)))))));return 0==t.length?[new s.BoundingBox(new s.Vector(0,0),new s.Vector(e.width*e.tilewidth,e.height*e.tileheight))]:t}getEntities(e){return(0,r.flatMap)(e.layers.filter((e=>e.visible)).filter((e=>"objectgroup"===e.type&&"Entities"==e.name)).map((e=>e.objects.map((e=>Object.assign(Object.assign({},e),{prefabId:this.getProperty(e.properties,"entity_prefab")}))).filter((({prefabId:e})=>void 0!==e)).map((e=>({prefab:e.prefabId,position:{x:e.x,y:e.y}}))))))}getProperty(e,t){return e.filter((e=>e.name==t)).map((e=>e.value)).pop()}createTileMatrixes(e,t){const i=new o.default(t);return e.layers.filter((e=>e.visible)).filter((e=>"tilelayer"===e.type)).map((e=>({name:e.name,matrix:i.create(e),frontLayer:this.hasEnabled(e,"frontLayer"),dynamic:this.hasEnabled(e,"dynamic")})))}hasEnabled(e,t){return e&&e.properties.some((e=>e.name===t&&!0===e.value))}merge(e){return e.reduce(((e,t)=>({tileMatrix:Object.assign(Object.assign({},e.tileMatrix),t.tileMatrix),tileset:(0,a.mergeImageContainer)(e.tileset,t.tileset)})))}}},9684:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(4264);t.default=class{constructor(e,t){this.path=e,this.idOffset=t,this.loader=()=>(0,s.loadJson)(this.path),this.imageLoader=e=>(0,s.loadImage)(e),this.createTileSet=(e,t)=>new a.TileSet(e,t.tilewidth,t.tileheight),this.directory=e.substr(0,this.path.lastIndexOf("/")+1)}filteredBy(e){return this.onlyRequiredIds=e,this}load(){var e,t;return n(this,void 0,void 0,(function*(){const i=yield this.loader(),n=yield this.imageLoader(this.directory+i.image),s=this.createTileSet(n,i),r={};for(let n=0;n<i.tilecount;n++){const o=n+this.idOffset;if(this.onlyRequiredIds&&!this.onlyRequiredIds.includes(o))continue;const l=n%i.columns,c=Math.floor(n/i.columns);if(s.defineTile(`${o}`,l,c),i.tiles){r[n+this.idOffset]=i.tiles[n];const l=null!==(t=null===(e=i.tiles[n])||void 0===e?void 0:e.animation)&&void 0!==t?t:[];0!=l.length&&(console.debug("add 1 animation "+o),s.defineAnim(`${o}`,(0,a.createAnim)(l.map((e=>""+(e.tileid+this.idOffset))),l[0].duration/1e3,!0)))}}return{tileset:s,tileMatrix:r}}))}}},406:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),s(i(5496),t),s(i(7393),t)},5496:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7393:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},182:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFiniteLayer=t.isInfiniteLayer=void 0,t.isInfiniteLayer=function(e){return"chunks"in e},t.isFiniteLayer=function(e){return"data"in e}},6554:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.distinct=t.flatMap=void 0,t.flatMap=function(e){return e.reduce(((e,t)=>e.concat(t)),[])},t.distinct=function(e){return e.filter((function(e,t,i){return i.indexOf(e)===t}))}},5141:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.name=e,this.types=t}}},9005:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.tilesize=e}toIndex(e){return Math.floor(e/this.tilesize)}toIndexRange(e){const t=Math.ceil(e.to/this.tilesize)*this.tilesize,i=[];let n=e.from;do{i.push(this.toIndex(n)),n+=this.tilesize}while(n<t);return i}}},3731:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(6532),a=n(i(3330));class r extends a.default{constructor(){super("activateOnSight")}update(e,t){const i=t.camera.box,n=e.bounds;i.right>n.left&&i.left<n.right?e.state=s.EntityState.ACTIVE:e.state=s.EntityState.UNTRIGGERED}}t.default=r},580:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpawnEvent=t.Names=void 0,t.Names={spawn:"spawn"},t.SpawnEvent=class{constructor(e){this.payload=e,this.topic=t.Names.spawn}}},3330:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(6532);t.default=class{constructor(e){this.name=e,this.enabled=!0,n.traitRegistry.addTrait(this)}update(e,t){}obstruct(e,t,i){}collides(e,t){}}},9017:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LEVEL_COLLIDER=void 0;const s=n(i(1609)),a=n(i(9763));t.LEVEL_COLLIDER=new class{checkX(e,t){t instanceof a.default&&new s.default(t).checkX(e)}checkY(e,t){t instanceof a.default&&new s.default(t).checkY(e)}check(e,t){t instanceof a.default&&new s.default(t).check(e)}}},4481:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(103),a=i(8564);t.default=class{constructor(e,t){this.tiles=e,this.tilesize=t,this.math=new s.TileMath(t)}get(e,t){return"number"==typeof e&&(e={from:e,to:e+1}),"number"==typeof t&&(t={from:t,to:t+1}),(0,n.cross)(this.math.toIndexRange(e),this.math.toIndexRange(t)).map((([e,t])=>this.getByIndex(e,t))).filter(a.notNull)}setByRange(e,t,i){(0,n.cross)(this.math.toIndexRange(e),this.math.toIndexRange(t)).forEach((([e,t])=>this.tiles.matrix.set(e,t,i)))}getByIndex(e,t){const i=this.tiles.matrix.get(e,t);return i?{tile:i,y:{from:t*this.tilesize,to:(t+1)*this.tilesize},x:{from:e*this.tilesize,to:(e+1)*this.tilesize}}:null}delete(e,t){"number"==typeof e&&(e={from:e,to:e+1}),"number"==typeof t&&(t={from:t,to:t+1}),this.setByRange(e,t,null)}get name(){return this.tiles.name}}},6713:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LEVEL_RENDERER=void 0,t.LEVEL_RENDERER=new class{constructor(){this.layers=[]}render(e,t){this.layers.forEach((i=>i.draw(e,t)))}addLayer(e){this.layers.push(e)}}},2013:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.levelTraits=[],this.levelLayer=[],this.entities=new Set}update(e){this.levelTraits.forEach((t=>t.update(this,e)))}}},9223:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.entities=e}check(e){[...this.entities].filter((t=>e!==t)).filter((t=>e.bounds.overlaps(t.bounds))).forEach((t=>e.collide(t)))}}},5641:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlatformTileHandler=void 0;const n=i(6532);t.createPlatformTileHandler=function(){return{x:()=>{},y:(e,t)=>{e.bypassPlatform||e.vel.y>0&&e.bounds.bottom>t.y.from&&e.obstruct(n.Side.BOTTOM,t)}}}},2238:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSolidTileHandler=void 0;const n=i(6532);t.createSolidTileHandler=function(){return{x:(e,t)=>{0!==e.vel.x&&(e.vel.x>0?e.bounds.right>t.x.from&&e.obstruct(n.Side.RIGHT,t):e.bounds.left<t.x.to&&e.obstruct(n.Side.LEFT,t))},y:(e,t)=>{0!==e.vel.y&&(e.vel.y>0?e.bounds.bottom>t.y.from&&e.obstruct(n.Side.BOTTOM,t):e.bounds.top<t.y.to&&e.obstruct(n.Side.TOP,t))}}}},343:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addHandler=void 0;const n=i(5641),s={solid:(0,i(2238).createSolidTileHandler)(),platform:(0,n.createPlatformTileHandler)()};t.addHandler=function(e,t){s[e]=t},t.default=class{constructor(e,t){this.level=e,this.tileSize=t}checkX(e){const t=e.bounds;if(0===e.vel.x)return;const i=e.vel.x>0?t.right:t.left;for(const n of this.level.levelLayer)n.get({from:i,to:i},{from:t.top,to:t.bottom}).forEach((t=>this.handle("x",e,t,n)))}checkY(e){const t=e.bounds;if(0===e.vel.y)return;const i=e.vel.y>0?t.bottom:t.top;for(const n of this.level.levelLayer)n.get({from:t.left,to:t.right},{from:i,to:i}).forEach((t=>this.handle("y",e,t,n)))}handle(e,t,i,n){i.tile.types&&i.tile.types.forEach((a=>{const r=s[a];r&&r[e](t,i,n)}))}}},7448:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=n(i(3330));class r extends a.default{constructor(e=new s.Vector(0,1500)){super("gravity"),this.gravity=e}update(e,t){const i=this.gravity.getScaledBy(t.deltaTime);e.vel.add(i)}}t.default=r},6336:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(9017),a=n(i(3330));class r extends a.default{constructor(){super("physics")}update(e,t){this.enabled&&(e.pos.x+=e.vel.x*t.deltaTime,s.LEVEL_COLLIDER.checkX(e,t.level),e.pos.y+=e.vel.y*t.deltaTime,s.LEVEL_COLLIDER.checkY(e,t.level))}}t.default=r},7567:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(6532),a=n(i(3330));class r extends a.default{constructor(){super("solid")}obstruct(e,t,i){if(this.enabled)switch(t){case s.Side.BOTTOM:e.bounds.top=i.y.from-e.size.y,e.vel.y=0;break;case s.Side.RIGHT:e.bounds.left=i.x.from-e.size.x,e.vel.x=0;break;case s.Side.LEFT:e.bounds.left=i.x.to,e.vel.x=0;break;case s.Side.TOP:e.bounds.top=i.y.to,e.vel.y=0}}}t.default=r},8564:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notNull=void 0,t.notNull=function(e){return!!e}},731:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{constructor(e=new n.BoundingBox(new n.Vector(0,0),new n.Vector(n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height)),t=new n.Vector(n.FeatherEngine.screenSize.width,368)){this.totalMovementBounds=e,this.size=t,this.pos_=new n.Vector(0,0),this.edge=new n.Vector(240,64),this.pos_.set(e.left,e.top)}get box(){return new n.BoundingBox(this.pos_,this.size)}get viewPort(){return this.totalMovementBounds}update(e,t){const i=e.bounds.right-this.box.right+this.edge.x,n=e.bounds.left-this.box.left-this.edge.x;this.pos_.x+=Math.max(i,Math.min(n,0));const s=e.bounds.bottom-this.box.bottom+this.edge.y,a=e.bounds.top-this.box.top-this.edge.y;this.pos_.y+=Math.max(s,Math.min(a,0)),this.pos_.set(Math.floor(Math.max(this.totalMovementBounds.left,Math.min(this.totalMovementBounds.right-this.size.x,this.pos_.x))),Math.floor(Math.max(this.totalMovementBounds.top,Math.min(this.totalMovementBounds.bottom-this.size.y,this.pos_.y))))}}},8393:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{constructor(e,t=64,i=64){this.entities=e,this.width=t,this.height=i,this.createBuffer(t,i)}draw(e,t){const{camera:i}=t;[...this.entities].filter((e=>e.bounds.overlaps(i.box))).forEach((t=>{this.bufferContext.clearRect(0,0,this.width,this.height),t.draw(this.bufferContext),e.drawImage(this.buffer,Math.floor(t.pos.x-i.box.left),Math.floor(t.pos.y-i.box.top))}))}createBuffer(e,t){this.bufferContext=n.CanvasRenderer.createRenderContext(e,t),this.buffer=this.bufferContext.canvas}}},8792:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SingleColorLayer=t.ParallaxLayer=t.EntityLayer=void 0;const s=n(i(8393));t.EntityLayer=s.default;const a=n(i(8411));t.ParallaxLayer=a.default;const r=n(i(4786));t.SingleColorLayer=r.default},8411:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{constructor(e,t,i=8){this.img=e,this.y=t,this.scrollSpeed=i}draw(e,t){const{camera:i}=t,s=Math.floor(-i.box.left/this.scrollSpeed%this.img.width);s+this.img.width<n.FeatherEngine.screenSize.width&&e.drawImage(this.img,s+this.img.width,this.y),e.drawImage(this.img,s,this.y)}}},4786:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(4264);t.default=class{constructor(e){this.color=e}draw(e){(0,s.drawRect)(e,0,0,n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height,this.color,{filled:!0})}}},2006:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899);class a{constructor(){this.scenes={},this.currentSceneName="loadingScene",a.INSTANCE=this}load(){return n(this,void 0,void 0,(function*(){yield this.loadingScene.load()}))}start(){s.GameLoop.register({update:e=>{this.currentScene.update(e)}},{draw:e=>{this.currentScene.draw(e)}}),s.FeatherEngine.init({canvasId:"screen",width:512,height:448}),s.FeatherEngine.start()}setScene(e,t=!0,i=!1){return n(this,void 0,void 0,(function*(){t&&((0,s.info)(this,"Switch to Loadingscreen"),this.currentSceneName="loadingScene");const n=this.scenes[e];!i&&n.loaded||((0,s.info)(this,`Loading Scene ${e}`),yield n.scene.load(),n.loaded=!0,(0,s.info)(this,`Scene ${e} loaded`)),yield n.scene.start(),this.currentSceneName=e}))}get currentScene(){return"loadingScene"===this.currentSceneName?this.loadingScene:this.scenes[this.currentSceneName].scene}addScenes(e){return e.forEach((e=>this.addScene(e))),this}addScene(e){const t=e();return t.isLoadingScene?this.loadingScene=t:this.scenes[t.name]={scene:t,loaded:!1},this}get size(){return Object.keys(this.scenes).length+(this.loadingScene?1:0)}}t.default=a},3376:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioBoardLoader=t.AudioBoard=void 0,s(i(9387),t);const r=a(i(5128));t.AudioBoard=r.default;const o=a(i(3095));t.AudioBoardLoader=o.default},304:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioEventHandler=void 0;const r=i(4899),o=a(i(9387));t.AudioEventHandler=class{constructor(e){this.audioBoard=e,r.FeatherEngine.eventBus.subscribe(o.PLAY_SFX_TOPIC,{receive:e=>{const{name:t,blocking:i,position:n}=e.payload;this.audioBoard.playAudio(t,i,n)}}),r.FeatherEngine.eventBus.subscribe(o.PLAY_BGM_TOPIC,{receive:e=>{const{name:t}=e.payload;this.audioBoard.playBGM(t)}}),r.FeatherEngine.eventBus.subscribe(o.SET_VOLUME_BGM,{receive:e=>{const{value:t}=e.payload;this.audioBoard.setBGMVolume(t)}}),r.FeatherEngine.eventBus.subscribe(o.SET_VOLUME_SFX,{receive:e=>{const{value:t}=e.payload;this.audioBoard.setSfxVolume(t)}}),r.FeatherEngine.eventBus.subscribe(o.SET_VOLUME_MASTER,{receive:e=>{const{value:t}=e.payload;this.audioBoard.setMasterVolume(t)}})}}},7368:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.context=e,this.audioURL=t}load(){return i(this,void 0,void 0,(function*(){const e=yield fetch(this.audioURL),t=yield e.arrayBuffer();return this.context.decodeAudioData(t)}))}}},3095:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(4899),r=s(i(7368)),o=s(i(5128));t.default=class{constructor(e){this.audioURL=e}load(){return n(this,void 0,void 0,(function*(){const e=yield(0,a.loadJson)(this.audioURL),t=new o.default,i=[...Object.keys(e.fx)];for(const n in i)if(Object.prototype.hasOwnProperty.call(i,n)){const s=i[n],a=e.fx[s].url,o=yield new r.default(t.audioContext,a).load();t.addAudio(s,o)}return t}))}}},5128:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(304);class a{constructor(e){this.audioContext=e,this.volume=1,this.gainNode=this.audioContext.createGain()}setVolume(e){const t=r(e,this.volume);(0,n.log)(this,"Set BGM Volume to "+t),this.volume=t,this.gainNode.gain.value=this.volume}}function r(e,t){let i;return"string"==typeof e?(console.log(e,parseFloat(e)),i=parseFloat(e)+t):i=e,Math.max(0,Math.min(1,i))}t.default=class{constructor(){this.buffers={},this.enabled=!0,this.isBlocked=!1,this.onlyOneTrack=!1,this.sfxVolume=1,this.audioContext=new AudioContext,new s.AudioEventHandler(this),this.masterAudioLayer=new a(this.audioContext),this.masterAudioLayer.gainNode.connect(this.audioContext.destination),this.bgmLayer=new a(this.audioContext),window.setAudio=e=>{this.enabled=e,e||(this.lastSource&&this.lastSource.stop(),this.bgmChannel&&this.bgmChannel.stop())}}setSfxVolume(e){const t=r(e,this.sfxVolume);(0,n.log)(this,"Set BGM Volume to "+t),this.sfxVolume=t}setBGMVolume(e){this.bgmLayer.setVolume(e)}setMasterVolume(e){this.masterAudioLayer.setVolume(e)}addAudio(e,t){this.buffers[e]=t}playAudio(e,t,i){if(console.info(`Starting ${e} as Sfx`),!this.enabled)return;if(this.isBlocked)return;this.lastSource&&this.onlyOneTrack&&this.lastSource.stop();const n=this.audioContext.createBufferSource(),s=this.audioContext.createGain();if(Math.abs(i)>3)return;Math.abs(i)>1?s.gain.value=this.sfxVolume/(i*i):s.gain.value=this.sfxVolume;const a={pan:i},r=new StereoPannerNode(this.audioContext,a);n.connect(s).connect(r).connect(this.masterAudioLayer.gainNode),n.buffer=this.buffers[e],n.start(0),t&&(this.isBlocked=!0,n.onended=()=>this.isBlocked=!1),this.lastSource=n}playBGM(e){if(!this.enabled)return;console.info(`Starting ${e} as BGM`),this.bgmChannel&&this.bgmChannel.stop();const t=this.audioContext.createBufferSource();t.connect(this.bgmLayer.gainNode).connect(this.masterAudioLayer.gainNode),t.buffer=this.buffers[e],t.loop=!0,t.start(0),this.bgmChannel=t}}},9387:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SetSFXVolumeEvent=t.SetBGMVolumeEvent=t.SetMasterVolumeEvent=t.PlayBGMEvent=t.PlaySFXEvent=t.SET_VOLUME_SFX=t.SET_VOLUME_BGM=t.SET_VOLUME_MASTER=t.PLAY_BGM_TOPIC=t.PLAY_SFX_TOPIC=void 0,t.PLAY_SFX_TOPIC="playSFX",t.PLAY_BGM_TOPIC="playBGM",t.SET_VOLUME_MASTER="setVolumeMASTER",t.SET_VOLUME_BGM="setVolumeBGM",t.SET_VOLUME_SFX="setVolumeSFX",t.PlaySFXEvent=class{constructor(e){this.payload=e,this.topic=t.PLAY_SFX_TOPIC}},t.PlayBGMEvent=class{constructor(e){this.payload=e,this.topic=t.PLAY_BGM_TOPIC}},t.SetMasterVolumeEvent=class{constructor(e){this.payload=e,this.topic=t.SET_VOLUME_MASTER}},t.SetBGMVolumeEvent=class{constructor(e){this.payload=e,this.topic=t.SET_VOLUME_BGM}},t.SetSFXVolumeEvent=class{constructor(e){this.payload=e,this.topic=t.SET_VOLUME_SFX}}},1359:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(6532),a=i(8343);t.default=class{constructor(){this.pos=new n.Vector(0,0),this.vel=new n.Vector(0,0),this.size=new n.Vector(16,16),this.offset=new n.Vector(0,0),this.lifeTime=0,this.state=s.EntityState.ACTIVE,this.spriteChanged=!1,this.bypassPlatform=!1,this.bounds=new n.BoundingBox(this.pos,this.size,this.offset),this.traits={},this.standingOn=new Set,this.events=new a.EventStack}collide(e){this.getTraits().filter((e=>e.enabled)).forEach((t=>t.collides(this,e)))}update(e){this.getTraits().filter((e=>e.enabled)).forEach((t=>t.update(this,e))),this.lifeTime+=e.deltaTime,this.getTraits().filter((e=>e.enabled)).filter((e=>e.finalize)).forEach((e=>{e.finalize(),e.finalize=void 0})),this.standingOn.clear()}obstruct(e,t){e===s.Side.BOTTOM&&t.tile.types.forEach((e=>this.standingOn.add(e))),this.getTraits().filter((e=>e.enabled)).forEach((i=>i.obstruct(this,e,t)))}addTrait(e){this.traits[e.name]=e}addTraits(e){e.forEach((e=>this.addTrait(e)))}getTrait(e){return this.traits[(new e).name]}hasTrait(e){return null!=this.traits[(new e).name]}removeTraitByName(e){return!!this.traits[e]&&(delete this.traits[e],!0)}draw(){}getTraits(){return Object.keys(this.traits).map((e=>this.traits[e]))}}},1609:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(9223)),a=n(i(343));t.default=class{constructor(e){this.entityCollider=new s.default(e.entities),this.tileCollider=new a.default(e,e.tilesize)}checkX(e){this.tileCollider.checkX(e)}checkY(e){this.tileCollider.checkY(e)}check(e){this.entityCollider.check(e)}}},9763:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(6532),r=n(i(7685)),o=n(i(3731)),l=i(580),c=n(i(2013)),u=i(3376),h=n(i(7245));class d extends c.default{constructor(e){super(),this.tilesize=e,this.entities=new Set,this.gravity=new s.Vector(0,1500),this.time=0,this.paused=!1,this.levelTraits.push(new h.default)}update(e){super.update(e),s.FeatherEngine.eventBus.subscribe(s.GAME_CONTROL_TOPIC,{receive:e=>{"pause"===e.payload&&(this.paused=!0),"resume"===e.payload&&(this.paused=!1)}});const t={deltaTime:this.paused?0:e,level:this,camera:this.camera};this.camera.update(this.findPlayer(),e),this.activateEntititesOnSight(t),this.getEntities(a.EntityState.ACTIVE).forEach((e=>e.update(t))),this.getEntities(a.EntityState.READY_TO_REMOVE).forEach((e=>this.entities.delete(e)));const i=this.getEntities(a.EntityState.ACTIVE),n=Math.max(0,i.length-150);n>0&&(i.filter((e=>e.hasTrait(o.default))).slice(0,n).forEach((e=>e.state=a.EntityState.UNTRIGGERED)),console.warn("removing "+n+" active Entities")),0===this.time&&this.init(),this.time+=e,this.getEntities(a.EntityState.ACTIVE).forEach((e=>{e.events.process(l.Names.spawn,{receive:e=>{this.entities.add(e.payload.entity)}})}))}getEntities(e){return[...this.entities].filter((t=>t.state===e))}activateEntititesOnSight(e){[...this.entities].filter((e=>e.hasTrait(o.default))).forEach((t=>t.getTrait(o.default).update(t,e)))}findPlayer(){return[...this.entities].filter((e=>e.hasTrait(r.default))).map((e=>e.getTrait(r.default).player))[0]}init(){this.bgm&&s.FeatherEngine.eventBus.publish(new u.PlayBGMEvent({name:this.bgm}))}}t.default=d},7245:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(9017);t.default=class{update(e){e.entities.forEach((t=>n.LEVEL_COLLIDER.check(t,e)))}}},3625:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(103);t.default=class{constructor(e){this.levelName=e}load(){return n(this,void 0,void 0,(function*(){const e=yield(0,s.loadJson)(`./levels/${this.levelName}/main.json`),t=yield new a.TiledMapLoader(e.tiledMapPath).load();return Object.assign(Object.assign({},e),{tiledMap:t})}))}}},5221:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBrickTileHandler=void 0;const n=i(6532);t.createBrickTileHandler=function(){return{x:(e,t)=>{e.vel.x>0?e.bounds.right>t.x.from&&e.obstruct(n.Side.RIGHT,t):e.vel.x<0&&e.bounds.left<t.x.to&&e.obstruct(n.Side.LEFT,t)},y:(e,t,i)=>{e.vel.y>0?e.bounds.bottom>t.y.from&&e.obstruct(n.Side.BOTTOM,t):e.vel.y<0&&e.bounds.top<t.y.to&&(e.obstruct(n.Side.TOP,t),i.setByRange(t.x,t.y,void 0))}}}},7473:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{constructor(e,t,i=32){this.tiles=e,this.tileset=t,this.chunkSize=i,this.chunks=new n.Matrix}draw(e,t){const{camera:i}=t,n={from:this.toChunkPosition(i.box.left),to:this.toChunkPosition(i.box.right)+1},s={from:this.toChunkPosition(i.box.top),to:this.toChunkPosition(i.box.bottom)+1};for(let t=n.from;t<n.to;t++)for(let n=s.from;n<s.to;n++)this.chunks.get(t,n)||this.prepareChunk(t,n),e.drawImage(this.chunks.get(t,n),t*this.tileset.tilesize*this.chunkSize-i.box.left,n*this.tileset.tilesize*this.chunkSize-i.box.top)}prepareChunk(e,t){const i=n.CanvasRenderer.createRenderContext(this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize),s=i.canvas,a={from:e*this.chunkSize,to:(e+1)*this.chunkSize},r={from:t*this.chunkSize,to:(t+1)*this.chunkSize};this.tiles.forEach((e=>{for(let t=a.from;t<a.to;t++)for(let n=r.from;n<r.to;n++){const s=e.get(t,n);s&&this.tileset.drawTile(s.name,i,t-a.from,n-r.from)}})),this.chunks.set(e,t,s)}toChunkPosition(e){return Math.floor(e/this.tileset.tilesize/this.chunkSize)}}},3511:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{constructor(e,t,i,s=32){this.tiles=e,this.tileset=t,this.time=i,this.chunkSize=s,this.buffer=n.CanvasRenderer.createRenderContext(this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize)}draw(e,t){const{camera:i}=t,n={from:this.toChunkPosition(i.box.left),to:this.toChunkPosition(i.box.right)+1},s={from:this.toChunkPosition(i.box.top),to:this.toChunkPosition(i.box.bottom)+1};for(let t=n.from;t<n.to;t++)for(let n=s.from;n<s.to;n++)e.drawImage(this.prepareChunk(t,n),t*this.tileset.tilesize*this.chunkSize-i.box.left,n*this.tileset.tilesize*this.chunkSize-i.box.top)}prepareChunk(e,t){const i=this.buffer;i.clearRect(0,0,this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize);const n=i.canvas,s={from:e*this.chunkSize,to:(e+1)*this.chunkSize},a={from:t*this.chunkSize,to:(t+1)*this.chunkSize};return this.tiles.forEach((e=>{for(let t=s.from;t<s.to;t++)for(let n=a.from;n<a.to;n++){const r=e.get(t,n);r&&(this.tileset.isAnimatedTile(r.name)?this.tileset.drawAnim(r.name,i,t-s.from,n-a.from,this.time()):this.tileset.drawTile(r.name,i,t-s.from,n-a.from))}})),n}toChunkPosition(e){return Math.floor(e/this.tileset.tilesize/this.chunkSize)}}},6851:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=n(i(731));class r extends a.default{constructor(e){super(),this.currentCamIndex=-1,this.cameras=e.map((e=>new a.default(e)))}get box(){return this.currentCam.box}get currentCam(){return this.cameras[this.currentCamIndex]}update(e,t){if(this.updateCurrentCam(e),this.currentCam.update(e,t),null!=this.transition){0==this.transition.delta&&(this.transition.targetPosition=this.currentCam.box.pos);const e=this.transition.get(1.5*t);this.currentCam.box.left=e.x,this.currentCam.box.top=e.y,this.transition.delta>=1&&(this.transition=null,s.FeatherEngine.eventBus.publish(new s.ResumeGameEvent))}}updateCurrentCam(e){const t=this.cameras.map((e=>e.viewPort)).findIndex((t=>t.overlaps(e.bounds)));-1!=t?(t!=this.currentCamIndex&&-1!==this.currentCamIndex&&(this.transition=new o(this.currentCam.box.pos,this.cameras[t].box.pos),s.FeatherEngine.eventBus.publish(new s.PauseGameEvent)),this.currentCamIndex=t):s.FeatherEngine.debugSettings.enabled&&(console.debug("[camera] no new Camera found!"),console.log(e.bounds),console.log(this.cameras.map((e=>e.box))))}}t.default=r;class o{constructor(e,t){this.currentPosition=e,this.targetPosition=t,this.delta=0}get(e){return this.delta+=e,this.delta>1&&(this.delta=1),new s.Vector(this.currentPosition.x*(1-this.delta)+this.targetPosition.x*this.delta,this.currentPosition.y*(1-this.delta)+this.targetPosition.y*this.delta)}}},5508:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDebugToLevel=void 0;const n=i(4899),s=i(6532);t.addDebugToLevel=function(e){window&&(window.addTrait=t=>{e.findPlayer().addTraits([s.traitRegistry.byName(t)])},window.removeTrait=t=>{e.findPlayer().removeTraitByName(t)},window.testingCheatsEnabled=e=>{n.FeatherEngine.debugSettings.enabled=e},window.hitboxesOnly=e=>{n.FeatherEngine.debugSettings.hitboxesOnly=e},window.FeatherEngine=n.FeatherEngine)}},3459:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(6532),r=i(1756),o=s(i(5002)),l=i(7578),c=[o.default,l.BlueSlimePrefab,l.RedSlimePrefab,r.GlideCollectable];t.default=class{prepare(){return n(this,void 0,void 0,(function*(){const e=yield Promise.all(c.map((e=>new e)).map((e=>n(this,void 0,void 0,(function*(){return{name:e.name,factory:yield e.create()}})))));(0,a.setEntityRepo)(e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.factory})),{}))}))}}},1756:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlideCollectable=void 0;const a=i(4899),r=i(6532),o=s(i(1359)),l=s(i(3330)),c=i(3376),u=s(i(3958)),h=s(i(5259));class d extends l.default{constructor(e){super("collectableTrait"),this.onCollect=e}update(e,t){this.lvl=t.level}collides(e,t){a.FeatherEngine.eventBus.publish(new c.PlaySFXEvent({name:"collect"})),this.onCollect(t),e.state=r.EntityState.READY_TO_REMOVE}}class f extends r.EntityPrefab{constructor(e,t,i){super(e,t),this.entityFac=()=>new o.default,this.size=new a.Vector(16,32),this.offset=new a.Vector(0,0),this.traits=()=>[new d(i)]}routeFrame(e,t){return e instanceof o.default?t.getAnimation("idle")(60*e.lifeTime):t.getAnimation("idle")(0)}create(){const e=Object.create(null,{create:{get:()=>super.create}});return n(this,void 0,void 0,(function*(){const t=a.FeatherEngine.getSaveDataSystem().getData();return this.saveDataRef(t)?()=>null:e.create.call(this)}))}}t.GlideCollectable=class extends f{constructor(){super("glide-collectable","crow_feather",(e=>{u.default.show(["You have collected a crow Feather: Glide","Press and Hold [Space] in midair to glide"]),e.addTraits([new h.default])}))}saveDataRef(e){return e.collectables.hasGliding}}},5002:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(6532),r=n(i(1359)),o=n(i(7448)),l=n(i(6336)),c=n(i(7567)),u=i(2644);class h extends a.EntityPrefab{constructor(){super("crow","crow"),this.entityFac=()=>new r.default,this.size=new s.Vector(16,32),this.offset=new s.Vector(8,0),this.traits=()=>[new c.default,new o.default(new s.Vector(0,750)),new l.default,new u.Jump,new u.Go,new u.Stomp,new u.Killable("dead",3,0),new u.Crouch,new u.Player]}routeFrame(e,t){const i=e.getTrait(u.Go),n=e.getTrait(u.Jump),s=e.getTrait(u.Crouch),a=e.getTrait(u.Glide),r=e.getTrait(u.Killable);if(r.invulnable&&Math.floor(10*r.invulnabilityTime)%2==0)return"";if(s.down)return"crouch";if(null==a?void 0:a.gliding)return"fall-1";if(n.falling){const i=e.vel.y<0?"jump":"fall";return t.getAnimation(i)(n.timeOfCurrentPhase)}return 0!==i.distance&&0!==e.vel.x?t.getAnimation("run")(i.distance):"idle"}flipped(e){return-1==e.getTrait(u.Go).facingDirection}}t.default=h},5920:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(6532),r=n(i(1359));class o extends a.EntityPrefab{constructor(){super("loading","loading"),this.entityFac=()=>new r.default,this.size=new s.Vector(32,32),this.offset=new s.Vector(0,0),this.traits=()=>[]}routeFrame(e,t){return e instanceof r.default?t.getAnimation("loading")(60*e.lifeTime):t.getAnimation("loading")(0)}}t.default=o},7578:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RedSlimePrefab=t.BlueSlimePrefab=void 0;const s=i(4899),a=i(6532),r=n(i(1359)),o=n(i(3330)),l=n(i(7448)),c=n(i(6336)),u=n(i(7567)),h=i(3376),d=i(2644);class f{constructor(e,t,i){this.interval=e,this.f=i,this.currentTime=0,t&&(this.currentTime=Math.random()*e)}update(e,t){this.currentTime+=e,this.currentTime>=this.interval&&(this.currentTime=0,t?t():this.f())}}class p extends o.default{constructor(e=new f(3,!0)){super("slime_jumping"),this.jumpingInterval=e,this.direction=-1,this.jumping=!1,this.jumpTime=new f(.1),this.onGround=!0}update(e,t){this.onGround&&this.jumpingInterval.update(t.deltaTime,(()=>{this.jumping=!0;const i=(e.bounds.left-t.camera.box.left)/s.FeatherEngine.screenSize.width;s.FeatherEngine.eventBus.publish(new h.PlaySFXEvent({name:"jump",blocking:!1,position:2*i-1}))})),this.jumping&&(e.vel.x=100*this.direction,e.vel.y=-200,this.jumpTime.update(t.deltaTime,(()=>{this.jumping=!1,this.jumpTime=new f(.2*Math.random())})))}obstruct(e,t){t===a.Side.BOTTOM&&(this.onGround=!0,this.jumping=!1,e.vel.x=0)}collides(e,t){const i=t.getTrait(d.Stomp),n=t.getTrait(d.Killable),s=e.getTrait(d.Killable);s.dead||i&&(i.fromAbove(t,e)?s&&(this.enabled=!1,s.kill()):n.kill())}}class v extends o.default{constructor(){super("slime_random_turn"),this.changeDir=new f(2)}update(e,t){this.lastDelta=t.deltaTime}obstruct(e,t){t===a.Side.BOTTOM&&this.changeDir.update(this.lastDelta,(()=>{e.getTrait(p).direction=Math.sign(Math.random()-.5)}))}}class m extends o.default{constructor(){super("slime_random_turn"),this.changeDir=new f(2)}update(e,t){this.lastDelta=t.deltaTime,this.deltaToPlayer=t.level.findPlayer().pos.x-e.pos.x}obstruct(e,t){t===a.Side.BOTTOM&&(e.getTrait(p).direction=Math.sign(this.deltaToPlayer))}}class y extends a.EntityPrefab{constructor(e,t,i){super(e,e),this.entityFac=()=>new r.default,this.size=new s.Vector(16,16),this.offset=new s.Vector(0,0),this.traits=()=>[new l.default,new u.default,new c.default,new d.Killable("dead",1,0),i(),new t]}flipped(e){return-1==e.getTrait(p).direction}routeFrame(e,t){return t.getAnimation("idle")(60*e.lifeTime)}}t.BlueSlimePrefab=class extends y{constructor(){super("blue_slime",v,(()=>new p(new f(3,!0))))}},t.RedSlimePrefab=class extends y{constructor(){super("red_slime",m,(()=>new p(new f(3,!0))))}}},6355:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=n(i(3330));class r extends a.default{constructor(){super("cantGoLeft"),this.disabledForReset=!1,this.posOnScreen=new s.Vector(0,0)}}t.default=r},8021:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=n(i(3330));class r extends a.default{constructor(){super("crouch"),this._down=!1,this.lockDown=!1,this.requestEnd=!1}update(e){this._down&&this.resetSize(e),this.requestEnd&&(this.lockDown||this.end(e)),this.lockDown=!1}end(e){this.memoSize&&(e.pos.y-=8,e.size.set(this.memoSize.x,this.memoSize.y),e.offset.set(this.memoOffset.x,this.memoOffset.y),this.memoSize=void 0,this.memoOffset=void 0),this._down=!1,this.requestEnd=!0}start(){this._down=!0,this.requestEnd=!1}cancel(){this.requestEnd=!0}get down(){return this._down}resetSize(e){this.memoSize||(this.memoSize=new s.Vector(e.size.x,e.size.y),this.memoOffset=new s.Vector(e.offset.x,e.offset.y),e.pos.y+=8,e.size.set(24,24),e.offset.set(0,0))}}t.default=r},8213:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StompEvent=void 0,t.StompEvent=class{constructor(e){this.payload=e,this.topic="stomp"}}},5259:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(6532),a=n(i(3330)),r=n(i(7448));class o extends a.default{constructor(){super("glide"),this.gliding=!1}start(){this.gliding=!0}cancel(){this.gliding=!1}update(e,t){const i=e.getTrait(r.default);this.gliding&&i&&this.enabled&&(e.vel.y=.95*i.gravity.y*t.deltaTime)}obstruct(e,t){switch(t){case s.Side.BOTTOM:case s.Side.TOP:this.cancel()}}}t.default=o},6757:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(6532),r=n(i(3330)),o=i(3376),l=n(i(8021)),c=n(i(4565)),u=n(i(5930));class h extends r.default{constructor(){super("go"),this.acceleration=400,this.deceleration=300,this.goLeft=!1,this.goRight=!1,this.distance=0,this.facingDirection=0,this.running=!1}get dragFactor(){return this.running?2e-4:5e-4}obstruct(e,t){t!==a.Side.LEFT&&t!==a.Side.RIGHT||(0!=this.distance&&s.FeatherEngine.eventBus.publish(new o.PlaySFXEvent({name:"bump"})),this.distance=0)}update(e,t){e.bounds.left<0&&(e.bounds.left=0);const i=e.getTrait(c.default),n=e.getTrait(u.default),s=e.getTrait(l.default),a=this.getDirection();if(this.turnToMovementDirection(a,i),s.down)return void this.decelToStand(e,t.deltaTime);if(n&&n.dead)return void e.vel.set(0,0);const r=Math.abs(e.vel.x);0!==a?e.vel.x+=this.acceleration*a*t.deltaTime:0!==e.vel.x?this.decelToStand(e,t.deltaTime):this.resetMovement(e);const o=this.dragFactor*e.vel.x*r;e.vel.x-=o,this.distance+=r*t.deltaTime}resetMovement(e){s.FeatherEngine.debugSettings.enabled&&0!==this.distance&&console.log("Standing at",Math.round(e.pos.x/16),Math.round(e.pos.y/16)),this.distance=0}getDirection(){return this.goRight?1:this.goLeft?-1:0}turnToMovementDirection(e,t){0!==e&&t&&!t.falling&&(this.facingDirection=e)}decelToStand(e,t){const i=Math.abs(e.vel.x),n=Math.min(i,this.deceleration*t);e.vel.x+=e.vel.x>0?-n:n}right(e){this.goRight=e,e&&(this.goLeft=!1)}left(e){this.goLeft=e,e&&(this.goRight=!1)}}t.default=h},2644:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Go=t.Walk=t.Stomp=t.Player=t.PlayerController=t.LevelTimer=t.Killable=t.Jump=t.Glide=t.Crouch=t.CantGoLeft=void 0;const s=n(i(6355));t.CantGoLeft=s.default;const a=n(i(8021));t.Crouch=a.default;const r=n(i(5259));t.Glide=r.default;const o=n(i(6757));t.Go=o.default;const l=n(i(4565));t.Jump=l.default;const c=n(i(5930));t.Killable=c.default;const u=n(i(5295));t.LevelTimer=u.default;const h=n(i(9781));t.Player=h.default;const d=n(i(7685));t.PlayerController=d.default;const f=n(i(8268));t.Stomp=f.default;const p=n(i(7648));t.Walk=p.default},4565:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(6532),r=i(8343),o=n(i(1359)),l=n(i(3330)),c=i(3376),u=n(i(8021));class h{constructor(){this.topic="JumpButtonPressed",this.payload=null}}class d{constructor(){this.topic="JumpButtonReleased",this.payload=null}}class f{constructor(e){this.startVal=e,this.currentVal=e}decrease(e){this.currentVal-=e}reset(){this.currentVal=this.startVal}toZero(){this.currentVal=0}notZero(){return this.currentVal>0}get delta(){return this.startVal-this.currentVal}}class p extends l.default{constructor(){super("jump"),this.eventBuffer=new r.EventStack,this.velocity=220,this.raisingTime=new f(.15),this.onGround=0,this.distance=0,this.lastDir=0,this.raisingTime.toZero()}start(){this.eventBuffer.publish(new h)}cancel(){this.eventBuffer.publish(new d)}update(e,t){this.eventBuffer.process("JumpButtonReleased",{receive:()=>{this.raisingTime.toZero(),e.vel.y<0&&(e.vel.y=-this.velocity/2)}}),this.eventBuffer.process("JumpButtonPressed",{receive:()=>{const i=e.getTrait(u.default);if(null==i?void 0:i.down)return e instanceof o.default&&e.standingOn.has("platform")&&(e.bypassPlatform=!0),void this.raisingTime.toZero();if(!this.falling){e.bypassPlatform=!0,this.raisingTime.reset();const i=(e.bounds.left-t.camera.box.left)/s.FeatherEngine.screenSize.width;s.FeatherEngine.eventBus.publish(new c.PlaySFXEvent({name:"jump",blocking:!1,position:2*i-1}))}}}),this.raisingTime.notZero()&&(e.bypassPlatform=!1,e.vel.y=-this.velocity,this.raisingTime.decrease(t.deltaTime));const i=Math.sign(e.vel.y);this.lastDir!=i&&(this.distance=0),this.lastDir=i;const n=Math.abs(e.vel.y);this.distance+=n*t.deltaTime,this.onGround--}obstruct(e,t){t===a.Side.BOTTOM?(this.onGround=1,this.distance=0):t===a.Side.TOP&&(this.cancel(),this.distance=0)}get falling(){return this.onGround<0}get timeOfCurrentPhase(){return this.distance}}t.default=p},5930:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(6532),a=n(i(6757)),r=n(i(3330));class o extends r.default{constructor(e="dead",t=1,i=2){super("killable"),this.deathAnim=e,this.maxHP=t,this.fadeoutTime=i,this.dead=!1,this.deadTime=0,this.invulnabilityTime=0,this.hp=1,this.hp=t}kill(e=1){this.invulnable||this.dead||(this.hp-=e,this.invulnabilityTime=1,this.hp<=0&&(this.finalize=()=>{this.dead=!0}))}revive(e){this.dead=!1,this.hp=this.maxHP,this.invulnabilityTime=0,this.deadTime=0,e.state=s.EntityState.ACTIVE}update(e,t){this.invulnabilityTime-=t.deltaTime,this.invulnabilityTime<=0?this.invulnabilityTime=0:this.invulnabilityTime>.8&&this.repulse(e),this.dead&&(this.deadTime+=t.deltaTime,-1!=this.fadeoutTime&&this.deadTime>this.fadeoutTime&&(e.state=s.EntityState.READY_TO_REMOVE))}get invulnable(){return this.invulnabilityTime>0}repulse(e){if(e.hasTrait(a.default)){console.log("repulsing");const t=e.getTrait(a.default);e.vel.x=100*-t.facingDirection,e.vel.y=-150}}}t.default=o},5295:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=n(i(3330)),r=i(3376);class o extends a.default{constructor(e){super("leveltimer"),this.totalTime=300,this.currentTime=0,this.hurried=!1,e&&(this.totalTime=e.estimateTime)}update(e,t){this.currentTime+=t.deltaTime,this.restTime<=100&&!this.hurried&&(this.hurried=!0,s.FeatherEngine.eventBus.publish(new r.PlaySFXEvent({name:"hurry",blocking:!0})))}get restTime(){return this.totalTime-this.currentTime}}t.default=o},7685:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(3330)),a=n(i(6355)),r=n(i(5930));class o extends s.default{constructor(e){super("playerController"),this.level=e}setCheckpoint(e){this.checkPoint=e}setPlayer(e){this.player=e}update(){if(!this.level.entities.has(this.player)){const e=this.player.getTrait(r.default),t=this.player.getTrait(a.default);e.revive(this.player),t&&(t.disabledForReset=!0),this.player.pos.set(this.checkPoint.x*this.level.tilesize,this.checkPoint.y*this.level.tilesize),this.level.entities.add(this.player)}}}t.default=o},9781:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(3330));class a extends s.default{constructor(){super("player"),this.lives=3,this.c=0,this.score=0}update(e){e.events.process("stomp",{receive:()=>this.score+=100})}get coins(){return this.c}set coins(e){e>=100&&(this.lives++,e-=100,console.log("1-up")),this.c=e}}t.default=a},8268:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=n(i(3330)),r=i(3376),o=i(8213),l=n(i(5930));class c extends a.default{constructor(){super("stomper"),this.bounceSpeed=150,this.quereBounce=!1,this.stomped=!1}fromAbove(e,t){return e.vel.y>t.vel.y}collides(e,t){const i=t.getTrait(l.default);e.getTrait(l.default).finalize||e.getTrait(l.default).dead||i&&!i.dead&&this.fromAbove(e,t)&&(this.bounce(e,t),s.FeatherEngine.eventBus.publish(new r.PlaySFXEvent({name:"stomp"})),e.events.publish(new o.StompEvent({us:e,them:t})))}bounce(e,t){this.finalize=()=>{e.bounds.bottom=t.bounds.top,e.vel.y=-this.bounceSpeed}}}t.default=c},7648:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(6532),a=n(i(3330));class r extends a.default{constructor(e=-30){super("walk"),this.speed=e,this.enabled=!0}update(e){this.enabled&&(e.vel.x=this.speed)}obstruct(e,t){t!==s.Side.LEFT&&t!==s.Side.RIGHT||(this.speed*=-1)}}t.default=r},8548:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(i(2006)),r=s(i(8391)),o=s(i(8055)),l=s(i(3273));t.default=class{constructor(e){this.canvasId=e}start(){return n(this,void 0,void 0,(function*(){const e=(new a.default).addScenes([()=>new r.default,()=>new o.default,()=>new l.default]);yield e.load(),e.start(),e.setScene(o.default.NAME)}))}}},405:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(4899),r=i(6532),o=s(i(9763)),l=s(i(3625)),c=i(5221),u=s(i(7473)),h=s(i(3511)),d=s(i(4481)),f=i(343),p=i(8792),v=s(i(9207)),m=s(i(3459)),y=s(i(5259)),g=i(7904),_=i(5307);t.default=class{constructor(e){this.saveData=e}load(){var e;return n(this,void 0,void 0,(function*(){const t=yield new l.default(this.saveData.stage.name).load();yield(new m.default).prepare(),t.tiledMap.tileset;const i=new o.default(t.tiledMap.tileSize);i.name=this.saveData.stage.name,i.width=t.tiledMap.width,i.height=t.tiledMap.height,t.tiledMap.entities&&t.tiledMap.entities.map((e=>Object.assign(Object.assign({},e),{entity:r.entityRepo[e.prefab]()}))).filter((({entity:e})=>e)).forEach((({position:{x:e,y:t},entity:n})=>{n.pos.set(e,t),i.entities.add(n)}));const s=r.entityRepo.crow();(null===(e=this.saveData.collectables)||void 0===e?void 0:e.hasGliding)&&s.addTrait(new y.default),s.state=r.EntityState.ACTIVE,i.startPosition=new a.Vector(t.startPosition.x,t.startPosition.y),i.estimateTime=t.estimateTime,i.bgm=t.bgm;const b=t.tiledMap.layers.map((e=>new d.default(e,i.tilesize)));i.levelLayer=b;const w=[];return w.push(new p.SingleColorLayer("#6B88FE")),t.parallax&&w.push(...yield Promise.all(t.parallax.map((e=>n(this,void 0,void 0,(function*(){return new p.ParallaxLayer(yield(0,a.loadImage)(e.img),e.y,e.speed)})))))),w.push(new u.default(t.tiledMap.layers.filter((e=>!e.frontLayer&&!e.dynamic)).map((e=>e.matrix)),t.tiledMap.tileset),new h.default(t.tiledMap.layers.filter((e=>!e.frontLayer&&e.dynamic)).map((e=>e.matrix)),t.tiledMap.tileset,(()=>i.time)),new p.EntityLayer(i.entities),new u.default(t.tiledMap.layers.filter((e=>e.frontLayer&&!e.dynamic)).map((e=>e.matrix)),t.tiledMap.tileset),new h.default(t.tiledMap.layers.filter((e=>e.frontLayer&&e.dynamic)).map((e=>e.matrix)),t.tiledMap.tileset,(()=>i.time))),w.push(new v.default(i)),(0,f.addHandler)("brick",(0,c.createBrickTileHandler)()),(0,f.addHandler)("onlyCrouch",(0,_.createOnlyCrouchTileHandler)()),(0,f.addHandler)("deadly",(0,g.createDeadlyHandler)()),{level:i,player:s,renderer:w,viewPorts:t.tiledMap.viewPorts}}))}}},7904:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDeadlyHandler=void 0;const n=i(2644);t.createDeadlyHandler=function(){return{x:e=>{const t=e.getTrait(n.Killable);null==t||t.kill()},y:e=>{const t=e.getTrait(n.Killable);null==t||t.kill()}}}},5307:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOnlyCrouchTileHandler=void 0;const n=i(2644);t.createOnlyCrouchTileHandler=function(){return{x:()=>{},y:e=>{const t=e.getTrait(n.Crouch);t&&(t.lockDown=!0)}}}},3958:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{static show(e){n.FeatherEngine.eventBus.subscribe("dialog-next",{receive:()=>{e.shift(),console.log(e),0==e.length?(n.FeatherEngine.eventBus.publish(new n.ResumeGameEvent),n.FeatherEngine.eventBus.publish(new n.PopControlInputEvent),n.FeatherEngine.eventBus.unsubscribeAll("dialog-next"),n.FeatherEngine.eventBus.publish({topic:"dialog-clear",payload:"x"})):n.FeatherEngine.eventBus.publish({topic:"dialog-text",payload:e[0]})}}),n.FeatherEngine.eventBus.publish(new n.StashControlInputEvent),n.FeatherEngine.eventBus.publish(new n.PauseGameEvent),n.KeyboardInput.addKeyListener({keyDown:e=>{"Space"==e&&n.FeatherEngine.eventBus.publish({topic:"dialog-next",payload:"x"})},keyUp:()=>{},keyPressed:()=>{}}),n.FeatherEngine.eventBus.publish({topic:"dialog-text",payload:e[0]})}}},9309:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InitialSaveData=void 0,t.InitialSaveData={stage:{name:"forest"},collectables:{hasGliding:!1}}},5401:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(i(8548));!function(){n(this,void 0,void 0,(function*(){const e=new a.default("screen");yield e.start()}))}()},8391:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(4899),r=s(i(5920)),o=i(8792),l=s(i(731));t.default=class{constructor(){this.name="loadingScene",this.isLoadingScene=!0}load(){return n(this,void 0,void 0,(function*(){this.bg=[],this.bg.push(new o.SingleColorLayer("#555b6d")),this.loadingAnimation=(yield(new r.default).create())(),this.loadingAnimation.pos.set(448,392);const e=new Set;e.add(this.loadingAnimation),this.bg.push(new o.EntityLayer(e))}))}start(){return n(this,void 0,void 0,(function*(){}))}update(e){this.loadingAnimation.lifeTime+=e}draw(e){this.bg.forEach((t=>t.draw(e,{camera:new l.default(new a.BoundingBox(new a.Vector(0,0),new a.Vector(a.FeatherEngine.screenSize.width,a.FeatherEngine.screenSize.height)),new a.Vector(a.FeatherEngine.screenSize.width,a.FeatherEngine.screenSize.height))})))}}},8376:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(3376);t.default=class{constructor(e){this.mainMenu=e}keyDown(e){switch(e){case"Space":this.mainMenu.submit();break;case"KeyW":this.mainMenu.option--,n.FeatherEngine.eventBus.publish(new s.PlaySFXEvent({name:"pointer"}));break;case"KeyS":this.mainMenu.option++,n.FeatherEngine.eventBus.publish(new s.PlaySFXEvent({name:"pointer"}));break;case"Digit1":n.FeatherEngine.eventBus.publish(new s.SetMasterVolumeEvent({value:"-0.1"}));break;case"Digit2":n.FeatherEngine.eventBus.publish(new s.SetMasterVolumeEvent({value:"+0.1"}));break;default:console.log(e)}}keyUp(){}keyPressed(){}}},3400:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(4264);t.default=class{constructor(e,t,i,n){this.font=e,this.img=t,this.frame=i,this.mainMenu=n}draw(e){(0,s.drawRect)(e,0,0,n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height,"black",{filled:!0}),e.drawImage(this.img,0,0),this.drawSelectBox(e,(n.FeatherEngine.screenSize.width-192)/2,340),this.font.print("by DialThetti",e,n.FeatherEngine.screenSize.width-104-4,n.FeatherEngine.screenSize.height-8-4),this.font.print("v0.0.20211002-1",e,4,n.FeatherEngine.screenSize.height-8-4)}drawSelectBox(e,t,i){this.frame.draw(e,t,i,192,64),this.mainMenu.sav.hasData(0)&&this.font.print("Continue",e,t+32,i+16),this.font.print("New Game",e,t+32,i+16+16+8),this.font.print(">",e,t+16,i+16+24*this.mainMenu.option)}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}},8055:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(4899),r=i(4264),o=s(i(731)),l=s(i(2006)),c=i(3376),u=i(9387),h=i(9309),d=s(i(8376)),f=s(i(3400));class p{constructor(){this.name=p.NAME,this.isLoadingScene=!1,this._option=0,this.camera=new o.default}load(){return n(this,void 0,void 0,(function*(){this.sav=a.FeatherEngine.getSaveDataSystem();const e=yield new r.FontLoader("./img/font.png").load(),t=yield(0,a.loadImage)("./img/title.png"),i=yield new r.NineWaySpriteSheetLoader("./img/frame.png").load();this.layer=new f.default(e,t,i,this),this.audioBoard=yield new c.AudioBoardLoader("./sfx/audio.json").load(),this.audioBoard.setMasterVolume(.5),this.sav.hasData(0)||(this._option=1)}))}start(){return n(this,void 0,void 0,(function*(){a.KeyboardInput.addKeyListener(new d.default(this))}))}update(){}draw(e){this.layer.draw(e,{camera:this.camera})}get option(){return this._option}set option(e){this.sav.hasData(0)?this._option=(e<0?e+2:e)%2:this._option=1}submit(){switch(a.FeatherEngine.eventBus.publish(new u.PlaySFXEvent({name:"confirm"})),this.option){case 0:this.sav.hasData(0)&&this.sav.loadCurrentData(0);break;case 1:this.sav.clearData(),this.sav.pushData(this.newGame())}l.default.INSTANCE.setScene("game")}newGame(){return h.InitialSaveData}}t.default=p,p.NAME="main-menu"},3273:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(4899),r=i(6532),o=i(4264),l=s(i(1359)),c=s(i(6851)),u=i(2644),h=i(6713),d=i(5508),f=s(i(5295)),p=s(i(405)),v=s(i(4995)),m=s(i(327)),y=s(i(8266)),g=s(i(6689)),_=s(i(5264));class b{constructor(){this.name=b.NAME,this.isLoadingScene=!1}createPlayerEnv(e,t){const i=new l.default,n=new u.PlayerController(t),s=new f.default(t);return i.state=r.EntityState.ACTIVE,e.pos.set(t.startPosition.x*t.tilesize,t.startPosition.y*t.tilesize),n.setPlayer(e),n.setCheckpoint(t.startPosition),i.addTraits([n,s]),i}load(){return n(this,void 0,void 0,(function*(){const e=a.FeatherEngine.getSaveDataSystem().getData(),{level:t,player:i,renderer:n,viewPorts:s}=yield new p.default(e).load(),l=yield new o.FontLoader("./img/font.png").load();a.FeatherEngine.eventBus.publish(new a.ClearControlInputEvent),a.KeyboardInput.addKeyListener(new v.default(i));const u=new c.default(s);e.position&&t.startPosition.set(e.position.x/t.tilesize,e.position.y/t.tilesize);const f=this.createPlayerEnv(i,t);i.state=r.EntityState.ACTIVE,t.entities.add(f);const b=yield new o.NineWaySpriteSheetLoader("./img/frame.png").load();n.push(new y.default(u),new g.default,new m.default(l,t),new _.default(l,b,t)),t.camera=u,this.level=t,n.forEach((e=>h.LEVEL_RENDERER.addLayer(e))),this.player=i,(0,d.addDebugToLevel)(t)}))}update(e){this.level.update(e)}draw(e){h.LEVEL_RENDERER.render(e,this.level)}start(){return n(this,void 0,void 0,(function*(){}))}}t.default=b,b.NAME="game"},4995:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4899),a=i(2644),r=n(i(2006)),o=i(3376);t.default=class{constructor(e){this.playerFigure=e}keyDown(e){const t=this.playerFigure.getTrait(a.Go),i=this.playerFigure.getTrait(a.Jump),n=this.playerFigure.getTrait(a.Crouch),l=this.playerFigure.getTrait(a.Glide),c=this.playerFigure.getTrait(a.Killable);switch(e){case"Space":l&&i.falling?l.start():i.start();break;case"KeyS":i.falling||n.start();break;case"KeyA":t.left(!0);break;case"KeyD":t.right(!0);break;case"Digit1":s.FeatherEngine.eventBus.publish(new o.SetMasterVolumeEvent({value:"-0.1"}));break;case"Digit2":s.FeatherEngine.eventBus.publish(new o.SetMasterVolumeEvent({value:"+0.1"}));break;case"Digit5":s.FeatherEngine.getSaveDataSystem().pushData({position:this.playerFigure.pos,life:c.hp,stage:{name:"forest"},collectables:{hasGliding:this.playerFigure.hasTrait(a.Glide)}}),s.FeatherEngine.getSaveDataSystem().storeCurrentData(0);break;case"Digit9":s.FeatherEngine.getSaveDataSystem().loadCurrentData(0),r.default.INSTANCE.setScene("game",!0,!0);break;default:(0,s.log)(this,`Key ${e} was pressed without listener`)}}keyUp(e){const t=this.playerFigure.getTrait(a.Go),i=this.playerFigure.getTrait(a.Jump),n=this.playerFigure.getTrait(a.Crouch),s=this.playerFigure.getTrait(a.Glide);switch(e){case"Space":s&&s.gliding?s.cancel():i.cancel();break;case"KeyS":n.cancel();break;case"KeyA":t.left(!1);break;case"KeyD":t.right(!1)}}keyPressed(){}}},327:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(4264);t.default=class{constructor(e,t){this.font=e,this.level=t}draw(e){(0,s.drawRect)(e,0,23*this.level.tilesize,n.FeatherEngine.screenSize.width,5*this.level.tilesize,"black",{filled:!0})}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}},8266:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(4264);t.default=class{constructor(e){this.cameraToDraw=e}draw(e){n.FeatherEngine.debugSettings.enabled&&(0,s.drawRect)(e,this.cameraToDraw.box.left,this.cameraToDraw.box.top,this.cameraToDraw.size.x,this.cameraToDraw.size.y,"purple")}}},9207:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(4264);t.default=class{constructor(e){this.level=e,this.resolvedTiles=[],this.resolvedTiles=[],this.tileSize=e.tilesize;const t=e.levelLayer[0].getByIndex;e.levelLayer[0].getByIndex=(i,s)=>(n.FeatherEngine.debugSettings.enabled&&this.resolvedTiles.push({x:i,y:s}),t.call(e.levelLayer[0],i,s))}drawEntityFrames(e,t){this.level.entities.forEach((i=>(0,s.drawRect)(e,i.bounds.left-t.box.left,i.bounds.top-t.box.top,i.size.x,i.size.y,"red")))}drawTileFrames(e,t){this.resolvedTiles.forEach((({x:i,y:n})=>(0,s.drawRect)(e,i*this.tileSize-t.box.left,n*this.tileSize-t.box.top,this.tileSize,this.tileSize,"blue")))}draw(e,t){n.FeatherEngine.debugSettings.enabled&&(this.drawTileFrames(e,t.camera),this.drawEntityFrames(e,t.camera),this.resolvedTiles.length=0)}}},6689:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899),s=i(4264);t.default=class{draw(e,t){n.FeatherEngine.debugSettings.enabled&&(0,s.drawRect)(e,t.camera.edge.x,t.camera.edge.y,t.camera.size.x-2*t.camera.edge.x,t.camera.size.y-2*t.camera.edge.y,"green")}}},5264:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(4899);t.default=class{constructor(e,t,i){this.font=e,this.frame=t,this.level=i,n.FeatherEngine.eventBus.subscribe("dialog-text",{receive:e=>{this.textToShow=e.payload.split("\n")}}),n.FeatherEngine.eventBus.subscribe("dialog-clear",{receive:()=>{this.textToShow=null}})}draw(e){if(!this.textToShow)return;const t={x:2*this.level.tilesize,y:16*this.level.tilesize};this.frame.draw(e,t.x,t.y,n.FeatherEngine.screenSize.width-4*this.level.tilesize,5*this.level.tilesize),this.font.print(this.textToShow[0],e,t.x+16,t.y+16)}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}}},t={};!function i(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(5401)})();