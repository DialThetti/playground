(()=>{"use strict";var e={8218:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(803),a=s(i(4720));class r extends a.default{constructor(){super("activateOnSight")}update(e,t){const i=t.camera.box,s=e.bounds;i.right>s.left&&i.left<s.right?e.state=n.EntityState.ACTIVE:e.state=n.EntityState.UNTRIGGERED}}t.default=r},2316:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(8458);t.default=class{constructor(e,t){this.name=e,this.spriteName=t}flipped(e){return e.vel.x<0}create(){return s(this,void 0,void 0,(function*(){const e=this.spriteName?yield new n.SpriteSheetLoader(`entities/${this.spriteName}`).load():void 0;return()=>{const t=this.entityFac();return t.size.set(this.size.x,this.size.y),t.offset.set(this.offset.x,this.offset.y),t.addTraits(this.traits()),t.draw=i=>{if(!e)return;const s=this.routeFrame(t,e);s&&e.draw(s,i,0,0,this.flipped(t))},t}}))}}},7397:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setEntityRepo=t.entityRepo=void 0,t.setEntityRepo=function(e){t.entityRepo=e}},803:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EntityState=void 0,(i=t.EntityState||(t.EntityState={}))[i.READY_TO_REMOVE=0]="READY_TO_REMOVE",i[i.ACTIVE=1]="ACTIVE",i[i.UNTRIGGERED=2]="UNTRIGGERED"},9992:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traitRegistry=void 0;class i{constructor(){this.registry={}}addTrait(e){this.registry[e.name]=Object.getPrototypeOf(e).constructor}byName(e){return new this.registry[e]}}t.default=i,t.traitRegistry=new i},4720:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(9992);t.default=class{constructor(e){this.name=e,this.enabled=!0,s.traitRegistry.addTrait(this)}update(e,t){}obstruct(e,t,i){}collides(e,t){}}},8282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.events=[]}emit(e){this.events.push(e)}process(e,t){this.events.filter((t=>t.name===e)).forEach((e=>t(e.payload))),this.events=this.events.filter((t=>t.name!==e))}}},4522:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SfxEvent=t.SpawnEvent=t.Names=void 0,t.Names={spawn:"spawn",playSFX:"playSFX"},t.SpawnEvent=class{constructor(e){this.payload=e,this.name=t.Names.spawn}},t.SfxEvent=class{constructor(e){this.payload=e,this.name=t.Names.playSFX}}},1258:function(e,t){var i=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.context=e,this.audioURL=t}load(){return i(this,void 0,void 0,(function*(){const e=yield fetch(this.audioURL),t=yield e.arrayBuffer();return this.context.decodeAudioData(t)}))}}},3407:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(6971),r=n(i(1258)),o=n(i(4344));t.default=class{constructor(e,t){this.context=e,this.audioURL=t}load(){return s(this,void 0,void 0,(function*(){const e=yield a.loadJson(this.audioURL),t=new o.default(this.context),i=[...Object.keys(e.fx)];for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s)){const n=i[s],a=e.fx[n].url,o=yield new r.default(this.context,a).load();t.addAudio(n,o)}return t}))}}},4344:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.audioContext=e,this.buffers={},this.enabled=!0,this.isBlocked=!1,window.setAudio=e=>{this.enabled=e,e||(this.lastSource&&this.lastSource.stop(),this.bgmChannel&&this.bgmChannel.stop())}}addAudio(e,t){this.buffers[e]=t}playAudio(e,t){if(!this.enabled)return;if(this.isBlocked)return;this.lastSource&&this.lastSource.stop();const i=this.audioContext.createBufferSource();i.connect(this.audioContext.destination),i.buffer=this.buffers[e],i.start(0),t&&(this.isBlocked=!0,i.onended=()=>this.isBlocked=!1),this.lastSource=i}playBGM(e){if(!this.enabled)return;console.info(`Starting ${e} as BGM`),this.bgmChannel&&this.bgmChannel.stop();const t=this.audioContext.createBufferSource();t.connect(this.audioContext.destination),t.buffer=this.buffers[e],t.loop=!0,t.start(0),this.bgmChannel=t}}},7219:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.entities=e}check(e){[...this.entities].filter((t=>e!==t)).filter((t=>e.bounds.overlaps(t.bounds))).forEach((t=>e.collide(t)))}}},574:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlatformTileHandler=void 0;const s=i(4303);t.createPlatformTileHandler=function(){return{x:()=>{},y:(e,t)=>{e.bypassPlatform||e.vel.y>0&&e.bounds.bottom>t.y.from&&e.obstruct(s.Side.BOTTOM,t)}}}},5626:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSolidTileHandler=void 0;const s=i(4303);t.createSolidTileHandler=function(){return{x:(e,t)=>{0!==e.vel.x&&(e.vel.x>0?e.bounds.right>t.x.from&&e.obstruct(s.Side.RIGHT,t):e.bounds.left<t.x.to&&e.obstruct(s.Side.LEFT,t))},y:(e,t)=>{0!==e.vel.y&&(e.vel.y>0?e.bounds.bottom>t.y.from&&e.obstruct(s.Side.BOTTOM,t):e.bounds.top<t.y.to&&e.obstruct(s.Side.TOP,t))}}}},9560:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addHandler=void 0;const s=i(574),n={solid:i(5626).createSolidTileHandler(),platform:s.createPlatformTileHandler()};t.addHandler=function(e,t){n[e]=t},t.default=class{constructor(e,t){this.level=e,this.tileSize=t}checkX(e){const t=e.bounds;if(0===e.vel.x)return;const i=e.vel.x>0?t.right:t.left;for(const s of this.level.levelLayer)s.get({from:i,to:i},{from:t.top,to:t.bottom}).forEach((t=>this.handle("x",e,t,s)))}checkY(e){const t=e.bounds;if(0===e.vel.y)return;const i=e.vel.y>0?t.bottom:t.top;for(const s of this.level.levelLayer)s.get({from:t.left,to:t.right},{from:i,to:i}).forEach((t=>this.handle("y",e,t,s)))}handle(e,t,i,s){i.tile.types&&i.tile.types.forEach((a=>{const r=n[a];r&&r[e](t,i,s)}))}}},8562:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6971),a=s(i(4720));class r extends a.default{constructor(e=new n.Vector(0,1500)){super("gravity"),this.gravity=e}update(e,t){const i=this.gravity.getScaledBy(t.deltaTime);e.vel.add(i)}}t.default=r},3560:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(1486),a=s(i(4720));class r extends a.default{constructor(){super("physics")}update(e,t){this.enabled&&(e.pos.x+=e.vel.x*t.deltaTime,n.LEVEL_COLLIDER.checkX(e,t.level),e.pos.y+=e.vel.y*t.deltaTime,n.LEVEL_COLLIDER.checkY(e,t.level))}}t.default=r},6281:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=i(4303);class r extends n.default{constructor(){super("solid")}obstruct(e,t,i){if(this.enabled)switch(t){case a.Side.BOTTOM:e.bounds.top=i.y.from-e.size.y,e.vel.y=0;break;case a.Side.RIGHT:e.bounds.left=i.x.from-e.size.x,e.vel.x=0;break;case a.Side.LEFT:e.bounds.left=i.x.to,e.vel.x=0;break;case a.Side.TOP:e.bounds.top=i.y.to,e.vel.y=0}}}t.default=r},9730:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.distinct=t.flatMap=t.notNull=void 0,t.notNull=function(e){return!!e},t.flatMap=function(e){return e.reduce(((e,t)=>e.concat(t)),[])},t.distinct=function(e){return e.filter((function(e,t,i){return i.indexOf(e)===t}))}},26:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971);t.default=class{constructor(e=new s.BoundingBox(new s.Vector(0,0),new s.Vector(s.FeatherEngine.screenSize.width,s.FeatherEngine.screenSize.height)),t=new s.Vector(s.FeatherEngine.screenSize.width,368)){this.totalMovementBounds=e,this.size=t,this.pos_=new s.Vector(0,0),this.edge=new s.Vector(240,64),this.pos_.set(e.left,e.top)}get box(){return new s.BoundingBox(this.pos_,this.size)}get viewPort(){return this.totalMovementBounds}update(e,t){const i=e.bounds.right-this.box.right+this.edge.x,s=e.bounds.left-this.box.left-this.edge.x;this.pos_.x+=Math.max(i,Math.min(s,0));const n=e.bounds.bottom-this.box.bottom+this.edge.y,a=e.bounds.top-this.box.top-this.edge.y;this.pos_.y+=Math.max(n,Math.min(a,0)),this.pos_.set(Math.floor(Math.max(this.totalMovementBounds.left,Math.min(this.totalMovementBounds.right-this.size.x,this.pos_.x))),Math.floor(Math.max(this.totalMovementBounds.top,Math.min(this.totalMovementBounds.bottom-this.size.y,this.pos_.y))))}}},4303:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Side=void 0,(i=t.Side||(t.Side={}))[i.TOP=0]="TOP",i[i.BOTTOM=1]="BOTTOM",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT"},3095:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.tilesize=e}toIndex(e){return Math.floor(e/this.tilesize)}toIndexRange(e){const t=Math.ceil(e.to/this.tilesize)*this.tilesize,i=[];let s=e.from;do{i.push(this.toIndex(s)),s+=this.tilesize}while(s<t);return i}}},8647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.name=e,this.types=t}}},1486:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LEVEL_COLLIDER=void 0;const n=s(i(6143));t.LEVEL_COLLIDER=new class{checkX(e,t){new n.default(t).checkX(e)}checkY(e,t){new n.default(t).checkY(e)}check(e,t){new n.default(t).check(e)}}},9822:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(9730),a=s(i(3095)),r=i(6971);t.default=class{constructor(e,t){this.tiles=e,this.tilesize=t,this.math=new a.default(t)}get(e,t){return"number"==typeof e&&(e={from:e,to:e+1}),"number"==typeof t&&(t={from:t,to:t+1}),r.cross(this.math.toIndexRange(e),this.math.toIndexRange(t)).map((([e,t])=>this.getByIndex(e,t))).filter(n.notNull)}setByRange(e,t,i){r.cross(this.math.toIndexRange(e),this.math.toIndexRange(t)).forEach((([e,t])=>this.tiles.matrix.set(e,t,i)))}getByIndex(e,t){const i=this.tiles.matrix.get(e,t);return i?{tile:i,y:{from:t*this.tilesize,to:(t+1)*this.tilesize},x:{from:e*this.tilesize,to:(e+1)*this.tilesize}}:null}delete(e,t){"number"==typeof e&&(e={from:e,to:e+1}),"number"==typeof t&&(t={from:t,to:t+1}),this.setByRange(e,t,null)}get name(){return this.tiles.name}}},9545:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LEVEL_RENDERER=void 0,t.LEVEL_RENDERER=new class{constructor(){this.layers=[]}render(e,t){this.layers.forEach((i=>i.draw(e,t)))}addLayer(e){this.layers.push(e)}}},20:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(8282));t.default=class{constructor(){this.levelTraits=[],this.levelLayer=[],this.entities=new Set,this.eventBuffer=new n.default}update(e){this.levelTraits.forEach((e=>e.update(this)))}}},53:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971);t.default=class{constructor(e,t=64,i=64){this.entities=e,this.width=t,this.height=i,this.createBuffer(t,i)}draw(e,t){const{camera:i}=t;[...this.entities].filter((e=>e.bounds.overlaps(i.box))).forEach((t=>{this.bufferContext.clearRect(0,0,this.width,this.height),t.draw(this.bufferContext),e.drawImage(this.buffer,Math.floor(t.pos.x-i.box.left),Math.floor(t.pos.y-i.box.top))}))}createBuffer(e,t){this.bufferContext=s.CanvasRenderer.createRenderContext(e,t),this.buffer=this.bufferContext.canvas}}},6361:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971);t.default=class{constructor(e,t,i=8){this.img=e,this.y=t,this.scrollSpeed=i}draw(e,t){const{camera:i}=t,n=Math.floor(-i.box.left/this.scrollSpeed%this.img.width);n+this.img.width<s.FeatherEngine.screenSize.width&&e.drawImage(this.img,n+this.img.width,this.y),e.drawImage(this.img,n,this.y)}}},2440:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(8458);t.default=class{constructor(e){this.color=e}draw(e){n.drawRect(e,0,0,s.FeatherEngine.screenSize.width,s.FeatherEngine.screenSize.height,this.color,{filled:!0})}}},868:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6971);class a{constructor(){this.scenes={},this.currentSceneName="loadingScene",a.INSTANCE=this}load(){return s(this,void 0,void 0,(function*(){yield this.loadingScene.load()}))}start(){n.GameLoop.register({update:e=>{this.currentScene.update(e)}},{draw:e=>{this.currentScene.draw(e)}}),n.FeatherEngine.init({canvasId:"screen",width:512,height:448}),n.FeatherEngine.start()}setScene(e,t=!0){return s(this,void 0,void 0,(function*(){t&&(n.info(this,"Switch to Loadingscreen"),this.currentSceneName="loadingScene");const i=this.scenes[e];i.loaded||(n.info(this,`Loading Scene ${e}`),yield i.scene.load(),i.loaded=!0,n.info(this,`Scene ${e} loaded`)),yield i.scene.start(),this.currentSceneName=e}))}get currentScene(){return"loadingScene"===this.currentSceneName?this.loadingScene:this.scenes[this.currentSceneName].scene}addScenes(e){return e.forEach((e=>this.addScene(e))),this}addScene(e){const t=e();return t.isLoadingScene?this.loadingScene=t:this.scenes[t.name]={scene:t,loaded:!1},this}get size(){return Object.keys(this.scenes).length+(this.loadingScene?1:0)}}t.default=a},5392:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(8647)),a=i(6971),r=i(9044);t.default=class{constructor(e){this.tileProps=e,this.booleanTags=["solid","platform","onlyCrouch","deadly"]}create(e){const t=new a.Matrix;if(r.isInfiniteLayer(e)&&e.chunks.forEach((e=>{for(let i=0;i<e.width;i++)for(let s=0;s<e.height;s++){const n=e.data[s*e.width+i];0!==n&&this.setTile(t,n,this.tileProps[n],i+e.x,s+e.y)}})),r.isFiniteLayer(e))for(let i=0;i<e.width;i++)for(let s=0;s<e.height;s++){const n=e.data[s*e.width+i];0!==n&&this.setTile(t,n,this.tileProps[n],i+e.x,s+e.y)}return t}setTile(e,t,i,s,a){const r=this.booleanTags.filter((e=>this.hasEnabled(i,e)));i&&i.properties.some((e=>"other"===e.name&&e.value.includes("respawn")))&&r.push("respawn"),e.set(s,a,new n.default(`${t}`,r))}hasEnabled(e,t){return e&&e.properties.some((e=>e.name===t&&!0===e.value))}}},8254:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(9730),r=i(6971),o=i(8458),l=n(i(5392)),u=n(i(2943));t.default=class{constructor(e){this.path=e,this.loader=()=>r.loadJson(this.path),this.tilesetLoader=(e,t)=>new u.default(this.directory+e.source,e.firstgid).load(),this.directory=e.substr(0,this.path.lastIndexOf("/")+1)}load(){return s(this,void 0,void 0,(function*(){const e=yield this.loader();return this.map(e)}))}map(e){return s(this,void 0,void 0,(function*(){const t=e.tilewidth;t!==e.tileheight&&console.warn("tiles are not squared. May cause issues");const i=this.getUsedTileIds(e);console.log(`${i.length} Tiles required for stage`);const n=yield Promise.all([...e.tilesets].map((e=>s(this,void 0,void 0,(function*(){return this.tilesetLoader(e,i)})))));delete this.tilesetLoader;const a=this.merge(n);let r=this.getViewPorts(e);const o={tileset:a.tileset,tileSize:t,viewPorts:r};return o.layers=this.createTileMatrixes(e,a.tileMatrix),e.infinite?(o.width=e.width*e.layers[0].width,o.height=e.width*e.layers[0].height):(o.width=e.width,o.height=e.height),o}))}getUsedTileIds(e){return a.distinct(a.flatMap(e.layers.filter((e=>e.visible)).filter((e=>"tilelayer"===e.type)).map((e=>"chunks"in e?a.distinct(a.flatMap(e.chunks.map((e=>a.distinct(e.data))))):"data"in e?a.distinct(e.data):void 0))))}getViewPorts(e){const t=a.flatMap(e.layers.filter((e=>e.visible)).filter((e=>"objectgroup"===e.type)).map((e=>e.objects.map((e=>new r.BoundingBox(new r.Vector(e.x,e.y),new r.Vector(e.width,e.height)))))));return 0==t.length?[new r.BoundingBox(new r.Vector(0,0),new r.Vector(e.width*e.tilewidth,e.height*e.tileheight))]:t}createTileMatrixes(e,t){const i=new l.default(t);return e.layers.filter((e=>e.visible)).filter((e=>"tilelayer"===e.type)).map((e=>({name:e.name,matrix:i.create(e),frontLayer:this.hasEnabled(e,"frontLayer"),dynamic:this.hasEnabled(e,"dynamic")})))}hasEnabled(e,t){return e&&e.properties.some((e=>e.name===t&&!0===e.value))}merge(e){return e.reduce(((e,t)=>{const i=o.mergeImageContainer(e.tileset,t.tileset);return{tileMatrix:Object.assign(Object.assign({},e.tileMatrix),t.tileMatrix),tileset:i}}))}}},2943:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6971),a=i(8458);t.default=class{constructor(e,t){this.path=e,this.idOffset=t,this.loader=()=>n.loadJson(this.path),this.imageLoader=e=>n.loadImage(e),this.createTileSet=(e,t)=>new a.TileSet(e,t.tilewidth,t.tileheight),this.directory=e.substr(0,this.path.lastIndexOf("/")+1)}filteredBy(e){return this.onlyRequiredIds=e,this}load(){var e,t,i;return s(this,void 0,void 0,(function*(){const s=yield this.loader(),n=yield this.imageLoader(this.directory+s.image),r=this.createTileSet(n,s),o={};for(let n=0;n<s.tilecount;n++){const l=n+this.idOffset;if(this.onlyRequiredIds&&!this.onlyRequiredIds.includes(l))continue;const u=n%s.columns,c=Math.floor(n/s.columns);r.defineTile(`${l}`,u,c),s.tiles&&(o[n+this.idOffset]=s.tiles[n],(null===(e=s.tiles[n])||void 0===e?void 0:e.animation)&&(console.debug("add 1 animation "+l),r.defineAnim(`${l}`,a.createAnim(null===(t=s.tiles[n])||void 0===t?void 0:t.animation.map((e=>""+(e.tileid+this.idOffset))),(null===(i=s.tiles[n])||void 0===i?void 0:i.animation[0].duration)/1e3,!0))))}return this.finalize(),{tileset:r,tileMatrix:o}}))}finalize(){delete this.createTileSet,delete this.loader,delete this.onlyRequiredIds,delete this.imageLoader}}},9044:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFiniteLayer=t.isInfiniteLayer=void 0,t.isInfiniteLayer=function(e){return"chunks"in e},t.isFiniteLayer=function(e){return"data"in e}},8393:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(8458);t.default=class{constructor(e){this.cameraToDraw=e}draw(e){s.FeatherEngine.debugSettings.enabled&&n.drawRect(e,this.cameraToDraw.box.left,this.cameraToDraw.box.top,this.cameraToDraw.size.x,this.cameraToDraw.size.y,"purple")}}},2735:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(8458);t.default=class{draw(e,t){s.FeatherEngine.debugSettings.enabled&&n.drawRect(e,t.camera.edge.x,t.camera.edge.y,t.camera.size.x-2*t.camera.edge.x,t.camera.size.y-2*t.camera.edge.y,"green")}}},1359:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(803),a=s(i(8282)),r=i(4303),o=i(6971);t.default=class{constructor(){this.pos=new o.Vector(0,0),this.vel=new o.Vector(0,0),this.size=new o.Vector(16,16),this.offset=new o.Vector(0,0),this.lifeTime=0,this.state=n.EntityState.ACTIVE,this.spriteChanged=!1,this.bypassPlatform=!1,this.bounds=new o.BoundingBox(this.pos,this.size,this.offset),this.traits={},this.standingOn=new Set,this.events=new a.default}collide(e){this.getTraits().filter((e=>e.enabled)).forEach((t=>t.collides(this,e)))}update(e){this.getTraits().filter((e=>e.enabled)).forEach((t=>t.update(this,e))),this.lifeTime+=e.deltaTime,this.getTraits().filter((e=>e.enabled)).filter((e=>e.finalize)).forEach((e=>{e.finalize(),e.finalize=void 0})),this.standingOn.clear()}obstruct(e,t){e===r.Side.BOTTOM&&t.tile.types.forEach((e=>this.standingOn.add(e))),this.getTraits().filter((e=>e.enabled)).forEach((i=>i.obstruct(this,e,t)))}addTrait(e){this.traits[e.name]=e}addTraits(e){e.forEach((e=>this.addTrait(e)))}getTrait(e){return this.traits[(new e).name]}hasTrait(e){return null!=this.traits[(new e).name]}removeTraitByName(e){return!!this.traits[e]&&(delete this.traits[e],!0)}draw(e){}getTraits(){return Object.keys(this.traits).map((e=>this.traits[e]))}}},4975:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=i(6971);class r extends n.default{constructor(){super("cantGoLeft"),this.disabledForReset=!1,this.posOnScreen=new a.Vector(0,0)}}t.default=r},1864:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(803),a=s(i(4720)),r=s(i(4385));class o extends a.default{constructor(e="dead",t=1,i=2){super("killable"),this.deathAnim=e,this.maxHP=t,this.fadeoutTime=i,this.dead=!1,this.deadTime=0,this.invulnabilityTime=0,this.hp=1,this.hp=t}kill(e=1){this.invulnable||this.dead||(this.hp-=e,this.invulnabilityTime=1,this.hp<=0&&(this.finalize=()=>{this.dead=!0}))}revive(e){this.dead=!1,this.hp=this.maxHP,this.invulnabilityTime=0,this.deadTime=0,e.state=n.EntityState.ACTIVE}update(e,t){this.invulnabilityTime-=t.deltaTime,this.invulnabilityTime<=0?this.invulnabilityTime=0:this.invulnabilityTime>.8&&this.repulse(e),this.dead&&(this.deadTime+=t.deltaTime,-1!=this.fadeoutTime&&this.deadTime>this.fadeoutTime&&(e.state=n.EntityState.READY_TO_REMOVE))}get invulnable(){return this.invulnabilityTime>0}repulse(e){if(e.hasTrait(r.default)){console.log("repulsing");const t=e.getTrait(r.default);e.vel.x=100*-t.facingDirection,e.vel.y=-150}}}t.default=o},1285:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=s(i(4975)),r=s(i(1864));class o extends n.default{constructor(e){super("playerController"),this.level=e}setCheckpoint(e){this.checkPoint=e}setPlayer(e){this.player=e}update(){if(!this.level.entities.has(this.player)){const e=this.player.getTrait(r.default),t=this.player.getTrait(a.default);e.revive(this.player),t&&(t.disabledForReset=!0),this.player.pos.set(this.checkPoint.x*this.level.tilesize,this.checkPoint.y*this.level.tilesize),this.level.entities.add(this.player)}}}t.default=o},9631:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResumeGameEvent=t.PauseGameEvent=void 0,t.PauseGameEvent=class{constructor(){this.name="PauseGame"}},t.ResumeGameEvent=class{constructor(){this.name="ResumeGame"}}},6143:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(7219)),a=s(i(9560));t.default=class{constructor(e){this.entityCollider=new n.default(e.entities),this.tileCollider=new a.default(e,e.tilesize)}checkX(e){this.tileCollider.checkX(e)}checkY(e){this.tileCollider.checkY(e)}check(e){this.entityCollider.check(e)}}},2602:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(8218)),a=i(803),r=i(4522),o=s(i(20)),l=i(6971),u=s(i(1285)),c=s(i(7245));class d extends o.default{constructor(e){super(),this.tilesize=e,this.entities=new Set,this.gravity=new l.Vector(0,1500),this.time=0,this.paused=!1,this.levelTraits.push(new c.default)}update(e){super.update(e),this.eventBuffer.process("PauseGame",(()=>this.paused=!0)),this.eventBuffer.process("ResumeGame",(()=>this.paused=!1));const t={deltaTime:this.paused?0:e,level:this,camera:this.camera};this.camera.update(this.findPlayer(),Object.assign(Object.assign({},t),{deltaTime:e})),this.activateEntititesOnSight(t),this.getEntities(a.EntityState.ACTIVE).forEach((e=>e.update(t))),this.getEntities(a.EntityState.READY_TO_REMOVE).forEach((e=>this.entities.delete(e)));const i=this.getEntities(a.EntityState.ACTIVE),s=Math.max(0,i.length-150);s>0&&(i.filter((e=>e.hasTrait(n.default))).slice(0,s).forEach((e=>e.state=a.EntityState.UNTRIGGERED)),console.warn("removing "+s+" active Entities")),0===this.time&&this.init(),this.time+=e,this.getEntities(a.EntityState.ACTIVE).forEach((e=>{e.events.process(r.Names.playSFX,(({name:e,blocking:t})=>this.audioBoard.playAudio(e,t))),e.events.process(r.Names.spawn,(e=>{this.entities.add(e.entity)}))}))}getEntities(e){return[...this.entities].filter((t=>t.state===e))}activateEntititesOnSight(e){[...this.entities].filter((e=>e.hasTrait(n.default))).forEach((t=>t.getTrait(n.default).update(t,e)))}findPlayer(){return[...this.entities].filter((e=>e.hasTrait(u.default))).map((e=>e.getTrait(u.default).player))[0]}init(){}}t.default=d},7245:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(1486);t.default=class{update(e){e.entities.forEach((t=>s.LEVEL_COLLIDER.check(t,e)))}}},3625:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(i(8254)),r=i(6971);t.default=class{constructor(e){this.levelName=e}load(){return s(this,void 0,void 0,(function*(){const e=yield r.loadJson(`./levels/${this.levelName}/main.json`),t=yield new a.default(e.tiledMapPath).load();return Object.assign(Object.assign({},e),{tiledMap:t})}))}}},5221:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBrickTileHandler=void 0;const s=i(4303);t.createBrickTileHandler=function(){return{x:(e,t)=>{e.vel.x>0?e.bounds.right>t.x.from&&e.obstruct(s.Side.RIGHT,t):e.vel.x<0&&e.bounds.left<t.x.to&&e.obstruct(s.Side.LEFT,t)},y:(e,t,i)=>{e.vel.y>0?e.bounds.bottom>t.y.from&&e.obstruct(s.Side.BOTTOM,t):e.vel.y<0&&e.bounds.top<t.y.to&&(e.obstruct(s.Side.TOP,t),i.setByRange(t.x,t.y,void 0))}}}},7473:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971);t.default=class{constructor(e,t,i=32){this.tiles=e,this.tileset=t,this.chunkSize=i,this.chunks=new s.Matrix}draw(e,t){const{camera:i}=t,s={from:this.toChunkPosition(i.box.left),to:this.toChunkPosition(i.box.right)+1},n={from:this.toChunkPosition(i.box.top),to:this.toChunkPosition(i.box.bottom)+1};for(let t=s.from;t<s.to;t++)for(let s=n.from;s<n.to;s++)this.chunks.get(t,s)||this.prepareChunk(t,s),e.drawImage(this.chunks.get(t,s),t*this.tileset.tilesize*this.chunkSize-i.box.left,s*this.tileset.tilesize*this.chunkSize-i.box.top)}prepareChunk(e,t){const i=s.CanvasRenderer.createRenderContext(this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize),n=i.canvas,a={from:e*this.chunkSize,to:(e+1)*this.chunkSize},r={from:t*this.chunkSize,to:(t+1)*this.chunkSize};this.tiles.forEach((e=>{for(let t=a.from;t<a.to;t++)for(let s=r.from;s<r.to;s++){const n=e.get(t,s);n&&this.tileset.drawTile(n.name,i,t-a.from,s-r.from)}})),this.chunks.set(e,t,n)}toChunkPosition(e){return Math.floor(e/this.tileset.tilesize/this.chunkSize)}}},6859:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(8458);t.default=class{constructor(e){this.level=e,this.resolvedTiles=[],this.resolvedTiles=[],this.tileSize=e.tilesize;const t=e.levelLayer[0].getByIndex;e.levelLayer[0].getByIndex=(i,n)=>(s.FeatherEngine.debugSettings.enabled&&this.resolvedTiles.push({x:i,y:n}),t.call(e.levelLayer[0],i,n))}drawEntityFrames(e,t){this.level.entities.forEach((i=>n.drawRect(e,i.bounds.left-t.box.left,i.bounds.top-t.box.top,i.size.x,i.size.y,"red")))}drawTileFrames(e,t){this.resolvedTiles.forEach((({x:i,y:s})=>n.drawRect(e,i*this.tileSize-t.box.left,s*this.tileSize-t.box.top,this.tileSize,this.tileSize,"blue")))}draw(e,t){s.FeatherEngine.debugSettings.enabled&&(this.drawTileFrames(e,t.camera),this.drawEntityFrames(e,t.camera),this.resolvedTiles.length=0)}}},3511:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971);t.default=class{constructor(e,t,i,n=32){this.tiles=e,this.tileset=t,this.time=i,this.chunkSize=n,this.buffer=s.CanvasRenderer.createRenderContext(this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize)}draw(e,t){const{camera:i}=t,s={from:this.toChunkPosition(i.box.left),to:this.toChunkPosition(i.box.right)+1},n={from:this.toChunkPosition(i.box.top),to:this.toChunkPosition(i.box.bottom)+1};for(let t=s.from;t<s.to;t++)for(let s=n.from;s<n.to;s++)e.drawImage(this.prepareChunk(t,s),t*this.tileset.tilesize*this.chunkSize-i.box.left,s*this.tileset.tilesize*this.chunkSize-i.box.top)}prepareChunk(e,t){const i=this.buffer;i.clearRect(0,0,this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize);const s=i.canvas,n={from:e*this.chunkSize,to:(e+1)*this.chunkSize},a={from:t*this.chunkSize,to:(t+1)*this.chunkSize};return this.tiles.forEach((e=>{for(let t=n.from;t<n.to;t++)for(let s=a.from;s<a.to;s++){const r=e.get(t,s);r&&(this.tileset.isAnimatedTile(r.name)?this.tileset.drawAnim(r.name,i,t-n.from,s-a.from,this.time()):this.tileset.drawTile(r.name,i,t-n.from,s-a.from))}})),s}toChunkPosition(e){return Math.floor(e/this.tileset.tilesize/this.chunkSize)}}},6851:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(26)),a=i(6971),r=i(9631);class o extends n.default{constructor(e){super(),this.currentCamIndex=-1,this.cameras=e.map((e=>new n.default(e)))}get box(){return this.currentCam.box}get currentCam(){return this.cameras[this.currentCamIndex]}update(e,t){if(this.updateCurrentCam(e,t.level),this.currentCam.update(e,t),null!=this.transition){0==this.transition.delta&&(this.transition.targetPosition=this.currentCam.box.pos);const e=this.transition.get(1.5*t.deltaTime);this.currentCam.box.left=e.x,this.currentCam.box.top=e.y,this.transition.delta>=1&&(this.transition=null,t.level.eventBuffer.emit(new r.ResumeGameEvent))}}updateCurrentCam(e,t){const i=this.cameras.map((e=>e.viewPort)).findIndex((t=>t.overlaps(e.bounds)));-1!=i?(i!=this.currentCamIndex&&-1!==this.currentCamIndex&&(this.transition=new l(this.currentCam.box.pos,this.cameras[i].box.pos),t.eventBuffer.emit(new r.PauseGameEvent)),this.currentCamIndex=i):a.FeatherEngine.debugSettings.enabled&&(console.debug("[camera] no new Camera found!"),console.log(e.bounds),console.log(this.cameras.map((e=>e.box))))}}t.default=o;class l{constructor(e,t){this.currentPosition=e,this.targetPosition=t,this.delta=0}get(e){return this.delta+=e,this.delta>1&&(this.delta=1),new a.Vector(this.currentPosition.x*(1-this.delta)+this.targetPosition.x*this.delta,this.currentPosition.y*(1-this.delta)+this.targetPosition.y*this.delta)}}},2992:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDebugToLevel=void 0;const s=i(9992),n=i(6971);t.addDebugToLevel=function(e){window&&(window.addTrait=t=>{e.findPlayer().addTraits([s.traitRegistry.byName(t)])},window.removeTrait=t=>{e.findPlayer().removeTraitByName(t)},window.testingCheatsEnabled=e=>{n.FeatherEngine.debugSettings.enabled=e},window.hitboxesOnly=e=>{n.FeatherEngine.debugSettings.hitboxesOnly=e})}},30:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(7397),r=n(i(8738)),o=i(5692),l=[r.default,o.BlueSlimePrefab,o.RedSlimePrefab];t.default=class{prepare(){return s(this,void 0,void 0,(function*(){const e=yield Promise.all(l.map((e=>new e)).map((e=>s(this,void 0,void 0,(function*(){return{name:e.name,factory:yield e.create()}})))));a.setEntityRepo(e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.factory})),{}))}))}}},8738:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(2316)),a=s(i(8562)),r=s(i(3560)),o=s(i(6281)),l=s(i(1359)),u=s(i(1864)),c=i(6971),d=s(i(8115)),h=s(i(3738)),f=s(i(4385)),p=s(i(2229)),m=s(i(7371)),y=s(i(7347));class v extends n.default{constructor(){super("crow","crow"),this.entityFac=()=>new l.default,this.size=new c.Vector(16,32),this.offset=new c.Vector(8,0),this.traits=()=>[new o.default,new a.default(new c.Vector(0,750)),new r.default,new p.default,new f.default,new y.default,new h.default,new u.default("dead",3,0),new d.default,new m.default]}routeFrame(e,t){const i=e.getTrait(f.default),s=e.getTrait(p.default),n=e.getTrait(d.default),a=e.getTrait(h.default),r=e.getTrait(u.default);if(r.invulnable&&Math.floor(10*r.invulnabilityTime)%2==0)return"";if(n.down)return"crouch";if(null==a?void 0:a.gliding)return"fall-1";if(s.falling){const i=e.vel.y<0?"jump":"fall";return t.getAnimation(i)(s.timeOfCurrentPhase)}return 0!==i.distance&&0!==e.vel.x?t.getAnimation("run")(i.distance):"idle"}flipped(e){return-1==e.getTrait(f.default).facingDirection}}t.default=v},6555:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(2316)),a=s(i(1359)),r=i(6971);class o extends n.default{constructor(){super("loading","loading"),this.entityFac=()=>new a.default,this.size=new r.Vector(32,32),this.offset=new r.Vector(0,0),this.traits=()=>[]}routeFrame(e,t){return t.getAnimation("loading")(60*e.lifeTime)}}t.default=o},5692:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RedSlimePrefab=t.BlueSlimePrefab=void 0;const n=s(i(2316)),a=s(i(4720)),r=s(i(8562)),o=s(i(3560)),l=s(i(6281)),u=i(4303),c=s(i(1359)),d=s(i(1864)),h=i(6971),f=s(i(7347));class p{constructor(e,t,i){this.interval=e,this.f=i,this.currentTime=0,t&&(this.currentTime=Math.random()*e)}update(e,t){this.currentTime+=e,this.currentTime>=this.interval&&(this.currentTime=0,t?t():this.f())}}class m extends a.default{constructor(e=new p(3,!0)){super("slime_jumping"),this.jumpingInterval=e,this.direction=-1,this.jumping=!1,this.jumpTime=new p(.1),this.onGround=!0}update(e,t){this.onGround&&this.jumpingInterval.update(t.deltaTime,(()=>{this.jumping=!0})),this.jumping&&(e.vel.x=100*this.direction,e.vel.y=-200,this.jumpTime.update(t.deltaTime,(()=>{this.jumping=!1,this.jumpTime=new p(.2*Math.random())})))}obstruct(e,t){t===u.Side.BOTTOM&&(this.onGround=!0,this.jumping=!1,e.vel.x=0)}collides(e,t){const i=t.getTrait(f.default),s=t.getTrait(d.default),n=e.getTrait(d.default);n.dead||i&&(i.fromAbove(t,e)?n&&(this.enabled=!1,n.kill()):s.kill())}}class y extends a.default{constructor(){super("slime_random_turn"),this.changeDir=new p(2)}update(e,t){this.lastDelta=t.deltaTime}obstruct(e,t){t===u.Side.BOTTOM&&this.changeDir.update(this.lastDelta,(()=>{e.getTrait(m).direction=Math.sign(Math.random()-.5)}))}}class v extends a.default{constructor(){super("slime_random_turn"),this.changeDir=new p(2)}update(e,t){this.lastDelta=t.deltaTime,this.deltaToPlayer=t.level.findPlayer().pos.x-e.pos.x}obstruct(e,t){t===u.Side.BOTTOM&&(e.getTrait(m).direction=Math.sign(this.deltaToPlayer))}}class g extends n.default{constructor(e,t,i){super(e,e),this.entityFac=()=>new c.default,this.size=new h.Vector(16,16),this.offset=new h.Vector(0,0),this.traits=()=>[new r.default,new l.default,new o.default,new d.default("dead",1,0),i(),new t]}flipped(e){return-1==e.getTrait(m).direction}routeFrame(e,t){return e.getTrait(m),t.getAnimation("idle")(60*e.lifeTime)}}t.BlueSlimePrefab=class extends g{constructor(){super("blue_slime",y,(()=>new m(new p(3,!0))))}},t.RedSlimePrefab=class extends g{constructor(){super("red_slime",v,(()=>new m(new p(3,!0))))}}},8115:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=i(6971);class r extends n.default{constructor(){super("crouch"),this._down=!1,this.lockDown=!1,this.requestEnd=!1}update(e){this._down&&this.resetSize(e),this.requestEnd&&(this.lockDown||this.end(e)),this.lockDown=!1}end(e){this.memoSize&&(e.pos.y-=8,e.size.set(this.memoSize.x,this.memoSize.y),e.offset.set(this.memoOffset.x,this.memoOffset.y),this.memoSize=void 0,this.memoOffset=void 0),this._down=!1,this.requestEnd=!0}start(){this._down=!0,this.requestEnd=!1}cancel(){this.requestEnd=!0}get down(){return this._down}resetSize(e){this.memoSize||(this.memoSize=new a.Vector(e.size.x,e.size.y),this.memoOffset=new a.Vector(e.offset.x,e.offset.y),e.pos.y+=8,e.size.set(24,24),e.offset.set(0,0))}}t.default=r},3738:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=s(i(8562)),r=i(4303);class o extends n.default{constructor(){super("glide"),this.gliding=!1}start(){this.gliding=!0}cancel(){this.gliding=!1}update(e,t){const i=e.getTrait(a.default);this.gliding&&i&&this.enabled&&(e.vel.y=.95*i.gravity.y*t.deltaTime)}obstruct(e,t){switch(t){case r.Side.BOTTOM:case r.Side.TOP:this.cancel()}}}t.default=o},4385:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=i(4522),r=i(4303),o=s(i(1864)),l=i(6971),u=s(i(8115)),c=s(i(2229));class d extends n.default{constructor(){super("go"),this.dirOfAppliedForce=0,this.acceleration=400,this.deceleration=300,this.distance=0,this.facingDirection=0,this.running=!1}get dragFactor(){return this.running?2e-4:5e-4}obstruct(e,t){t!==r.Side.LEFT&&t!==r.Side.RIGHT||(0!=this.distance&&e.events.emit(new a.SfxEvent({name:"bump"})),this.distance=0)}update(e,t){e.bounds.left<0&&(e.bounds.left=0);const i=e.getTrait(c.default),s=e.getTrait(o.default),n=e.getTrait(u.default);if(0!==this.dirOfAppliedForce&&i&&!i.falling&&(this.facingDirection=this.dirOfAppliedForce),n.down)return void this.decelToStand(e,t.deltaTime);if(s&&s.dead)return void e.vel.set(0,0);const a=Math.abs(e.vel.x);0!==this.dirOfAppliedForce?e.vel.x+=this.acceleration*this.dirOfAppliedForce*t.deltaTime:0!==e.vel.x?this.decelToStand(e,t.deltaTime):(l.FeatherEngine.debugSettings.enabled&&0!==this.distance&&console.log("Standing at",Math.round(e.pos.x/16),Math.round(e.pos.y/16)),this.distance=0);const r=this.dragFactor*e.vel.x*a;e.vel.x-=r,this.distance+=a*t.deltaTime}decelToStand(e,t){const i=Math.abs(e.vel.x),s=Math.min(i,this.deceleration*t);e.vel.x+=e.vel.x>0?-s:s}right(e){this.dirOfAppliedForce+=e?1:-1}left(e){this.dirOfAppliedForce-=e?1:-1}}t.default=d},2229:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=s(i(8282)),r=i(4522),o=i(4303),l=s(i(8115));class u{constructor(){this.name="JumpButtonPressed",this.payload=null}}class c{constructor(){this.name="JumpButtonReleased",this.payload=null}}class d{constructor(e){this.startVal=e,this.currentVal=e}decrease(e){this.currentVal-=e}reset(){this.currentVal=this.startVal}toZero(){this.currentVal=0}notZero(){return this.currentVal>0}get delta(){return this.startVal-this.currentVal}}class h extends n.default{constructor(){super("jump"),this.eventBuffer=new a.default,this.velocity=220,this.raisingTime=new d(.15),this.onGround=0,this.distance=0,this.lastDir=0,this.raisingTime.toZero()}start(){this.eventBuffer.emit(new u)}cancel(){this.eventBuffer.emit(new c)}update(e,t){this.eventBuffer.process("JumpButtonReleased",(()=>{this.raisingTime.toZero(),e.vel.y<0&&(e.vel.y=-this.velocity/2)})),this.eventBuffer.process("JumpButtonPressed",(()=>{const t=e.getTrait(l.default);if(null==t?void 0:t.down)return e.standingOn.has("platform")&&(e.bypassPlatform=!0),void this.raisingTime.toZero();this.falling||(e.bypassPlatform=!0,this.raisingTime.reset(),e.events.emit(new r.SfxEvent({name:"jump"})))})),this.raisingTime.notZero()&&(e.bypassPlatform=!1,e.vel.y=-this.velocity,this.raisingTime.decrease(t.deltaTime));const i=Math.sign(e.vel.y);this.lastDir!=i&&(this.distance=0),this.lastDir=i;const s=Math.abs(e.vel.y);this.distance+=s*t.deltaTime,this.onGround--}obstruct(e,t){t===o.Side.BOTTOM?(this.onGround=1,this.distance=0):t===o.Side.TOP&&(this.cancel(),this.distance=0)}get falling(){return this.onGround<0}get timeOfCurrentPhase(){return this.distance}}t.default=h},7747:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=i(4522);class r extends n.default{constructor(e){super("leveltimer"),this.totalTime=300,this.currentTime=0,this.hurried=!1,e&&(this.totalTime=e.estimateTime)}update(e,t){this.currentTime+=t.deltaTime,this.restTime<=100&&!this.hurried&&(this.hurried=!0,e.events.emit(new a.SfxEvent({name:"hurry",blocking:!0})))}get restTime(){return this.totalTime-this.currentTime}}t.default=r},7371:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720));class a extends n.default{constructor(){super("player"),this.lives=3,this.c=0,this.score=0}update(e){e.events.process("stomp",(()=>this.score+=100))}get coins(){return this.c}set coins(e){e>=100&&(this.lives++,e-=100,console.log("1-up")),this.c=e}}t.default=a},7347:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4720)),a=i(4522),r=s(i(1864)),o=i(4684);class l extends n.default{constructor(){super("stomper"),this.bounceSpeed=150,this.quereBounce=!1,this.stomped=!1}fromAbove(e,t){return e.vel.y>t.vel.y}collides(e,t){const i=t.getTrait(r.default);e.getTrait(r.default).finalize||e.getTrait(r.default).dead||i&&!i.dead&&this.fromAbove(e,t)&&(this.bounce(e,t),e.events.emit(new a.SfxEvent({name:"stomp"})),e.events.emit(new o.StompEvent({us:e,them:t})))}bounce(e,t){this.finalize=()=>{e.bounds.bottom=t.bounds.top,e.vel.y=-this.bounceSpeed}}}t.default=l},4684:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StompEvent=void 0,t.StompEvent=class{constructor(e){this.payload=e,this.name="stomp"}}},540:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(i(868)),r=n(i(1766)),o=n(i(6832)),l=n(i(8062));t.default=class{constructor(e){this.canvasId=e}start(){return s(this,void 0,void 0,(function*(){const e=(new a.default).addScenes([()=>new r.default,()=>new o.default,()=>new l.default]);yield e.load(),e.start(),e.setScene(o.default.NAME)}))}}},46:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(7397),r=i(803),o=i(9560),l=n(i(9822)),u=n(i(53)),c=n(i(6361)),d=n(i(2440)),h=n(i(2602)),f=n(i(3625)),p=i(5221),m=n(i(7473)),y=n(i(6859)),v=n(i(3511)),g=i(6971),_=n(i(30)),w=i(1173),b=i(6563);t.default=class{constructor(e){this.levelName=e}load(){return s(this,void 0,void 0,(function*(){const e=yield new f.default(this.levelName).load();yield(new _.default).prepare();const t=e.tiledMap.tileset,i=new h.default(e.tiledMap.tileSize);i.name=this.levelName,i.width=e.tiledMap.width,i.height=e.tiledMap.height,e.entities&&e.entities.forEach((({name:e,pos:[s,n]})=>{const r=a.entityRepo[e]();r.pos.set(s*t.tilesize,n*t.tilesize),i.entities.add(r)}));const n=a.entityRepo.crow();n.state=r.EntityState.ACTIVE,i.startPosition=new g.Vector(e.startPosition.x,e.startPosition.y),i.estimateTime=e.estimateTime,i.bgm=e.bgm;const S=e.tiledMap.layers.map((e=>new l.default(e,i.tilesize)));i.levelLayer=S;const x=[];return x.push(new d.default("#6B88FE")),e.parallax&&x.push(...yield Promise.all(e.parallax.map((e=>s(this,void 0,void 0,(function*(){return new c.default(yield g.loadImage(e.img),e.y,e.speed)})))))),x.push(new m.default(e.tiledMap.layers.filter((e=>!e.frontLayer&&!e.dynamic)).map((e=>e.matrix)),e.tiledMap.tileset),new v.default(e.tiledMap.layers.filter((e=>!e.frontLayer&&e.dynamic)).map((e=>e.matrix)),e.tiledMap.tileset,(()=>i.time)),new u.default(i.entities),new m.default(e.tiledMap.layers.filter((e=>e.frontLayer&&!e.dynamic)).map((e=>e.matrix)),e.tiledMap.tileset),new v.default(e.tiledMap.layers.filter((e=>e.frontLayer&&e.dynamic)).map((e=>e.matrix)),e.tiledMap.tileset,(()=>i.time))),x.push(new y.default(i)),o.addHandler("brick",p.createBrickTileHandler()),o.addHandler("onlyCrouch",b.createOnlyCrouchTileHandler()),o.addHandler("deadly",w.createDeadlyHandler()),{level:i,player:n,renderer:x,viewPorts:e.tiledMap.viewPorts}}))}}},1173:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createDeadlyHandler=void 0;const n=s(i(1864));t.createDeadlyHandler=function(){return{x:e=>{const t=e.getTrait(n.default);null==t||t.kill()},y:e=>{const t=e.getTrait(n.default);null==t||t.kill()}}}},6563:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createOnlyCrouchTileHandler=void 0;const n=s(i(8115));t.createOnlyCrouchTileHandler=function(){return{x:()=>{},y:e=>{const t=e.getTrait(n.default);t&&(t.lockDown=!0)}}}},9144:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(8458);t.default=class{constructor(e,t){this.font=e,this.level=t}draw(e){n.drawRect(e,0,23*this.level.tilesize,s.FeatherEngine.screenSize.width,5*this.level.tilesize,"black",{filled:!0})}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}},1766:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(i(26)),r=n(i(53)),o=n(i(2440)),l=n(i(6555)),u=i(6971);t.default=class{constructor(){this.name="loadingScene",this.isLoadingScene=!0}load(){return s(this,void 0,void 0,(function*(){this.bg=[],this.bg.push(new o.default("#555b6d")),this.loadingAnimation=(yield(new l.default).create())(),this.loadingAnimation.pos.set(448,392);const e=new Set;e.add(this.loadingAnimation),this.bg.push(new r.default(e))}))}start(){return s(this,void 0,void 0,(function*(){}))}update(e){this.loadingAnimation.lifeTime+=e}draw(e){this.bg.forEach((t=>t.draw(e,{camera:new a.default(new u.BoundingBox(new u.Vector(0,0),new u.Vector(u.FeatherEngine.screenSize.width,u.FeatherEngine.screenSize.height)),new u.Vector(u.FeatherEngine.screenSize.width,u.FeatherEngine.screenSize.height))})))}}},6431:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.mainMenu=e}keyDown(e){switch(e){case"Space":this.mainMenu.submit();break;case"KeyW":this.mainMenu.option--;break;case"KeyS":this.mainMenu.option++}}keyUp(e){}keyPressed(e){}}},7277:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(8458);t.default=class{constructor(e,t){this.font=e,this.mainMenu=t}draw(e){n.drawRect(e,0,0,s.FeatherEngine.screenSize.width,s.FeatherEngine.screenSize.height,"black",{filled:!0}),this.font.print("Continue",e,s.FeatherEngine.screenSize.width/2-32,300),this.font.print("New Game",e,s.FeatherEngine.screenSize.width/2-32,324),this.font.print(">",e,s.FeatherEngine.screenSize.width/2-32-16,300+24*this.mainMenu.option)}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}},6832:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(i(26)),r=n(i(868)),o=i(6971),l=i(8458),u=n(i(6431)),c=n(i(7277));class d{constructor(){this.name=d.NAME,this.isLoadingScene=!1,this._option=0,this.camera=new a.default}load(){return s(this,void 0,void 0,(function*(){const e=yield new l.FontLoader("./img/font.png").load();this.layer=new c.default(e,this)}))}start(){return s(this,void 0,void 0,(function*(){o.KeyboardInput.addKeyListener(new u.default(this))}))}update(e){}draw(e){this.layer.draw(e,{camera:this.camera})}get option(){return this._option}set option(e){this._option=(e<0?e+2:e)%2}submit(){const e=o.FeatherEngine.getSaveDataSystem();switch(this.option){case 0:e.loadCurrentData(0);break;case 1:e.clearData(),e.pushData(this.newGame())}r.default.INSTANCE.setScene("game")}newGame(){return{stage:{name:"forest"}}}}t.default=d,d.NAME="main-menu"},8062:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(803),r=n(i(3407)),o=i(9545),l=n(i(8393)),u=n(i(2735)),c=n(i(1359)),d=n(i(1285)),h=n(i(6851)),f=i(6971),p=i(8458),m=i(2992),y=n(i(7747)),v=n(i(46)),g=n(i(9144)),_=n(i(7655));class w{constructor(){this.name=w.NAME,this.isLoadingScene=!1}createPlayerEnv(e,t){const i=new c.default,s=new d.default(t),n=new y.default(t);return i.state=a.EntityState.ACTIVE,e.pos.set(t.startPosition.x*t.tilesize,t.startPosition.y*t.tilesize),s.setPlayer(e),s.setCheckpoint(t.startPosition),i.addTraits([s,n]),i}load(){return s(this,void 0,void 0,(function*(){let e=f.FeatherEngine.getSaveDataSystem().getData();const{level:t,player:i,renderer:s,viewPorts:n}=yield new v.default(e.stage.name).load(),c=new AudioContext,d=yield new r.default(c,"./sfx/audio.json").load(),y=yield new p.FontLoader("./img/font.png").load();f.KeyboardInput.clearKeyListeners(),f.KeyboardInput.addKeyListener(new _.default(i));const w=new h.default(n);e.position&&t.startPosition.set(e.position.x/t.tilesize,e.position.y/t.tilesize);const b=this.createPlayerEnv(i,t);i.state=a.EntityState.ACTIVE,t.entities.add(b),t.audioBoard=d,s.push(new l.default(w),new u.default,new g.default(y,t)),t.camera=w,this.level=t,s.forEach((e=>o.LEVEL_RENDERER.addLayer(e))),this.player=i,m.addDebugToLevel(t)}))}update(e){this.level.update(e)}draw(e){o.LEVEL_RENDERER.render(e,this.level)}start(){return s(this,void 0,void 0,(function*(){}))}}t.default=w,w.NAME="game"},7655:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(1864)),a=i(6971),r=s(i(8115)),o=s(i(3738)),l=s(i(4385)),u=s(i(2229));t.default=class{constructor(e){this.playerFigure=e}keyDown(e){const t=this.playerFigure.getTrait(l.default),i=this.playerFigure.getTrait(u.default),s=this.playerFigure.getTrait(r.default),c=this.playerFigure.getTrait(o.default),d=this.playerFigure.getTrait(n.default);switch(e){case"Space":c&&i.falling?c.start():i.start();break;case"KeyS":i.falling||s.start();break;case"KeyA":t.left(!0);break;case"KeyD":t.right(!0);break;case"Digit5":a.FeatherEngine.getSaveDataSystem().pushData({position:this.playerFigure.pos,life:d.hp,stage:{name:"forest"}}),a.FeatherEngine.getSaveDataSystem().storeCurrentData(0);break;case"Digit9":a.FeatherEngine.getSaveDataSystem().loadCurrentData(0);const n=a.FeatherEngine.getSaveDataSystem().getData();null!=n&&(this.playerFigure.pos.set(n.position.x,n.position.y),d.hp=n.life);break;default:a.log(this,`Key ${e} was pressed without listener`)}}keyUp(e){const t=this.playerFigure.getTrait(l.default),i=this.playerFigure.getTrait(u.default),s=this.playerFigure.getTrait(r.default),n=this.playerFigure.getTrait(o.default);switch(e){case"Space":n&&n.gliding?n.cancel():i.cancel();break;case"KeyS":s.cancel();break;case"KeyA":t.left(!1);break;case"KeyD":t.right(!1)}}keyPressed(e){}}},5401:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(i(540));!function(){s(this,void 0,void 0,(function*(){const e=new a.default("screen");yield e.start()}))}()},6971:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.FeatherEngine=t.KeyboardInput=void 0;const a=i(8073);t.FeatherEngine=a.default;var r=i(4292);Object.defineProperty(t,"KeyboardInput",{enumerable:!0,get:function(){return r.KeyboardInput}}),n(i(322),t),n(i(5967),t),n(i(2667),t),n(i(8821),t),n(i(9956),t),n(i(9067),t),n(i(4167),t),n(i(2330),t)},4292:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardInput=t.KeyState=void 0;const s=i(322),n=i(8821);var a;!function(e){e[e.PRESSED=0]="PRESSED",e[e.RELEASED=1]="RELEASED"}(a=t.KeyState||(t.KeyState={}));class r{constructor(){this.keyStates={},this.keyStatesChanges={},this.keyListeners=[],this.registered=!1}static get instance(){return r._instance||(r._instance=new r,s.GameLoop.register(r._instance)),r._instance}static addKeyListener(e){r.instance.addKeyListener(e)}static clearKeyListeners(){r.instance.keyListeners.length=0}handleInput(){this.registered||(this.listenTo(window),this.registered=!0),Object.entries(this.keyStatesChanges).forEach((([e,t])=>{t==a.PRESSED?this.keyListeners.forEach((t=>t.keyDown(e))):this.keyListeners.forEach((t=>t.keyUp(e)))})),this.keyStatesChanges={},Object.entries(this.keyStates).filter((([,e])=>e===a.PRESSED)).forEach((([e])=>{this.keyListeners.forEach((t=>t.keyPressed(e)))}))}addKeyListener(e){this.keyListeners.push(e)}handleEvent(e){const{code:t,type:i}=e,s="keydown"===i?a.PRESSED:a.RELEASED;this.keyStates[t]!==s&&(this.keyStates[t]=s,this.keyStatesChanges[t]=s)}listenTo(e){n.info(this,"Register at window"),["keydown","keyup"].forEach((t=>{e.addEventListener(t,(e=>this.handleEvent(e)))}))}}t.KeyboardInput=r},8073:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(322),n=i(8821),a=i(9956),r=i(4167),o=i(4830);class l{constructor(){this.initialized=!1,this.config=null,this.renderer=null,this.debugSettings={enabled:!1,hitboxesOnly:!1,showFPS:!1}}static init(e){l.instance.init(e)}static start(){l.instance.start()}static get Renderer(){return l.instance.renderer}static getSaveDataSystem(){return void 0===this.saveDataSystem&&(this.saveDataSystem=new r.LocalStorageSaveDataSystem(new o.JSONSaveDataMarshaller)),this.saveDataSystem}static setSaveDataSystem(e){this.saveDataSystem=e}static get screenSize(){var e,t;const i=null===(e=l.instance.config)||void 0===e?void 0:e.width,s=null===(t=l.instance.config)||void 0===t?void 0:t.height;return{width:null!=i?i:0,height:null!=s?s:0}}static get debugSettings(){return l.instance.debugSettings}init(e){this.initialized?n.warn(this,"Engine was initialized already, new config will be ignored."):e?(this.config=e,this.renderer=new a.CanvasRenderer(e),this.initialized=!0):n.warn(this,"config is empty and will be ignored.")}start(){this.initialized?s.GameLoop.start():n.error(this,"Engine was not initialized, but tried to start. call `FeatherEngine.init(<config>)` first.")}}t.default=l,l.instance=new l},5967:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},322:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameLoop=void 0;const s=i(8073),n=i(8821),a=i(6130);class r{constructor(){this.onInput=[],this.onUpdate=[],this.onDraw=[],this.timer=null}static register(...e){r.instance.register(...e)}static start(){r.instance.start()}static cancel(){r.instance.cancel()}register(...e){e.forEach((e=>{let t=!1;"function"==typeof e.handleInput&&(this.onInput.push(e),t=!0),"function"==typeof e.update&&(this.onUpdate.push(e),t=!0),"function"==typeof e.draw&&(this.onDraw.push(e),t=!0),t||n.info(this,"Registration of listener failed")}))}start(){this.timer?n.warn(this,"There is already a timer, this one needs to be canceled"):(n.info(this,"Starting GameLoop"),this.timer=new a.default((e=>this.update(e,s.default.Renderer.context))),this.timer.start())}update(e,t){this.onInput.forEach((e=>e.handleInput())),this.onUpdate.forEach((t=>t.update(e))),this.onDraw.forEach((e=>e.draw(t)))}cancel(){var e;null===(e=this.timer)||void 0===e||e.cancel(),this.timer=null}}t.GameLoop=r,r.instance=new r},6130:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(8821);t.default=class{constructor(e,t=1/60){this.updateFunc=e,this.deltaTime=t,this.fps=0,this.lastTime=0,this.accumulatedTime=0,this._fps=0,this.canceled=!1}update(e){const t=(e-this.lastTime)/1e3;for(this.accumulatedTime+=t,this.accumulatedTime>1&&(this.accumulatedTime=1,s.warn(this,"resolve sleeping"));this.accumulatedTime>this.deltaTime;)this.updateFunc(this.deltaTime),this.accumulatedTime-=this.deltaTime;this.lastTime=e,this.canceled||this.enqueue()}start(){this.enqueue(),this.updateFps()}cancel(){this.canceled=!0}enqueue(){this._fps++,requestAnimationFrame((e=>this.update(e)))}updateFps(){setTimeout((()=>{this.fps=this._fps,this._fps=0,this.updateFps()}),1e3)}}},2667:function(e,t){var i=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=t.loadJson=void 0,t.loadJson=function(e){return i(this,void 0,void 0,(function*(){try{const t=yield fetch(e);if(200===t.status)return t.json()}catch(e){}return{}}))},t.loadImage=function(e){return i(this,void 0,void 0,(function*(){const t=new Image;return t.src=e,yield t.decode(),t}))}},8821:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.info=t.error=t.warn=t.debug=t.log=void 0,t.log=function(e,t){console.log(`[-Engine:${e.constructor.name}]: ${t}`)},t.debug=function(e,t){console.debug(`[-Engine:${e.constructor.name}]: ${t}`)},t.warn=function(e,t){console.warn(`[-Engine:${e.constructor.name}]: ${t}`)},t.error=function(e,t){console.error(`[-Engine:${e.constructor.name}]: ${t}`)},t.info=function(e,t){console.info(`[-Engine:${e.constructor.name}]: ${t}`)}},3161:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(1260);t.default=class{constructor(e,t,i=new s.default(0,0)){this.pos=e,this.size=t,this.offset=i}overlaps(e){return this.bottom>e.top&&this.top<e.bottom&&this.left<e.right&&this.right>e.left}get bottom(){return this.pos.y+this.size.y+this.offset.y}set bottom(e){this.pos.y=e-(this.size.y+this.offset.y)}get top(){return this.pos.y+this.offset.y}set top(e){this.pos.y=e-this.offset.y}get left(){return this.pos.x+this.offset.x}set left(e){this.pos.x=e-this.offset.x}get right(){return this.pos.x+this.size.x+this.offset.x}set right(e){this.pos.x=e-(this.size.x+this.offset.x)}}},1224:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.random=t.intRange=t.cross=void 0,t.cross=function(e,t){return e.reduce(((e,i)=>e.concat(t.map((e=>[i,e])))),[])},t.intRange=function(e,t){return e>=t?[]:Array.from(Array(t-e).keys()).map((t=>t+e))},t.random=function(e){return Math.floor(e*Math.random())}},851:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.grid=[]}set(e,t,i){this.grid[e]||(this.grid[e]=[]),this.grid[e][t]=i}get(e,t){return this.grid[e]?this.grid[e][t]:void 0}forEach(e){this.grid.forEach(((t,i)=>{t.forEach(((t,s)=>{e(i,s,t)}))}))}}},1260:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}set(e,t){this.x=e,this.y=t}getScaledBy(e){return new i(this.x*e,this.y*e)}}t.default=i,i.UP=new i(0,-1),i.DOWN=new i(0,1),i.LEFT=new i(-1,0),i.RIGHT=new i(1,0)},9956:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasRenderer=void 0;class i{constructor({canvasId:e}){this.canvas=document.getElementById(e);const t=this.canvas.getContext("2d");this._context=t}get context(){return this._context}static createRenderContext(e,t){return i.createCanvas(e,t).getContext("2d")}static createCanvas(e,t){if("function"==typeof OffscreenCanvas)return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}}t.CanvasRenderer=i},4167:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageSaveDataSystem=t.SaveDataSystem=void 0;class i{constructor(e){this.marshaller=e,this.currentData={}}pushData(e){this.currentData=Object.assign(Object.assign({},this.currentData),e)}getData(){return this.currentData}clearData(){this.currentData={}}}t.SaveDataSystem=i,t.LocalStorageSaveDataSystem=class extends i{constructor(){super(...arguments),this.storage=localStorage}loadCurrentData(e){const t=this.storage.getItem("save_"+e);this.currentData=null!==t?this.marshaller.unmarshal(t):{}}storeCurrentData(e){const t=this.marshaller.marshal(this.currentData);this.storage.setItem("save_"+e,t)}}},4830:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JSONSaveDataMarshaller=void 0,t.JSONSaveDataMarshaller=class{marshal(e){return JSON.stringify(e)}unmarshal(e){return JSON.parse(e)}}},9067:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2330:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.Vector=t.Matrix=t.BoundingBox=void 0;const a=i(3161);t.BoundingBox=a.default;const r=i(851);t.Matrix=r.default;const o=i(1260);t.Vector=o.default,n(i(1224),t)},8458:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.mergeImageContainer=t.TileSet=t.SpriteSheet=t.ImageContainer=t.Font=void 0,n(i(5745),t),n(i(5580),t),n(i(8815),t),n(i(411),t);const a=i(4754);t.Font=a.default;const r=i(7015);t.ImageContainer=r.default,Object.defineProperty(t,"mergeImageContainer",{enumerable:!0,get:function(){return r.mergeImageContainer}});const o=i(3510);t.SpriteSheet=o.default;const l=i(2697);t.TileSet=l.default},5745:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAnim=void 0,t.createAnim=function(e,t,i){return s=>{const n=Math.abs(s)/t;let a;return a=i?Math.floor(n%e.length):Math.floor(Math.min(n,e.length-1)),e[a]}}},4754:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(3510);class n extends s.default{constructor(e,t,i){super(e,t,i,!1)}print(e,t,i,s){for(let n=0;n<e.length;n++){const a=e.charAt(n);this.draw(a,t,i+8*n,s)}}}t.default=n},5580:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRect=void 0,t.drawRect=function(e,t,i,s,n,a,r={filled:!1}){if(r.filled)return e.fillStyle=a,void e.fillRect(Math.floor(t),Math.floor(i),Math.floor(s),Math.floor(n));e.strokeStyle=a,e.beginPath(),e.rect(Math.floor(t),Math.floor(i),Math.floor(s),Math.floor(n)),e.stroke()}},7015:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeImageContainer=void 0;const s=i(6971);t.default=class{constructor(e,t=!1){if(this.img=e,this.flippable=t,this.ref=[],this.animations={},this.ref=[{img:e,pos:{}}],t){const t=s.CanvasRenderer.createRenderContext(e.width,e.height);t.scale(-1,1),t.translate(-e.width,0),t.drawImage(this.img,0,0),this.ref.push({img:t.canvas,pos:{}})}}define(e,t,i,n,a,r=!1){r?(this.flippable||s.error(this,"This imagecontainer is not flippable, however, a flipped tile was tried to defined."),this.ref[1].pos[e]={x:this.ref[1].img.width-n-t,y:i,width:n,height:a}):this.ref[0].pos[e]={x:t,y:i,width:n,height:a}}defineAnim(e,t){this.animations[e]=t}getImage(e){const t=this.ref.filter((t=>!!t.pos[e]))[0];if(t)return Object.assign({img:t.img},t.pos[e])}},t.mergeImageContainer=function(e,t){return e.animations=Object.assign(Object.assign({},e.animations),t.animations),e.ref=[...e.ref,...t.ref],e}},8236:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6971),a=i(4754);t.default=class{constructor(e){this.fontPath=e,this.CHARS=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"}load(){return s(this,void 0,void 0,(function*(){const e=yield this.loadImage(),t=e.width,i=this.createNewFont(e,8,8);for(const[e,s]of[...this.CHARS].entries()){const n=8*e%t,a=8*Math.floor(8*e/t);i.define(s,n,a,8,8)}return i}))}loadImage(){return s(this,void 0,void 0,(function*(){return n.loadImage(this.fontPath)}))}createNewFont(e,t,i){return new a.default(e,t,i)}}},9819:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(6971),a=i(5745),r=i(3510);t.default=class{constructor(e){this.name=e}load(){return s(this,void 0,void 0,(function*(){const e=yield this.loadSheetSpec(),t=yield this.loadImage(e),i=this.createNewSpriteSheet(t,e.tileW,e.tileH);return e.frames&&e.frames.forEach((({name:e,rect:[t,s,n,a]})=>{i.define(e,t,s,n,a)})),e.animations&&e.animations.forEach((e=>{var t;const s=a.createAnim(e.frames,e.frameLen,null===(t=null==e?void 0:e.loop)||void 0===t||t);i.defineAnim(e.name,s)})),i}))}loadImage(e){return s(this,void 0,void 0,(function*(){return yield n.loadImage(e.imageURL)}))}loadSheetSpec(){return s(this,void 0,void 0,(function*(){return n.loadJson(`./sprites/${this.name}.json`)}))}createNewSpriteSheet(e,t,i){return new r.default(e,t,i)}}},3510:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(5580),a=i(7015);class r extends a.default{constructor(e,t,i,s=!0){super(e,s),this.w=t,this.h=i}define(e,t,i,s,n){super.define(e,t,i,s,n,!1),this.flippable&&super.define(e+"_switched",t,i,s,n,!0)}draw(e,t,i,a,r=!1){const o=this.getImage(e+(r?"_switched":""));o?t.drawImage(o.img,o.x,o.y,o.width,o.height,i,a,o.width,o.height):s.FeatherEngine.debugSettings.enabled?n.drawRect(t,i,a,this.w,this.h,"magenta",{filled:!0}):t.clearRect(i,a,this.w,this.h)}getAnimation(e){return this.animations[e]||(()=>"")}}t.default=r},2697:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=i(6971),n=i(5580),a=i(7015);class r extends a.default{constructor(e,t,i){super(e),this.width=t,this.height=i,this.tilesize=i}defineTile(e,t,i){this.define(e,t*this.width,i*this.height,this.width,this.height)}isAnimatedTile(e){return!!this.animations[e]}drawAnim(e,t,i,s,n){const a=this.animations[e];a&&this.drawTile(a(n),t,Math.floor(i),Math.floor(s))}drawTile(e,t,i,s){this.draw(e,t,Math.floor(this.width*i),Math.floor(this.height*s))}draw(e,t,i,a){const r=this.getImage(e);r?t.drawImage(r.img,r.x,r.y,r.width,r.height,i,a,r.width,r.height):s.FeatherEngine.debugSettings.enabled?n.drawRect(t,i,a,this.width,this.height,"magenta",{filled:!0}):t.clearRect(i,a,this.width,this.height)}}t.default=r},8815:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteSheetLoader=t.FontLoader=void 0;const s=i(8236);t.FontLoader=s.default;const n=i(9819);t.SpriteSheetLoader=n.default},411:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})}},t={};!function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,i),a.exports}(5401)})();